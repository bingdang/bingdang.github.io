<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>Linux 基础知识 [已完结] | Maxbit</title><meta name="author" content="饼铛"><meta name="copyright" content="饼铛"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="实用的Linux基础总结，Bash Shell奇淫技巧等">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux 基础知识 [已完结]">
<meta property="og:url" content="https://cakepanit.com/forward/312ec9e0.html">
<meta property="og:site_name" content="Maxbit">
<meta property="og:description" content="实用的Linux基础总结，Bash Shell奇淫技巧等">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cakepanit.com/images/img-75.png">
<meta property="article:published_time" content="2019-04-03T11:38:00.000Z">
<meta property="article:modified_time" content="2023-02-26T11:06:05.597Z">
<meta property="article:author" content="饼铛">
<meta property="article:tag" content="OPS">
<meta property="article:tag" content="SHELL">
<meta property="article:tag" content="RAID">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cakepanit.com/images/img-75.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://cakepanit.com/forward/312ec9e0.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="/css/fei/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="/css/fei/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":100,"languages":{"author":"作者: 饼铛","link":"链接: ","source":"来源: Maxbit","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Linux 基础知识 [已完结]',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-02-26 19:06:05'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = url => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      link.onload = () => resolve()
      link.onerror = () => reject()
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/fei/swiper-bundle.min.css"><script src="/css/fei/swiper-bundle.min.js"></script><script src="/css/fei/pace.min.js"></script><meta name="generator" content="Hexo 5.4.2"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">93</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">72</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa-fw fas fa-book-open"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fa-fw fas fa-archive"></i><span> 文章列表</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fa-fw fas fa-shapes"></i><span> 全部分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa-fw fas fa-tags"></i><span> 所有标签</span></a></li><li><a class="site-page child" href="/charts/"><i class="fa-fw fa-fw fas fa-chart-line"></i><span> 文章统计</span></a></li><li><a class="site-page child" href="javascript:toRandomPost();"><i class="fa-fw fa-fw fas fa-random"></i><span> 随便看看</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa-fw fas fa-link"></i><span> 导航</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fa-fw fas fa-child"></i><span> 友情链接</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fa-fw fas fa-address-card"></i><span> 关于本站</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 其他</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-file-image"></i><span> 收藏图库</span></a></li><li><a class="site-page child" href="/bookshelf/"><i class="fa-fw fas fa-bookmark"></i><span> 收藏书单</span></a></li><li><a class="site-page child" href="/status"><i class="fa-fw fab fa-accessible-icon"></i><span> 站点监控</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/images/img-75.png')"><nav id="nav"><div id="nav-group"><span id="blog-info"> <a class="site-page" href="/" title="Maxbit"><span class="site-name">Maxbit</span><i class="fas fa-home"></i></a></span><span id="page_name"><a class="site-page" id="page-title" title="回到顶部" onclick="btf.scrollToDest(0, 500)"><span>Maxbit</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa-fw fas fa-book-open"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fa-fw fas fa-archive"></i><span> 文章列表</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fa-fw fas fa-shapes"></i><span> 全部分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa-fw fas fa-tags"></i><span> 所有标签</span></a></li><li><a class="site-page child" href="/charts/"><i class="fa-fw fa-fw fas fa-chart-line"></i><span> 文章统计</span></a></li><li><a class="site-page child" href="javascript:toRandomPost();"><i class="fa-fw fa-fw fas fa-random"></i><span> 随便看看</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa-fw fas fa-link"></i><span> 导航</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fa-fw fas fa-child"></i><span> 友情链接</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fa-fw fas fa-address-card"></i><span> 关于本站</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 其他</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-file-image"></i><span> 收藏图库</span></a></li><li><a class="site-page child" href="/bookshelf/"><i class="fa-fw fas fa-bookmark"></i><span> 收藏书单</span></a></li><li><a class="site-page child" href="/status"><i class="fa-fw fab fa-accessible-icon"></i><span> 站点监控</span></a></li></ul></div></div></div><div id="hotkey"><div id="setting-button" onclick="eurkon.switchRightSide();"><a class="site-page" href="javascript:void(0);" title="设置"><i class="fas fa-screwdriver-wrench fa-fw"></i></a></div><div id="top-button"><a class="site-page" href="javascript:void(0);" title="回到顶部" onclick="btf.scrollToDest(0, 500)"><span class="scroll-percent"></span><i class="fas fa-arrow-up fa-fw"></i></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></div></nav><div id="post-cover"><img class="cover" id="post-cover-img" src="/images/img-75.png" alt="cover"></div><div id="post-info"><div id="post-meta"><div class="meta-firstline"><span class="post-meta-categories"><i class="fas fa-shapes fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/OPS/">OPS</a></span><span class="post-meta-tags"><span class="post-meta-separator">|</span><i class="fas fa-tags fa-fw post-meta-icon"></i><a class="post-meta-tags" href="/tags/OPS/">🌍OPS</a><span class="post-meta-separator">•</span><a class="post-meta-tags" href="/tags/SHELL/">SHELL</a><span class="post-meta-separator">•</span><a class="post-meta-tags" href="/tags/RAID/">RAID</a></span></div><h1 class="post-title">Linux 基础知识 [已完结]</h1><div class="meta-secondline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2019-04-03T11:38:00.000Z" title="发表于 2019-04-03 19:38:00">2019-04-03</time></span><span class="post-meta-separator">|</span><span class="post-meta-date"><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-02-26T11:06:05.597Z" title="更新于 2023-02-26 19:06:05">2023-02-26</time></span><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">32k</span><span class="post-meta-separator">|</span></span><span class="post-meta-min2read"><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>138分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Linux 基础知识 [已完结]"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div><div id="post"><article class="post-content" id="article-container"><h1 id="启动过程"><a href="#启动过程" class="headerlink" title="启动过程"></a>启动过程</h1><p><img src="/images/pasted-186.png" alt="CentOS7启动过程"></p>
<h1 id="网络调试"><a href="#网络调试" class="headerlink" title="网络调试"></a>网络调试</h1><h2 id="临时关启网卡"><a href="#临时关启网卡" class="headerlink" title="临时关启网卡"></a>临时关启网卡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ifup &#123;interface&#125; || ifconfig &#123;interface&#125; up</span><br><span class="line">ifdown &#123;interface&#125; || ifconfig &#123;interface&#125; down</span><br></pre></td></tr></table></figure>
<h2 id="添加多块网卡"><a href="#添加多块网卡" class="headerlink" title="添加多块网卡"></a>添加多块网卡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[felix@es-node03 ~]$ <span class="built_in">cat</span> /etc/sysconfig/network-scripts/ifcfg-ens160 </span><br><span class="line">TYPE=Ethernet  <span class="comment">#设备类型为以太网设备</span></span><br><span class="line">BOOTPROTO=none <span class="comment">#是否启用该设备 static静态IP 或dhp 或none无（不指定），如是none，配上IP地址和 static效果一样</span></span><br><span class="line">DEFROUTE=<span class="built_in">yes</span></span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=<span class="built_in">yes</span></span><br><span class="line">IPV6_AUTOCONF=<span class="built_in">yes</span></span><br><span class="line">IPV6_DEFROUTE=<span class="built_in">yes</span></span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=ens160  	<span class="comment">#网卡名字</span></span><br><span class="line">UUID=6b1f051d-11c8-4d83-ba66-c6d98414ca84 <span class="comment">#网卡UUID，全球唯一</span></span><br><span class="line">DEVICE=ens160	<span class="comment">#设备名字，再内核中识别的名字</span></span><br><span class="line">ONBOOT=<span class="built_in">yes</span>		<span class="comment">#启用该设备，如果no，表示不启动此网络设备</span></span><br><span class="line">IPADDR=192.168.200.153	<span class="comment">#IP地址</span></span><br><span class="line">PREFIX=24		<span class="comment">#子网掩码，24相当于255.255.255.0</span></span><br><span class="line">GATEWAY=192.168.200.1	<span class="comment">#网关</span></span><br><span class="line">DNS1=172.18.16.1	<span class="comment">#首选DNS</span></span><br><span class="line">IPV6_PEERDNS=<span class="built_in">yes</span></span><br><span class="line">IPV6_PEERROUTES=<span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> /etc/sysconfig/network-scripts/ifcfg-ens160 /etc/sysconfig/network-scripts/ifcfg-ens161</span><br><span class="line"><span class="comment">#更改内容ens161</span></span><br><span class="line">NAME=ens161</span><br><span class="line">UUID=6b1f051d-11c8-4d83-ba66-c6d98414ca84 <span class="comment">#删除UUID</span></span><br><span class="line">DEVICE=ens161</span><br><span class="line">IPDADDR=192.168.200.154</span><br><span class="line"></span><br><span class="line">systemctl restart NetworkManager</span><br><span class="line">systemctl restart network</span><br></pre></td></tr></table></figure>
<h2 id="配置临时IP"><a href="#配置临时IP" class="headerlink" title="配置临时IP"></a>配置临时IP</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig &#123;interface&#125; &#123;ip addr&#125;</span><br></pre></td></tr></table></figure>
<h2 id="查看端口监听状态"><a href="#查看端口监听状态" class="headerlink" title="查看端口监听状态"></a>查看端口监听状态</h2><p>netstat命令：查看系统中网络连接状态信息<br>常用的参数格式：netstat- lntup</p>
<ul>
<li>-a -all显示本机所有连接和监听的端口</li>
<li>-n --numeric don’t resolve names以数字形式显示当前建立的有效连接和端口</li>
<li>-u 显示ud协议连接</li>
<li>-t显示tcp协议连接</li>
<li>-p，--programs显示连接对应的PID与程序名</li>
<li>-u显示udp协议连接</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@es-node03 ~]<span class="comment"># netstat -lntup</span></span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">协议  接收  发送    本地IP地址              远程IP地址              状态     PID</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </span><br><span class="line">tcp        0      0 0.0.0.0:8070            0.0.0.0:*               LISTEN      3790/python3 </span><br></pre></td></tr></table></figure>
<p><code>LISTEN</code>：(Listening for a connection.)侦听来自远方的TCP端口的连接请求<br><code>SYN-SENT</code>：(Active; sent SYN. Waiting for a matching connection request after having sent a connection request.)再发送连接请求后等待匹配的连接请求<br><code>SYN-RECEIVED</code>：(Sent and received SYN. Waiting for a confirming connection request acknowledgment after having both received and sent connection requests.)再收到和发送一个连接请求后等待对方对连接请求的确认<br><code>ESTABLISHED</code>：(Connection established.)代表一个打开的连接<br><code>FIN-WAIT-1</code>：(Closed; sent FIN.)等待远程TCP连接中断请求，或先前的连接中断请求的确认<br><code>FIN-WAIT-2</code>：(Closed; FIN is acknowledged; awaiting FIN.)从远程TCP等待连接中断请求<br><code>CLOSE-WAIT</code>：(Received FIN; waiting to receive CLOSE.)等待从本地用户发来的连接中断请求<br><code>CLOSING</code>：(Closed; exchanged FIN; waiting for FIN.)等待远程TCP对连接中断的确认<br><code>LAST-ACK</code>：(Received FIN and CLOSE; waiting for FIN ACK.)等待原来的发向远程TCP的连接中断请求的确认<br><code>TIME-WAIT</code>：(In 2 MSL (twice the maximum segment length) quiet wait after close. )等待足够的时间以确保远程TCP接收到连接中断请求的确认<br><code>CLOSED</code>：(Connection is closed.)没有任何连接状态</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">服务器中存在大量</span><br><span class="line">[root@es-node03 ~]<span class="comment"># cat /proc/sys/net/ipv4/tcp_fin_timeout </span></span><br><span class="line">2</span><br><span class="line"><span class="comment">#通过缩短时间 time walt时间来快速释放链接</span></span><br><span class="line">vim /etc/sysctl.conf</span><br><span class="line">net.ipv4.tcp_fin_timeout = 2</span><br></pre></td></tr></table></figure>
<h2 id="DNS相关配置"><a href="#DNS相关配置" class="headerlink" title="DNS相关配置"></a>DNS相关配置</h2><p><code>/etc/hosts</code>文件，优先级高于DNS解析</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/hosts</span><br><span class="line">192.168.200.148  node1</span><br><span class="line">192.168.200.149  node2</span><br><span class="line">192.168.200.153  node3</span><br></pre></td></tr></table></figure>
<p><code>/etc/resolv.conf</code><br>注：在 centos5版本，配置dns用这个文件。在 centos6 7以后，直接在网卡配置文件中指定<code>DNS1=192168.1.1</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@es-node03 ~]<span class="comment"># cat /etc/resolv.conf </span></span><br><span class="line"><span class="comment"># Generated by NetworkManager</span></span><br><span class="line">nameserver 172.18.16.1</span><br></pre></td></tr></table></figure>
<p>问：为什么hosts优先级高于dns</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@es-node03 ~]<span class="comment"># grep &quot;hosts:&quot; /etc/nsswitch.conf</span></span><br><span class="line"><span class="comment">#hosts:     db files nisplus nis dns</span></span><br><span class="line">hosts:      files dns myhostname <span class="comment">#files（/etc/hosts）放在了dns前面）</span></span><br></pre></td></tr></table></figure>
<h2 id="系统路由信息"><a href="#系统路由信息" class="headerlink" title="系统路由信息"></a>系统路由信息</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@es-node03 ~]<span class="comment"># route -n</span></span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         192.168.200.1   0.0.0.0         UG    0      0        0 ens160</span><br><span class="line">表示任何网段    默认网关       所有主机  </span><br></pre></td></tr></table></figure>
<p>添加删除路由条目</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">route add -net 192.168.300.0 netmask 255.255.255.0 dev ens161</span><br><span class="line">				网段       掩码            出接口</span><br><span class="line">route del -net 192.168.300.0 netmask 255.255.255.0</span><br></pre></td></tr></table></figure>
<p>路由跟踪：查看经过多少三层设备的数量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@es-node03 ~]<span class="comment"># traceroute 172.18.16.1</span></span><br><span class="line">traceroute to 172.18.16.1 (172.18.16.1), 30 hops max, 60 byte packets</span><br><span class="line"> 1  localhost (192.168.200.1)  22.189 ms  22.913 ms  23.730 ms</span><br><span class="line"> 2  * * *</span><br></pre></td></tr></table></figure>
<h2 id="ping命令"><a href="#ping命令" class="headerlink" title="ping命令"></a>ping命令</h2><p>ping {ip addr}</p>
<ul>
<li>-c 数目 在发送指定数目的包后停止</li>
<li>-i 秒数 设定间隔几秒送一个网络封包给一台机器，预设值是一秒送一次</li>
<li>-I ens161 指定从哪个接口出去</li>
</ul>
<p>arping -I ens160 192.168.200.1 #观察mac地址是否一样，一样则没有人冒充网关</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ARPING 192.168.200.1 from 192.168.200.153 ens160</span><br><span class="line">Unicast reply from 192.168.200.1 [E8:BD:D1:F6:6A:B3]  4.658ms</span><br><span class="line">Unicast reply from 192.168.200.1 [E8:BD:D1:F6:6A:B3]  3.815ms</span><br><span class="line">Unicast reply from 192.168.200.1 [E8:BD:D1:F6:6A:B3]  4.710ms</span><br></pre></td></tr></table></figure>
<h2 id="watch命令"><a href="#watch命令" class="headerlink" title="watch命令"></a>watch命令</h2><p>watch作用：实时监测命令的运行结果，可以看到所有变化数据包的大小</p>
<ul>
<li>-d，–differences #高亮显示指令输出信息不同之处； </li>
<li>-n，–interval seconds #指定指令执行的间隔时间（秒）</li>
</ul>
<p>例：每隔1秒高亮差异显示ens33相关信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">watch -d -n 1 ifconfig ens160</span><br><span class="line">Every 1.0s: ifconfig ens160                  Tue Jun 16 10:32:20 2020</span><br><span class="line"></span><br><span class="line">ens160: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.200.153  netmask 255.255.255.0  broadcast 192.168.200.255</span><br><span class="line">        inet6 fe80::250:56ff:fe9d:b0b  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether 00:50:56:9d:0b:0b  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 9665169  bytes 8799755781 (8.1 GiB)</span><br><span class="line">        RX errors 0  dropped 20  overruns 0  frame 0</span><br><span class="line">        TX packets 7473274  bytes 6814218750 (6.3 GiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure>
<h2 id="tcpdump抓包"><a href="#tcpdump抓包" class="headerlink" title="tcpdump抓包"></a>tcpdump抓包</h2><p>tcpdump常用参数：</p>
<ul>
<li>-c 指定包个数</li>
<li>-n ip,端口用数字方式显示</li>
<li>-i 指定接口</li>
<li>port 指定端口</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@es-node03 ~]<span class="comment"># tcpdump -n -c 30 port 22 -i ens160</span></span><br></pre></td></tr></table></figure>

<h2 id="SYN洪水攻击"><a href="#SYN洪水攻击" class="headerlink" title="SYN洪水攻击"></a>SYN洪水攻击</h2><p><strong>SYN洪水攻击主要源于</strong>： tcp协议的三次握手机制<br><strong>SYN洪水攻击的过程</strong>：</p>
<ul>
<li>在服务端返回一个确认的SYN-ACK包的时候有个潜在的弊端，如果发起的客户是一个不存在的客户端，那么服务端就不会接到客户端回应的ACK包。</li>
<li>这时服务端需要耗费一定的数量的系统内存来等待这个<strong>未决的连接</strong>，直到等待超关闭时间，才能施放内存。</li>
<li>如果恶意者通过通过ip欺骗，发送大量SYN包给受害者系统，导致服务端存在大量未决的连接并占用大量内存和tcp连接，从而导致正常客户端无法访问服务端，这就是SYN洪水攻击的过程。</li>
</ul>
<p>使用awl伪装MAC对内网的服务器施实syn洪水攻击<br>awl下载地址：<a target="_blank" rel="noopener" href="https://pincheng.lanzous.com/ij9dxdq3aqd">https://pincheng.lanzous.com/ij9dxdq3aqd</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@es-node03 ~]<span class="comment"># tar -xf awl-0.2.tar.gz </span></span><br><span class="line">[root@es-node03 ~]<span class="comment"># cd awl-0.2/</span></span><br><span class="line">[root@es-node03 ~/awl-0.2]<span class="comment"># ./configure &amp;&amp; make -j 4 &amp;&amp; make install</span></span><br><span class="line">[root@es-node03 ~/awl-0.2]<span class="comment"># which awl</span></span><br><span class="line">/usr/local/bin/awl</span><br><span class="line"></span><br><span class="line">[root@es-node03 ~/awl-0.2]<span class="comment"># ping 192.168.200.153</span></span><br><span class="line">PING 192.168.200.153 (192.168.200.153) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.200.153: icmp_seq=1 ttl=64 time=0.322 ms</span><br><span class="line">[root@es-node03 ~]<span class="comment"># arp -n | grep 153</span></span><br><span class="line">192.168.200.153          ether   00:50:56:9d:0b:0b   C    ens160</span><br><span class="line"><span class="comment">#获取目标主机mac地址</span></span><br></pre></td></tr></table></figure>
<p>awl 的格式如下:<br><code>awl -i ens160 -m 00:50:56:9d:0b:0b -d 192.168.200.153 -p 80</code><br>参数如下:</p>
<ul>
<li>-i 发送包的接口,如果省略默认是eth0</li>
<li>-m 被攻击机器的mac地址,程序不能根据被攻击IP得到MAC,需要手工指定.先ping 目标IP,再arp -a就可以看到.<br>如果省略则为ff:ff:ff:ff:ff:ff :这表示向同一网段內的所有主机发出ARP广播，进行SYN攻击，还容易使整个局域网瘫痪</li>
<li>-d 被攻击机器的IP</li>
<li>-p 被攻击机器的端口.<br>这里注意，手动指定-i参数很重要，比如我们的网卡是ens160,那就要指定 -i ens160，alvin的实测结果显示，不这样指定的时候，攻击无效。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@es-node03 ~]<span class="comment"># netstat -na | grep &quot;SYN_RECV&quot;</span></span><br><span class="line">tcp        0      0 192.168.200.153:80      218.149.245.64:17552    SYN_RECV   </span><br><span class="line">tcp        0      0 192.168.200.153:80      111.187.179.3:49721     SYN_RECV   </span><br><span class="line">tcp        0      0 192.168.200.153:80      59.171.38.91:26277      SYN_RECV   </span><br><span class="line">tcp        0      0 192.168.200.153:80      17.139.112.127:34437    SYN_RECV</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h1 id="文件相关属性"><a href="#文件相关属性" class="headerlink" title="文件相关属性"></a>文件相关属性</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@f felix]<span class="comment"># ls -lih</span></span><br><span class="line">total 8.0K</span><br><span class="line">537327051 drwxr-xr-x 2 root root 6 2019-09-29 16:59 felix1</span><br><span class="line">        2385 -             rw-r--r-   -               1              root  root   0     2019-09-30 11:00 felix10.txt</span><br><span class="line">       inode 文件类型  权限     SElinux         硬链接数    属主 属组  大小  修改时间            文件名</span><br></pre></td></tr></table></figure>
<h2 id="索引节点inode-amp-磁盘块Block"><a href="#索引节点inode-amp-磁盘块Block" class="headerlink" title="索引节点inode&amp;磁盘块Block"></a>索引节点inode&amp;磁盘块Block</h2><p><img src="/images/pasted-104.png" alt="Linux文件访问流程"></p>
<ul>
<li><p><strong>inode：</strong></p>
</li>
<li><p>概念：索引节点的概念出在ext文件系统中（ext2 ext3 ext4），在磁盘进行格式化(建立文件系统)操作时，会生成大量的inode和block，找到一个文件最终都要通过索引节点inode才能找到（相当于书的目录）。</p>
</li>
<li><p>定义：类似于文件的身份证，索引节点是文件在系统中的唯一标识。索引节点是硬盘上的一块存储空间。大小256字节或512字节。</p>
</li>
<li><p>作用：索引节点里存放的数据是文件的属性（大小、时间、用户和组、权限等）唯独不包含文件名（文件名在上级目录的block里）。同时存放指向文件Block的指针（类似于软链接）。</p>
</li>
<li><p>特点：1.在ext3/ext4文件系统(C5/C6默认文件系统)下，一个非空文件至少要占用一个且只有一个Inode以及一个或多个Block。在文件系统进行初始化时，Block数量远大于inode数量。</p>
<ol start="2">
<li>Inode节点号相同的文件，互为硬链接文件，可以认为是一个文件的不同入口。</li>
<li>Inode在某一个文件系统（分区）内是唯一的。   </li>
</ol>
</li>
<li><p><strong>Block：</strong></p>
</li>
<li><p>作用：用来存放实际数据的实体单元（ext文件系统一般最大为4KB），即用来存放真实数据，例如：照片、视频等普通文件数据，单个大的文件需要占用多个Block块来存储，特别小的单个文件如果不能占满整个Block块，剩余的空间也无法再利用。</p>
</li>
<li><p>特点：</p>
<ol>
<li>磁盘读取数据是按Block为单位存取的。</li>
<li>每读取一个Block就会消耗一次磁盘I/O</li>
<li>若文件比较大，一个文件可能占用多个Block。</li>
<li>若文件比较小，一个Block剩余空间会被浪费，无论内容有多小。</li>
<li>block大小也是格式化时确定的，命令是 mkfs.ext4 -b 2048 -I 256 /dev/sdb。</li>
</ol>
</li>
</ul>
<h2 id="inode-amp-block管理："><a href="#inode-amp-block管理：" class="headerlink" title="inode&amp;block管理："></a>inode&amp;block管理：</h2><p>查看Inodes数量：<code>df -i</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@f felix]<span class="comment"># df -i</span></span><br><span class="line">文件系统          总数       已使用      剩余        使用百分比  挂载点</span><br><span class="line">Filesystem        Inodes      IUsed     IFree           IUse%    Mounted on</span><br><span class="line">/dev/vda3        207092736  99830     206992906    1%        /</span><br></pre></td></tr></table></figure>
<p>查看Block数量：<code>df -h</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@f felix]<span class="comment"># df -h</span></span><br><span class="line">文件系统         大小         已使用     空闲         使用百分比  挂载点</span><br><span class="line">Filesystem        Size          Used       Avail           Use%      Mounted on</span><br><span class="line">/dev/vda3        198G         4.3G        194G           3%         /</span><br></pre></td></tr></table></figure>
<p>生产环境下排查硬盘满的原因及解法：<br><img src="/images/pasted-105.png" alt="disk"></p>
<h2 id="linux文件类型"><a href="#linux文件类型" class="headerlink" title="linux文件类型"></a>linux文件类型</h2><p><img src="/images/pasted-106.png" alt="filetype"></p>
<h2 id="文件权限机制"><a href="#文件权限机制" class="headerlink" title="文件权限机制"></a>文件权限机制</h2><p>权限是操作系统用来限制对资源访问的机制，权限一般分为读、写、执行。系统中每个文件都拥有特定的权限、所属用户及所属组，通过这样的机制来限制哪些用户、哪些组可以对特定文件进行什么样的操作。<br><img src="/images/pasted-107.png" alt="upload successful"></p>
<h2 id="SELinux"><a href="#SELinux" class="headerlink" title="SELinux"></a>SELinux</h2><p><img src="/images/pasted-108.png" alt="selinux"></p>
<h2 id="Linux软硬链接"><a href="#Linux软硬链接" class="headerlink" title="Linux软硬链接"></a>Linux软硬链接</h2><p><img src="/images/pasted-109.png" alt="headlinksoftlink"><br><strong>有关硬链接：</strong></p>
<ol>
<li>具有相同inode节点号的多个文件互为硬链接文件，相当于一个房间（文件）开了多个门（硬链接）；</li>
<li>删除硬链接文件或者删除源文件任意之一，文件实体并未被删除；</li>
<li>只有删除了源文件和所有对应的硬链接文件，文件实体才会被删除；</li>
<li>硬链接文件是文件的另一个入口；</li>
<li>可以通过给文件设置硬链接文件来防止重要文件被误删（防删不防改，备份，防删又防改。）；</li>
<li>创建硬链接命令 ln 源文件 硬链接文件；</li>
<li>硬链接文件是普通文件 -，可以用rm删除；</li>
<li>对于静态文件（没有进程正在调用），当硬链接数为0时文件就被删除。注意：如果有进程正在调用，则无法删除或者即使文件名被删除但空间不会释放。</li>
<li>目录/ 和 目录/.互为硬链接，目录/ 和 目录/子目录/.. 互为硬链接</li>
</ol>
<p><strong>硬链接扩展：</strong><br>cp 操作慢于 mv 命令<br>cp命令将源文件和cp出的新文件完全独立成了两个个体（即新文件改变了原本指向的inode和block）。<br>mv命令只是将文件名改了，并未重新指向新的inode和block。</p>
<p><strong>有关软链接：</strong></p>
<ol>
<li>软链接类似windows系统的快捷方式；</li>
<li>软链接里面存放的是源文件的路径，指向源文件的文件名；</li>
<li>删除源文件，软链接依然存在，但无法访问源文件内容；</li>
<li>软链接失效时一般是白字红底闪烁；</li>
<li>创建软链接命令 ln -s 源文件 软链接文件；</li>
<li>软链接和源文件是不同的文件，文件类型也不同，inode号也不同；</li>
<li>软链接的文件类型是“l”，可以用rm删除。</li>
</ol>
<p><strong>软硬链接的区别：</strong></p>
<ol>
<li>原理上，硬链接和源文件的inode节点号相同，两者互为硬链接。软连接和源文件的inode节点号不同，进而指向的block也不同，软连接block中存放了源文件的路径名(文件名)。</li>
<li>实际上，硬链接和源文件是同一份文件，而软连接是独立的文件，类似于快捷方式，存储着源文件的位置信息便于指向。</li>
<li>使用限制上，不能对目录创建硬链接，不能对不同文件系统创建硬链接，不能对不存在的文件创建硬链接；可以对目录创建软连接，可以跨文件系统创建软连接，可以对不存在的文件创建软连接。</li>
</ol>
<h2 id="文件的时间戳"><a href="#文件的时间戳" class="headerlink" title="文件的时间戳"></a>文件的时间戳</h2><p><img src="/images/pasted-110.png" alt="upload successful"></p>
<h2 id="文件-amp-目录权限"><a href="#文件-amp-目录权限" class="headerlink" title="文件&amp;目录权限"></a>文件&amp;目录权限</h2><p><img src="/images/pasted-111.png" alt="文件权限"><br><img src="/images/pasted-112.png" alt="目录权限"></p>
<p>Linux基础权限 9个字符，分三组，三个字符一组：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2362 drwxr-xr-x 2 root root   6 2019-10-09 16:24 1.txt</span><br></pre></td></tr></table></figure>
<p><code>rwx r-x r-x</code><br>前3字符：用户(属主)权限位<br>中3字符：用户组(属组)权限位<br>后3字符：其他用户权限位</p>
<p>权限位置（UGO）：rwx，读 4，写2，可执行1，- 0<br><strong>可读r</strong>：表示读取、浏览文件内容（即读取文件实体block）的权限。<br><strong>可写w</strong>：表示具有新增、修改、删除文件内容的权限。</p>
<ol>
<li>如果没有可写w的配合，那么可以使用vim编辑文件时会提示无法编辑（但可以强制编辑），可以使用echo等命令进行重定向或追加。</li>
<li>删除文件或创建文件的权限时受父目录（上一级目录）的权限控制的[因为文件名没有存放再Inode里），而是在上级目录的Block里存放着，若修改上级目录的Block(删除文件的本质)，当然会受上级目录的Inode的权限控制]，和文件本身的权限无关，因此，文件本身的可写w权限，和文件是否能被删除无关。（打狗也要看主人）</li>
</ol>
<p><img src="/images/pasted-113.png" alt="rm file"></p>
<p><strong>可执行x</strong>：具有执行文件的权限</p>
<ol>
<li>文件本身要能够执行（命令，脚本）</li>
<li>如果是普通用户，同时还需要具备可读r的权限才能够执行文件。</li>
<li>root用户只要有可执行x的权限即可执行文件</li>
</ol>
<p><strong>umask：</strong>控制默认权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@es-node03 ~]<span class="comment"># umask</span></span><br><span class="line">0022</span><br></pre></td></tr></table></figure>

<p><strong>文件：</strong><br>创建文件默认最大的权限为666（-rw-rw-rw-），其默认创建的文件没有可执行权限x位。<br>默认权限-umask=实际权限 #对于文件当umask中存在奇数位的时候，在计算完毕后，奇数位加1</p>
<p><strong>目录：</strong><br>创建文件默认最大权限为777（rwxrwxrwx）<br>默认权限-umask=实际权限 </p>
<p><strong>特殊权限3位：</strong><br><img src="/images/pasted-114.png" alt="1"></p>
<p><img src="/images/pasted-115.png" alt="2"></p>
<p>修改：放在基础权限数字的前面<br>[root@oldboyedu /oldboy]# chmod 7755 abc &lt;==UGO中只要存在x权限，则特殊权限位（s,s,t）都为小写，反之则都为大写<br>所以结果：abc rwsr-sr-t</p>
<p><strong>suid：</strong><br>SUID作用：suid的作用就是让普通用户可以在执行某个设置了suid位的命令或程序时，拥有和root管理员一样的身份和权限（默认情况）。<br>例如：passwd命令<br><img src="/images/pasted-116.png" alt="passwd命令"><br>任何人执行passwd这个命令，就会以passwd这个命令的属主（即 root）相同的权限来执行passwd。这就是suid的作用（尚方宝剑）</p>
<p><img src="/images/pasted-117.png" alt="3"></p>
<p>suid总结：</p>
<ol>
<li>suid功能时正对二进制命令或程序的，不能用在Shell等类型脚本文件上。</li>
<li>用户或属主对应的前三位权限的x位上，如果有s（S）就表示具备suid权限。</li>
<li>suid的作用就是让普通用户可以在执行某个设置了suid位命令或程序时，拥有和root管理员一样的身份和权限（默认）。</li>
<li>二进制命令程序需要有可执行权限x配合才行。</li>
<li>suid对应的身份和权限今在程序命令执行过程中有效。</li>
<li>suid是一把双刃剑，是一个比较危险的功能，对系统安全有一定的威胁，企业里用户授权可以使用sudo等替代sgid功能。</li>
<li>在进行安全优化时，系统中默认设置了suid权限的命令要被取消掉。</li>
</ol>
<p><strong>sgid：</strong><br>对于二进制命令或者程序来说，sgid的功能和suid基本相同，唯一区别是suid是获得命令属主的身份和权限，而sgid则是获得命令属组的身份和权限。</p>
<p>sgid总结：</p>
<ol>
<li>与suid不同的是，sgid既可以针对文件，亦可以针对目录。</li>
<li>sgid的权限是针对用户组权限位的。</li>
</ol>
<ul>
<li>对于文件来说，sgid：<ul>
<li>sgid仅对二进制命令及程序有效。</li>
<li>二进制命令或程序，也需要有可执行权限x配合。</li>
<li>执行命令的任意用户可以获得该命令程序执行期间所属组的身份和权限。</li>
</ul>
</li>
<li>对于目录来说，sgid：<ul>
<li>Linux里默认情况所有创建，默认用户和组都是自身。</li>
<li>sgid可以让用户在此目录下创建的文件和目录具有和此目录相同的用户组设置</li>
</ul>
</li>
</ul>
<p><img src="/images/pasted-118.png" alt="3"></p>
<p><strong>粘滞位：</strong><br>文件夹权限全部打开，但是目录本身只能被属主或root删除。</p>
<p><strong>文件属主，属组的特殊情况：</strong><br>当文件或目录的用户或用户组被删除时，文件对应的属主和属组位置就会显示UID或GID。<br>修复方法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">useradd 用户名 -u UID</span><br><span class="line">groupadd -g GID 组名 </span><br></pre></td></tr></table></figure>

<h2 id="生产环境应用"><a href="#生产环境应用" class="headerlink" title="生产环境应用"></a>生产环境应用</h2><p>安全权限的临界点：<br>文件的安全临界点：<code>644</code><br>目录的安全临界点：<code>755</code></p>
<p>文件加解锁：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@S1 ~]<span class="comment"># lsattr /etc/passwd</span></span><br><span class="line">---------------- /etc/passwd</span><br><span class="line">[root@S1 ~]<span class="comment"># chattr +i /etc/passwd   &lt;==锁定文件，不给删除不给修改</span></span><br><span class="line">[root@S1 ~]<span class="comment"># lsattr /etc/passwd</span></span><br><span class="line">----i----------- /etc/passwd</span><br><span class="line">[root@S1 ~]<span class="comment"># cp /etc/passwd&#123;,.ori&#125;</span></span><br><span class="line"><span class="built_in">cp</span>: overwrite ‘/etc/passwd.ori’? y</span><br><span class="line">[root@S1 ~]<span class="comment"># rm -rf /etc/passwd</span></span><br><span class="line"><span class="built_in">rm</span>: cannot remove ‘/etc/passwd’: Operation not permitted</span><br><span class="line">[root@S1 ~]<span class="comment"># echo ddd &gt; /etc/passwd</span></span><br><span class="line">-bash: /etc/passwd: Permission denied</span><br><span class="line"></span><br><span class="line">[root@S1 ~]<span class="comment"># touch felix.txt</span></span><br><span class="line">[root@S1 ~]<span class="comment"># chattr +a felix.txt  &lt;==可以追加内容，但不能删除。</span></span><br><span class="line">[root@S1 ~]<span class="comment"># lsattr felix.txt </span></span><br><span class="line">-----a---------- felix.txt</span><br><span class="line">[root@S1 ~]<span class="comment"># echo 123 &gt;&gt; felix.txt </span></span><br><span class="line">[root@S1 ~]<span class="comment"># echo 123 &gt;&gt; felix.txt </span></span><br><span class="line">[root@S1 ~]<span class="comment"># echo 123 &gt;&gt; felix.txt </span></span><br><span class="line">[root@S1 ~]<span class="comment"># cat felix.txt</span></span><br><span class="line">123</span><br><span class="line">123</span><br><span class="line">123</span><br><span class="line">[root@S1 ~]<span class="comment"># rm -rf felix.txt </span></span><br><span class="line"><span class="built_in">rm</span>: cannot remove ‘felix.txt’: Operation not permitted</span><br></pre></td></tr></table></figure>

<p><img src="/images/pasted-119.png" alt="4"></p>
<h2 id="用户和用户组"><a href="#用户和用户组" class="headerlink" title="用户和用户组"></a>用户和用户组</h2><p>用户，用户组，管理员之间的关系：</p>
<p><img src="/images/pasted-120.png" alt="5"><br>UID<br><img src="/images/pasted-121.png" alt="6"></p>
<p>相关配置文件：<br><code>/etc/passwd</code> 存储当前系统中所有用户的信息<br><img src="/images/pasted-122.png" alt="7"><br>1.root用户编号固定为0<br>2.除了root用户外的其他用户，当用户被创建时，会在/home目录下为用户创建一个和用户名相同的目录作为这个用户的家目录。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@lihuaning maildrop]<span class="comment"># cat /etc/shells </span></span><br><span class="line">/bin/sh</span><br><span class="line">/bin/bash</span><br><span class="line">/sbin/nologin</span><br><span class="line">/usr/bin/sh</span><br><span class="line">/usr/bin/bash</span><br><span class="line">/usr/sbin/nologin</span><br><span class="line">/bin/tcsh</span><br><span class="line">/bin/csh</span><br><span class="line">[root@lihuaning maildrop]<span class="comment"># ls -l /bin/sh</span></span><br><span class="line">lrwxrwxrwx. 1 root root 4 2019-07-12 22:48 /bin/sh -&gt; bash</span><br></pre></td></tr></table></figure>
<p>bash是sh的扩展，sh是bash的软链接</p>
<p><code>/etc/shadow</code> 存储当前系统中所有用户的密码信息，shadow配置文件的行数与passwd文件相同。<br><img src="/images/pasted-123.png" alt="8"></p>
<p><strong>添加用户：</strong><br><img src="/images/pasted-124.png" alt="9"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@lihuaning ~]<span class="comment"># cat /etc/default/useradd  &lt;==useradd配置文件</span></span><br><span class="line"><span class="comment"># useradd defaults file</span></span><br><span class="line">GROUP=100  &lt;==依赖于/etc/login.defs 的USERGROUP_ENAB参数，如果no，则此处控制</span><br><span class="line">HOME=/home  &lt;==定义默认家目录位置</span><br><span class="line">INACTIVE=-1  &lt;==用户是否启用过期停权，-1不启用</span><br><span class="line">EXPIRE=  &lt;==用户终止日期，不设置代表不启用</span><br><span class="line">SHELL=/bin/bash  &lt;==定义默认shell</span><br><span class="line">SKEL=/etc/skel  &lt;==配置所有新用户家目录的默认环境变量文件存放路径，从该文件中复制过去，为每个用户提供用户环境变量的目录</span><br><span class="line">[root@lihuaning ~]<span class="comment"># ls -A /etc/skel/</span></span><br><span class="line">.bash_logout  .bash_profile  .bashrc</span><br><span class="line"></span><br><span class="line">CREATE_MAIL_SPOOL=<span class="built_in">yes</span>  &lt;==创建mail文件</span><br><span class="line"></span><br><span class="line">修改方法：</span><br><span class="line">useradd -D 接参数改 或者直接编辑配置文件</span><br><span class="line"></span><br><span class="line">示例：</span><br><span class="line">在切到该用户后，提示符变为如下，是因为用户的环境变量缺失导致的。</span><br><span class="line">[root@lihuaning xjh]<span class="comment"># su xjh</span></span><br><span class="line">bash-4.2$</span><br><span class="line"></span><br><span class="line">解决：bash-4.2$ <span class="built_in">cp</span> /etc/skel/.bash* .</span><br><span class="line">若未生效：<span class="built_in">source</span> .bash_logout .bashrc .bash_profile &lt;==使环境变量生效</span><br><span class="line"></span><br><span class="line">或者：</span><br><span class="line">[root@lihuaning ~]<span class="comment"># echo $PS1</span></span><br><span class="line">[\u@\h \W]\$</span><br><span class="line">bash-4.2$ <span class="built_in">export</span> PS1=<span class="string">&#x27;[\u@\h \W]\$&#x27;</span>  &lt;==临时生效</span><br><span class="line">[xjh@lihuaning root]$</span><br><span class="line"><span class="built_in">logout</span> 登出再登陆</span><br></pre></td></tr></table></figure>

<p>/etc/login.defs<br>是设置用户帐号限制的文件。该文件里的配置对root用户无效。如果/etc/shadow文件里有相同的选项，则以/etc/shadow里的设置为准，也就是说/etc/shadow的配置优先级高于/etc/login.defs</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">[root@felix ~]# cat /etc/login.defs </span><br><span class="line">#</span><br><span class="line"># Please note that the parameters in this configuration file control the</span><br><span class="line"># behavior of the tools from the shadow-utils component. None of these</span><br><span class="line"># tools uses the PAM mechanism, and the utilities that use PAM (such as the</span><br><span class="line"># passwd command) should therefore be configured elsewhere. Refer to</span><br><span class="line"># /etc/pam.d/system-auth for more information.</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line"># *REQUIRED*</span><br><span class="line">#   Directory where mailboxes reside, _or_ name of file, relative to the</span><br><span class="line">#   home directory.  If you _do_ define both, MAIL_DIR takes precedence.</span><br><span class="line">#   QMAIL_DIR is for Qmail</span><br><span class="line">#</span><br><span class="line">#QMAIL_DIR	Maildir</span><br><span class="line">MAIL_DIR	/var/spool/mail  &lt;==创建用户时，要在目录/var/spool/mail中创建一个用户mail文件</span><br><span class="line">#MAIL_FILE	.mail</span><br><span class="line"></span><br><span class="line"># Password aging controls:</span><br><span class="line">#</span><br><span class="line">#	PASS_MAX_DAYS	Maximum number of days a password may be used.</span><br><span class="line">#	PASS_MIN_DAYS	Minimum number of days allowed between password changes.</span><br><span class="line">#	PASS_MIN_LEN	Minimum acceptable password length.</span><br><span class="line">#	PASS_WARN_AGE	Number of days warning given before a password expires.</span><br><span class="line">#</span><br><span class="line">PASS_MAX_DAYS	99999  &lt;==密码最大有效期</span><br><span class="line">PASS_MIN_DAYS	0  &lt;==两次修改密码的最小间隔时间</span><br><span class="line">PASS_MIN_LEN	5  &lt;==密码最小长度，对于root无效</span><br><span class="line">PASS_WARN_AGE	7  &lt;==密码过期前多少天开始提示</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># Min/max values for automatic uid selection in useradd</span><br><span class="line">#创建用户时不指定UID的话自动UID的范围</span><br><span class="line">UID_MIN                  1000</span><br><span class="line">UID_MAX                 60000</span><br><span class="line"># System accounts&lt;==虚拟用户UID范围</span><br><span class="line">SYS_UID_MIN               201</span><br><span class="line">SYS_UID_MAX               999</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># Min/max values for automatic gid selection in groupadd</span><br><span class="line">#自动组ID的范围</span><br><span class="line">GID_MIN                  1000</span><br><span class="line">GID_MAX                 60000</span><br><span class="line"># System accounts</span><br><span class="line">SYS_GID_MIN               201</span><br><span class="line">SYS_GID_MAX               999</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># If defined, this command is run when removing a user.</span><br><span class="line"># It should remove any at/cron/print jobs etc. owned by</span><br><span class="line"># the user to be removed (passed as the first argument).</span><br><span class="line">#</span><br><span class="line">#USERDEL_CMD	/usr/sbin/userdel_local &lt;==当删除用户的时候执行的脚本，默认关闭</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># If useradd should create home directories for users by default</span><br><span class="line"># On RH systems, we do. This option is overridden with the -m flag on</span><br><span class="line"># useradd command line.</span><br><span class="line">#</span><br><span class="line">CREATE_HOME	yes  &lt;==是否创建家目录，可用-m控制</span><br><span class="line"></span><br><span class="line"># The permission mask is initialized to this value. If not specified, </span><br><span class="line"># the permission mask will be initialized to 022.</span><br><span class="line">UMASK           077  &lt;==家目录对对应的umask值</span><br><span class="line"></span><br><span class="line"># This enables userdel to remove user groups if no members exist.</span><br><span class="line">#</span><br><span class="line">USERGROUPS_ENAB yes  &lt;==删除用户时，同时删除对应组。（如果组内没有其他成员）</span><br><span class="line"></span><br><span class="line"># Use SHA512 to encrypt password.</span><br><span class="line">ENCRYPT_METHOD SHA512  &lt;==密码的加密算法SHA512</span><br><span class="line">注意：</span><br><span class="line">	1.给开发人员等添加用户，尽量给截止时间。</span><br></pre></td></tr></table></figure>
<p><strong>修改用户：</strong><br><img src="/images/pasted-125.png" alt="10"><br><strong>删除用户：</strong><br><img src="/images/pasted-126.png" alt="11"><br>生产环境中一般先注释passwd中该用户的所属行，不立刻进行删除。</p>
<p><strong>设置密码：</strong><br><img src="/images/pasted-127.png" alt="12"></p>
<p>–stdin 从标准输入接受密码并设置</p>
<p>不交互设置密码：<br>方法1：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@oldboyedu ~]<span class="comment"># echo 123456|passwd --stdin oldgirl</span></span><br><span class="line">Changing password <span class="keyword">for</span> user oldgirl.</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br></pre></td></tr></table></figure>
<p>方法2：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@oldboyedu ~]<span class="comment"># echo 123456 &gt;pass</span></span><br><span class="line">[root@oldboyedu ~]<span class="comment"># cat pass</span></span><br><span class="line">123456</span><br><span class="line">[root@oldboyedu ~]<span class="comment"># passwd --stdin oldgirl &lt;pass </span></span><br><span class="line">Changing password <span class="keyword">for</span> user oldgirl.</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br></pre></td></tr></table></figure>
<p>生产环境中密码管理思路：</p>
<ol>
<li>用户密码要足够复杂,最好8位以上字母(含大小写)、数字、特殊字符的组合 </li>
<li>较大的企业用户和密码可以统一管理(采用微软活动目录或 openldap开源工具)</li>
<li>动态密码:动态口令,需要时登录到动态口令系统中,即时申请获得密码,但如果若干时间内不操作服务器,密码就会失效</li>
</ol>
<p><img src="/images/pasted-128.png" alt="13"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@oldboyedu ~]<span class="comment"># tail -4 /etc/passwd|awk -F &quot;:&quot; &#x27;&#123;print $1&quot;:oldboy&quot;&#125;&#x27; &gt;user.log</span></span><br><span class="line">[root@oldboyedu ~]<span class="comment"># cat user.log</span></span><br><span class="line">gongli1:oldboy</span><br><span class="line">gongli2:oldboy</span><br><span class="line">chenglong1:oldboy</span><br><span class="line">zongsheng:oldboy</span><br></pre></td></tr></table></figure>
<p>chpasswd对密码文件的要求是上述user.log</p>
<p>方法1：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@oldboyedu ~]<span class="comment"># chpasswd&lt;user.log </span></span><br></pre></td></tr></table></figure>
<p>方法2：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@oldboyedu ~]<span class="comment"># tail -4 /etc/passwd|awk -F &quot;:&quot; &#x27;&#123;print $1&quot;:oldboy&quot;&#125;&#x27;|chpasswd </span></span><br></pre></td></tr></table></figure>

<p><strong>批量创建用户并设置密码：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@felix ~]<span class="comment"># echo felix&#123;01..10&#125; | xargs -n1 | sed -rn &#x27;s#(.*)#useradd \1;echo 123456 | passwd --stdin \1#gp&#x27; | bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># echo命令输出用户名 | xargs -n1 对输出的元素进行分组，每组一个元素 | 利用sed -n参数取消默认输出,-r参数支持ERE扩展元字符在这里指括号() 匹配所有，替换为 useradd \1取出所有已经分组的元素。此刻用户已经添加完毕;echo 123456 | passwd --stdin \1取出每位用户并从标准输入设置密码 接p打印结果。 | 将结果输出给bash</span></span><br><span class="line"></span><br><span class="line">输出：</span><br><span class="line">Changing password <span class="keyword">for</span> user felix01.</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br><span class="line">Changing password <span class="keyword">for</span> user felix02.</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br><span class="line">Changing password <span class="keyword">for</span> user felix03.</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br><span class="line">Changing password <span class="keyword">for</span> user felix04.</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br><span class="line">Changing password <span class="keyword">for</span> user felix05.</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br><span class="line">Changing password <span class="keyword">for</span> user felix06.</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br><span class="line">Changing password <span class="keyword">for</span> user felix07.</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br><span class="line">Changing password <span class="keyword">for</span> user felix08.</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br><span class="line">Changing password <span class="keyword">for</span> user felix09.</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br><span class="line">Changing password <span class="keyword">for</span> user felix10.</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br></pre></td></tr></table></figure>

<p><img src="/images/pasted-129.png" alt="14"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@felix ~]<span class="comment"># chage -l felix01</span></span><br><span class="line">Last password change					: Oct 17, 2019 &lt;==密码最近修改时间 2019-10-17  -d参数可控制该行</span><br><span class="line"></span><br><span class="line">Password expires					: never  &lt;==密码过期时间，从来不过期</span><br><span class="line">-M参数控制该行</span><br><span class="line"></span><br><span class="line">Password inactive					: never  &lt;==密码停权时间</span><br><span class="line">-l参数控制该行</span><br><span class="line"></span><br><span class="line">Account expires						: never  &lt;==账户过期时间 </span><br><span class="line">-E参数控制该行</span><br><span class="line"></span><br><span class="line">Minimum number of days between password change	: 0  &lt;==修改密码最小间隔天数 </span><br><span class="line">-m参数控制该行</span><br><span class="line"></span><br><span class="line">Maximum number of days between password change	: 99999  &lt;==最长时间  </span><br><span class="line">-M控制该行</span><br><span class="line"></span><br><span class="line">Number of days of warning before password expires	: 7 &lt;==密码过去提前几天进行警告 </span><br><span class="line">-W控制该行</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@felix ~]<span class="comment"># chage -E &quot;2020-10-1||$(date +%F -d&#x27;10day&#x27;)&quot; felix01  &lt;==修改账户过期时间，或十天后停权</span></span><br><span class="line">[root@felix ~]<span class="comment"># chage -l felix01</span></span><br><span class="line">Last password change					: Oct 17, 2019</span><br><span class="line">Password expires					: never</span><br><span class="line">Password inactive					: never</span><br><span class="line">Account expires						: Oct 01, 2020 *</span><br><span class="line">Minimum number of days between password change	: 0</span><br><span class="line">Maximum number of days between password change	: 99999</span><br><span class="line">Number of days of warning before password expires	: 7</span><br></pre></td></tr></table></figure>
<p><strong>其他用户相关命令：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">id</span> <span class="comment">#查看用户身份</span></span><br><span class="line"><span class="built_in">whoami</span> <span class="comment">#查看当前用户</span></span><br><span class="line">w <span class="comment">#查看所以登陆用户</span></span><br><span class="line">last <span class="comment">#显示登陆过的用户信息列表</span></span><br><span class="line">lastlog <span class="comment">#汇报最近货指定用户的登录情况</span></span><br></pre></td></tr></table></figure>
<p><strong>关于用户的骚操作：</strong><br><code>touch /etc/nologin</code> 执行该命令会禁止除了root用户以外的其他用户登录服务器只要是创建该文件即可，应用场景比如服务器维护时需要暂时禁止普通用户登录。</p>
<p><strong>GID</strong></p>
<p><img src="/images/pasted-130.png" alt="15"><br>相关配置文件：<code>/etc/group</code></p>
<p><img src="/images/pasted-131.png" alt="16"></p>
<p>用户身份切换su<br><img src="/images/pasted-132.png" alt="17"></p>
<p><code>su</code> 和 <code>su -</code>的区别<br><img src="/images/pasted-133.png" alt="18"><br>前者用户身份切换但环境变量没改变。</p>
<p><strong>sudo命令</strong><br><img src="/images/pasted-134.png" alt="18"></p>
<p>执行流程：</p>
<p><img src="/images/pasted-135.png" alt="19"><br>配置/ect/sudoers</p>
<ul>
<li>visudo</li>
<li>vim sudoers  &lt;==不推荐</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[felix01@felix ~]$ <span class="built_in">ls</span> /root</span><br><span class="line"><span class="built_in">ls</span>: cannot open directory /root: Permission denied</span><br><span class="line"></span><br><span class="line">[root@felix ~]<span class="comment"># visudo</span></span><br><span class="line">97 <span class="comment">## Allow root to run any commands anywhere</span></span><br><span class="line">98 root    ALL=(ALL)       ALL</span><br><span class="line">99 felix01 ALL=(ALL)       /bin/ls,/bin/cp</span><br><span class="line">    用户   主机=(角色)     命令（全路径 <span class="built_in">which</span>），多个命令用,隔开</span><br><span class="line">    </span><br><span class="line">99 felix   ALL=(ALL)       ALL  //相当于felix设置成管理员</span><br><span class="line">99 felix   ALL=(ALL)       NOPASSWD: ALL  //sudo去密码</span><br><span class="line">[root@felix ~]<span class="comment"># sudo su -</span></span><br><span class="line">Last login: Thu Oct 17 15:30:38 CST 2019 from 10.93.151.253 on pts/0</span><br><span class="line">[root@felix ~]<span class="comment">#</span></span><br><span class="line">禁止root远程连接</span><br><span class="line"></span><br><span class="line">[root@felix ~]<span class="comment"># ll /var/db/sudo/felix/1   &lt;==密码过期时间戳文件，默认5分钟过期</span></span><br><span class="line">-rw------- 1 root felix 48 2019-10-17 16:25 /var/db/sudo/felix/1</span><br><span class="line">[felix@felix ~]$ sudo -k  &lt;==清除时间戳，使sudo提示输入密码</span><br><span class="line">[felix@felix ~]$ sudo <span class="built_in">ls</span> /root</span><br><span class="line">[sudo] password <span class="keyword">for</span> felix: </span><br></pre></td></tr></table></figure>

<h1 id="RPM-YUM软件安装相关"><a href="#RPM-YUM软件安装相关" class="headerlink" title="RPM/YUM软件安装相关"></a>RPM/YUM软件安装相关</h1><p><img src="/images/pasted-187.png" alt="RPM/YUM"></p>
<h1 id="特殊字符-SHELL相关"><a href="#特殊字符-SHELL相关" class="headerlink" title="特殊字符/SHELL相关"></a>特殊字符/SHELL相关</h1><h2 id="特殊字符"><a href="#特殊字符" class="headerlink" title="特殊字符"></a>特殊字符</h2><p><strong>基本含义：</strong>通配符简单说就是键盘上的一些特殊字符，可以实现某些特殊的功能。<br><strong>例如：</strong>可以用*代表所有，来模糊搜索系统中的文件。<br><strong>作用：</strong>通配符适用范围是命令行中的[普通命令]或脚本编程中。</p>
<p><strong>第一组：</strong>模糊匹配<br><img src="/images/pasted-188.png" alt="模糊匹配"></p>
<p><strong>第二组：</strong>路径位置<br><img src="/images/pasted-189.png" alt="路径位置"></p>
<p><strong>第三组：</strong>引号相关<br><img src="/images/pasted-190.png" alt="引号相关"><br>坑：反引号解析出命令结果能被够一个命令调用，而双引号不行。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@lihuaning ~]<span class="comment"># tar -czf felix_$(date +%F).tar.gz felix &lt;==打包文件时通过$()解析命令给文件加上日期</span></span><br><span class="line">[root@lihuaning ~]<span class="comment"># ls</span></span><br><span class="line">felix_2019-10-09.tar.gz</span><br></pre></td></tr></table></figure>

<p><strong>第四组：</strong>其他字符<br><img src="/images/pasted-191.png" alt="其他字符"></p>
<h2 id="管道重定向"><a href="#管道重定向" class="headerlink" title="管道重定向"></a>管道重定向</h2><p> <strong>重定向</strong></p>
<ul>
<li>1&gt; 标准输出重定向 箭头方向就是数据流向，把左边的数据流向到右边，会覆盖之前的数据</li>
<li>1&gt;&gt; 追加输出重定向，内容追加到文件尾部</li>
<li>0&lt; 标准输入重定向 箭头方向就是数据流向，把右边的数据流向到右边，会覆盖之前的数据</li>
<li>0&lt;&lt; 追加输入重定向，内容追加到文件尾部（可配合EOF）</li>
<li>2&gt; 错误输出重定向，箭头方向就是数据流向，把左边的报错输出到右边（覆盖）</li>
<li>2&gt;&gt; 错误追加输出重定向（追加）</li>
<li>&lt;&lt;&lt; 将后面的内容作为前面命令的标准输入,用于处理变量</li>
</ul>
<p> <strong>特殊的重定向</strong><br>   将标准错误重定向到标准输出，即标准错误和标准输出一样重定向到文件中的三种方法</p>
<ul>
<li>方法1：<code>echo “I am felix” 1&gt;&gt;felix.txt 2&gt;&gt;felix.txt</code></li>
<li>方法2：<code>echo “I am felix” &amp;&gt;&gt;felix.txt</code></li>
<li>方法3：<code>echo “I am felix” &gt;&gt;felix 2&gt;&amp;1</code><br> 2&gt;&amp;1的意思就是将 标准错误输出和标准输出等价进行重定向</li>
</ul>
<p>  <strong>管道</strong><br>    定义：管道左边的命令的执行结果，通过管道交给右边命令进行再处理。<br>    <code>[root@f ~]# cat anaconda-ks.cfg | grep &quot;kexec&quot;</code> //没有实际意义<br>    正确方法如下：<br>    <code>[root@f ~]# grep &quot;kexec&quot; anaconda-ks.cfg</code> //少钻管道，提高效率</p>
<p><strong>示例</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@f felix]<span class="comment"># find ./ -name &quot;felix*&quot; -type f -mtime -3 -exec ls -l &#123;&#125; \;</span></span><br><span class="line">[root@f felix]<span class="comment"># find ./ -name &quot;felix*&quot; -type f -mtime -7 | xargs ls -l</span></span><br><span class="line">[root@f felix]<span class="comment"># find ./ -name &quot;felix*&quot; -type f | xargs rm -rf</span></span><br></pre></td></tr></table></figure>
<h2 id="Linux正则"><a href="#Linux正则" class="headerlink" title="Linux正则"></a>Linux正则</h2><p><img src="/images/pasted-192.png" alt="Linux正则"><br><strong>概念：</strong>作用和特殊字符一样，是为处理大量字符串及文本而定义的一套规则和方法，化繁为简。假设“@”代表“I am”，“!”代表“felix”，则执行。echo “@!”的结果就是输出“I am felix”。<br><strong>作用：</strong>提高效率，快速获取到想要的内容。适用于三剑客命令 grep（egrep），sed，awk。以行为单位进行处理。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@lihuaning ~]<span class="comment"># ifconfig ens3|sed -rn &#x27;2s#^.*inet (.*) net.*$#\1#gp&#x27;</span></span><br><span class="line">10.93.169.253</span><br></pre></td></tr></table></figure>
<p><strong>易混淆的事项：</strong></p>
<ol>
<li>和通配符区别</li>
<li>开发正则，一般是Perl兼容正则表达式</li>
<li>Linux系统的三剑客正则表达式*</li>
</ol>
<p><strong>环境准备：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">alias</span> grep=<span class="string">&#x27;grep --color=auto&#x27;</span>  &lt;==C6需要单独设置</span><br><span class="line">[root@lihuaning ~]<span class="comment"># export LC_ALL=C  &lt;==设置后，匹配操作不会出现匹配异常情况</span></span><br><span class="line">操作：</span><br><span class="line"><span class="built_in">cat</span> &gt;&gt;/etc/profile&lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">alias grep=&#x27;grep --color=auto&#x27;</span></span><br><span class="line"><span class="string">alias egrep=&#x27;egrep --color=auto&#x27;</span></span><br><span class="line"><span class="string">export LC_ALL=C</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> /etc/profile  &lt;==使修改内容生效</span><br></pre></td></tr></table></figure>
<p><strong>分类：</strong></p>
<ol>
<li>BRE（基本正则表达式）  grep</li>
<li>ERE（扩展正则表达式）  egrep</li>
</ol>
<h3 id="BRE"><a href="#BRE" class="headerlink" title="BRE"></a>BRE</h3><p><img src="/images/pasted-193.png" alt="BRE"><br><strong>BRE实践：</strong></p>
<ol>
<li>^以…开头的行</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@lihuaning felix]<span class="comment"># cat test.txt  &lt;==环境准别</span></span><br><span class="line">I am oldboy teacher!</span><br><span class="line">i teach linux</span><br><span class="line">I like badminton ball billiard ball and chinese chess</span><br><span class="line">oursiteishttp://www.oldboyedu.com</span><br><span class="line">my qq num is 49000448</span><br><span class="line">not49000e448.</span><br><span class="line">my god ,i am not oldbey, but OLDBOY</span><br><span class="line">[root@lihuaning felix]<span class="comment"># grep &quot;^n&quot; test.txt  &lt;==匹配以n开头的行</span></span><br><span class="line">not49000e448.</span><br><span class="line"></span><br><span class="line">过滤文件类型操作</span><br><span class="line">[root@lihuaning felix]<span class="comment"># ll  </span></span><br><span class="line">total 4</span><br><span class="line">drwxr-xr-x 2 root root   6 2019-10-09 16:24 1.txt</span><br><span class="line">drwxr-xr-x 2 root root   6 2019-10-09 16:24 2.txt</span><br><span class="line">drwxr-xr-x 2 root root   6 2019-10-09 16:24 3.txt</span><br><span class="line">drwxr-xr-x 2 root root   6 2019-10-09 16:24 4.txt</span><br><span class="line">-rw-r--r-- 1 root root   0 2019-10-09 16:24 a.txt</span><br><span class="line">-rw-r--r-- 1 root root   0 2019-10-09 16:24 b.txt</span><br><span class="line">-rw-r--r-- 1 root root   0 2019-10-09 16:24 c.txt</span><br><span class="line">-rw-r--r-- 1 root root   0 2019-10-09 16:24 d.txt</span><br><span class="line">-rw-r--r-- 1 root root   0 2019-10-09 18:19 est.txt</span><br><span class="line">-rw-r--r-- 1 root root 195 2019-10-09 22:01 test.txt</span><br><span class="line">drwxr-xr-x 2 root root   6 2019-10-09 16:23 text</span><br><span class="line">[root@lihuaning felix]<span class="comment"># ll | grep &quot;^d&quot; &lt;==过滤以d开头的文件，即过滤目录</span></span><br><span class="line">drwxr-xr-x 2 root root   6 2019-10-09 16:24 1.txt</span><br><span class="line">drwxr-xr-x 2 root root   6 2019-10-09 16:24 2.txt</span><br><span class="line">drwxr-xr-x 2 root root   6 2019-10-09 16:24 3.txt</span><br><span class="line">drwxr-xr-x 2 root root   6 2019-10-09 16:24 4.txt</span><br><span class="line">drwxr-xr-x 2 root root   6 2019-10-09 16:23 text</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>$以..结尾的行</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@lihuaning felix]<span class="comment"># grep -n &quot;m$&quot; test.txt &lt;==匹配以m结尾的行</span></span><br><span class="line">4:oursiteishttp://www.oldboyedu.com</span><br><span class="line">[root@lihuaning felix]<span class="comment"># grep -n &quot;\!$&quot; test.txt  &lt;==匹配以!结尾的行，\ 表示转义</span></span><br><span class="line">1:I am oldboy teacher!</span><br><span class="line"></span><br><span class="line">过滤目录操作</span><br><span class="line">[root@lihuaning felix]<span class="comment"># ll -F  &lt;==给目录后面加上反斜线</span></span><br><span class="line">total 4</span><br><span class="line">drwxr-xr-x 2 root root   6 2019-10-09 16:24 1.txt/</span><br><span class="line">drwxr-xr-x 2 root root   6 2019-10-09 16:24 2.txt/</span><br><span class="line">drwxr-xr-x 2 root root   6 2019-10-09 16:24 3.txt/</span><br><span class="line">drwxr-xr-x 2 root root   6 2019-10-09 16:24 4.txt/</span><br><span class="line">-rw-r--r-- 1 root root   0 2019-10-09 16:24 a.txt</span><br><span class="line">-rw-r--r-- 1 root root   0 2019-10-09 16:24 b.txt</span><br><span class="line">-rw-r--r-- 1 root root   0 2019-10-09 16:24 c.txt</span><br><span class="line">-rw-r--r-- 1 root root   0 2019-10-09 16:24 d.txt</span><br><span class="line">-rw-r--r-- 1 root root   0 2019-10-09 18:19 est.txt</span><br><span class="line">-rw-r--r-- 1 root root 195 2019-10-09 22:01 test.txt</span><br><span class="line">drwxr-xr-x 2 root root   6 2019-10-09 16:23 text/</span><br><span class="line">[root@lihuaning felix]<span class="comment"># ll -F | grep &quot;/$&quot;  &lt;==通过匹配以反斜线结尾的文件 找出目录</span></span><br><span class="line">drwxr-xr-x 2 root root   6 2019-10-09 16:24 1.txt/</span><br><span class="line">drwxr-xr-x 2 root root   6 2019-10-09 16:24 2.txt/</span><br><span class="line">drwxr-xr-x 2 root root   6 2019-10-09 16:24 3.txt/</span><br><span class="line">drwxr-xr-x 2 root root   6 2019-10-09 16:24 4.txt/</span><br><span class="line">drwxr-xr-x 2 root root   6 2019-10-09 16:23 text/</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>^$ 过滤空行</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@lihuaning felix]<span class="comment"># grep -n &quot;^$&quot; test.txt  &lt;==匹配空行</span></span><br><span class="line">4:</span><br><span class="line">7:</span><br><span class="line">[root@lihuaning felix]<span class="comment"># grep -nv &quot;^$&quot; test.txt  &lt;==通过-v参数取反输出，则去除了文件的空行</span></span><br><span class="line">1:I am oldboy teacher!</span><br><span class="line">2:i teach linux</span><br><span class="line">3:I like badminton ball billiard ball and chinese chess</span><br><span class="line">5:oursiteishttp://www.oldboyedu.com</span><br><span class="line">6:my qq num is 49000448</span><br><span class="line">8:not49000e448.</span><br><span class="line">9:my god ,i am not oldbey, but OLDBOY</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>. 表示匹配任意一个字符，有且只有一个。类似于通配符中的 ?</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@lihuaning felix]# grep &quot;.&quot; test.txt  &lt;==匹配到了任意字符，所有字符都匹配上了</span><br><span class="line">I am oldboy teacher!</span><br><span class="line">i teach linux</span><br><span class="line">I like badminton ball billiard ball and chinese chess</span><br><span class="line">oursiteishttp://www.oldboyedu.com</span><br><span class="line">my qq num is 49000448</span><br><span class="line">not49000e448.</span><br><span class="line">my god ,i am not oldbey, but OLDBOY</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>\ 表示转义</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@lihuaning felix]<span class="comment"># grep &quot;.$&quot; test.txt  &lt;==匹配以任意字符结尾的行</span></span><br><span class="line">I am oldboy teacher!</span><br><span class="line">i teach linux</span><br><span class="line">I like badminton ball billiard ball and chinese chess</span><br><span class="line">oursiteishttp://www.oldboyedu.com</span><br><span class="line">my qq num is 49000448</span><br><span class="line">not49000e448.</span><br><span class="line">my god ,i am not oldbey, but OLDBOY</span><br><span class="line">[root@lihuaning felix]<span class="comment"># grep &quot;\.$&quot; test.txt  &lt;==转意后 匹配以点结尾的行</span></span><br><span class="line">not49000e448.</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>* 表示重复前面字符 0次或多次</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@lihuaning felix]<span class="comment"># grep &quot;0*&quot; test.txt  &lt;==由于*表示匹配0次或多次，所以文件未匹配上的（即0次）也一并输出了</span></span><br><span class="line">I am oldboy teacher!</span><br><span class="line">i teach linux</span><br><span class="line">I like badminton ball billiard ball and chinese chess</span><br><span class="line"></span><br><span class="line">oursiteishttp://www.oldboyedu.com</span><br><span class="line">my qq num is 49000448</span><br><span class="line"></span><br><span class="line">not49000e448.</span><br><span class="line">my god ,i am not oldbey, but OLDBOY</span><br></pre></td></tr></table></figure>
<ol start="7">
<li>.*包含空行在内的所有行，加上-n参数显示所有行的行号 等价于cat -n</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@lihuaning felix]<span class="comment"># grep -n &quot;.*&quot; test.txt </span></span><br><span class="line">1:I am oldboy teacher!</span><br><span class="line">2:i teach linux</span><br><span class="line">3:I like badminton ball billiard ball and chinese chess</span><br><span class="line">4:</span><br><span class="line">5:oursiteishttp://www.oldboyedu.com</span><br><span class="line">6:my qq num is 49000448</span><br><span class="line">7:</span><br><span class="line">8:not49000e448.</span><br><span class="line">9:my god ,i am not oldbey, but OLDBOY</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>^.* 表示匹配以任意多个字符开头的行</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@lihuaning ~]<span class="comment"># grep &quot;^.*boy&quot; felix/test.txt  &lt;==匹配以任意字符开头 以boy结尾的行。相当于通配符里的 *boy</span></span><br><span class="line">I am oldboy teacher!</span><br><span class="line">oursiteishttp://www.oldboyedu.com</span><br></pre></td></tr></table></figure>

<ol start="9">
<li>.*$ 表示匹配以任意多个字符结尾的行</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@lihuaning ~]<span class="comment"># grep &quot;am.*$&quot; felix/test.txt  &lt;==匹配以任意字符结尾但开头是am 的行</span></span><br><span class="line">I am oldboy teacher!</span><br><span class="line">my god ,i am not oldbey, but OLDBOY</span><br></pre></td></tr></table></figure>

<ol start="10">
<li>[abc]匹配带有 或a或b或c任意一个的行</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@lihuaning ~]<span class="comment"># grep &quot;[qg]&quot; felix/test.txt  &lt;==匹配带有q 或者 g的行 ^不能用感叹号替换（会被当做字符）</span></span><br><span class="line">my qq num is 49000448</span><br><span class="line">my god ,i am not oldbey, but OLDBOY</span><br></pre></td></tr></table></figure>

<ol start="11">
<li>[^abc]取反</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@lihuaning ~]<span class="comment"># grep &quot;[^qg]&quot; felix/test.txt  &lt;==取反 或q或g</span></span><br><span class="line">I am oldboy teacher!</span><br><span class="line">i teach linux</span><br><span class="line">I like badminton ball billiard ball and chinese chess</span><br><span class="line">oursiteishttp://www.oldboyedu.com</span><br><span class="line">my qq num is 49000448</span><br><span class="line">not49000e448.</span><br><span class="line">my god ,i am not oldbey, but OLDBOY</span><br></pre></td></tr></table></figure>

<h3 id="ERE"><a href="#ERE" class="headerlink" title="ERE"></a>ERE</h3><p><img src="/images/pasted-194.png" alt="预定义特殊中括号"><br><img src="/images/pasted-195.png" alt="ERE"></p>
<ol>
<li>+匹配前一个字符一次或多次。贪婪模式，尽量往后匹配。</li>
</ol>
<p><img src="/images/pasted-196.png" alt="+匹配"></p>
<ol start="2">
<li>[字符1字符2] 匹配[]中的字符或l或x 一次或多次</li>
</ol>
<p><img src="/images/pasted-197.png" alt="字符1字符2"></p>
<ol start="3">
<li>? 匹配前一个字符0次或1次。</li>
</ol>
<p>?和*的区别</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">es?  0-1次  </span><br><span class="line">   e</span><br><span class="line">   es</span><br><span class="line"></span><br><span class="line">es*  0-n次</span><br><span class="line">   e</span><br><span class="line">   es</span><br><span class="line">   ess</span><br><span class="line">   essssss   </span><br></pre></td></tr></table></figure>
<p><img src="/images/pasted-198.png" alt="多次匹配"></p>
<ol start="4">
<li>| 或者 同时过滤多个字符串</li>
</ol>
<p><img src="/images/pasted-199.png" alt="过滤多个"></p>
<ol start="5">
<li>元字符</li>
</ol>
<p><code>egrep -o &quot;(0)(0)\1\2&quot; test.txt 等价于 egrep -o &quot;0000&quot; test.txt</code><br><img src="/images/pasted-200.png" alt="元字符"></p>
<p><img src="/images/pasted-201.png" alt="元字符"></p>
<ol start="6">
<li>\b 匹配单词边界 类似grep -w</li>
</ol>
<p><img src="/images/pasted-202.png" alt="\b"></p>
<ol start="7">
<li>\B 非单词边界匹配，即不匹配独立单词，而匹配非独立的单词</li>
</ol>
<p><img src="/images/pasted-203.png" alt="\B"></p>
<ol start="8">
<li>\d 匹配单个数字，需要配合grep -P Perl语言的正则</li>
</ol>
<p><img src="/images/pasted-204.png" alt="\d"></p>
<h2 id="Linux四剑客"><a href="#Linux四剑客" class="headerlink" title="Linux四剑客"></a>Linux四剑客</h2><ul>
<li>grep 过滤查找内容</li>
<li>sed 取行，替换，删除，追加</li>
<li>awk 取列</li>
<li>find 查找文件</li>
</ul>
<h3 id="awk"><a href="#awk" class="headerlink" title="awk"></a>awk</h3><p><img src="/images/pasted-205.png" alt="awk"><br><code>sed -n &#39;1,5p&#39; /etc/passwd &gt; a.txt</code> &lt;==用sed取出1-5行，重定向到a.txt<br><img src="/images/pasted-206.png" alt="awk-1"></p>
<p><code>awk -F &quot;:&quot; &#39;&#123;print $1&#125;&#39; a.txt</code> &lt;==指定分隔符后，{}中接动作 print 打印 $1表示第一列<br><img src="/images/pasted-207.png" alt="awk-2"><br>同上：逗号表示打印$1和$5，打印出的内容默认以空格分割。<br><img src="/images/pasted-208.png" alt="awk-3"><br>$1代表第一列，$2代表第二列，$0代表整行，$NF代表最后一列<br><img src="/images/pasted-209.png" alt="awk-4"></p>
<blockquote>
<p><strong>awk案例1</strong><br>打印1，3，最后一列<br><img src="/images/pasted-210.png" alt="案例1"><br>打印倒数第2列<br><code>awk -F &quot;:&quot; &#39;&#123;print $1,$3,$(NF-1)&#125;&#39; a.txt</code> &lt;==$(NF-1)代表倒数第二列<br><img src="/images/pasted-211.png" alt="案例1"></p>
</blockquote>
<blockquote>
<p><strong>awk案例2</strong><br><code>awk &#39;NR&gt;1&amp;&amp;NR&lt;4&#39; a.txt</code> &lt;==NR大于1（即从2开始）and NR小于4（即到3结束）结果取出2 3行，and取交集<br><code>awk &#39;NR==2,NR==3&#39; a.txt</code> &lt;==NR等于2 NR等于3 即取出2 3行<br><img src="/images/pasted-212.png" alt="案例2"></p>
</blockquote>
<blockquote>
<p><strong>awk案例3</strong><br><code>awk &#39;/root/&#39; a.txt</code>  &lt;==过滤只含root的行<br><img src="/images/pasted-213.png" alt="案例3"></p>
</blockquote>
<blockquote>
<p><strong>awk案例4</strong><br>awk过滤非 指定字符串的行<br><code>awk &#39;/^[^r]/&#39; a.txt</code>  &lt;==[]中 ^r 是指非r(取反操作)，括号外的^以什么什么开头，这里指过滤出以非r开头的行<br><img src="/images/pasted-214.png" alt="案例4"></p>
</blockquote>
<blockquote>
<p><strong>awk案例5</strong><br>awk取文件的第一列，第三列，最后一列并打印行号<br><code>awk -F &quot;:&quot;  &#39;&#123;print $1,$3,$NF&#125;&#39; a.txt | cat -n</code><br><img src="/images/pasted-215.png" alt="案例5"><br><code>awk -F &quot;:&quot;  &#39;&#123;print NR,$1,$3,$NF&#125;&#39; a.txt</code> &lt;==取第行号(NR),第一列($1),第二列($3),最后一列(NF)<br><img src="/images/pasted-216.png" alt="案例5"></p>
</blockquote>
<blockquote>
<p><strong>awk案例6</strong><br>awk取ifconfig ens3的IP地址<br><code>ifconfig ens3 | awk -F &quot; &quot; &#39;NR==2&#123;print $2&#125;&#39;</code> &lt;==-F指定分割符，NR定位到行号2，取出指定列$2<br><code>ifconfig ens3 | awk &#39;NR==2&#123;print $2&#125;&#39;</code> &lt;==同上，缺少-F（因为不指定-F即默认以空格作为分割符）<br><img src="/images/pasted-217.png" alt="案例6"></p>
</blockquote>
<blockquote>
<p><strong>多分隔符概念：</strong><br><code>echo --==--==--====-1.........2[[[[[[[3******4%%%%%%%5 | awk -F &quot;[-=.[*%]+&quot; &#39;&#123;print $3,$4&#125;&#39;</code> &lt;==-F参数指定分割符[]+，指的是将一堆括号内的符号看作一个分隔符，分隔符的左右两边分别是$n 和 $n+1<br>输出：2 3</p>
</blockquote>
<blockquote>
<p><strong>awk案例7</strong><br>过滤文件中第一列内容匹配root的字符串，把符合的行的最后一列输出<br><code>awk -F &quot;:&quot; &#39;$1~/root/&#123;print $NF&#125;&#39; a.txt</code> &lt;==第一列($1) 匹配到(~) root，就把匹配到的这一行的最后一列打印出来<br><img src="/images/pasted-218.png" alt="案例7"></p>
</blockquote>
<blockquote>
<p><strong>awk案例8</strong><br><code>awk -F &#39; &#39; &#39;$3&gt;80&#123;print $0&#125;&#39; c.txt</code>  &lt;==分数大于80的<br><code>awk -F &#39; &#39; &#39;$3==100&#123;print $0&#125;&#39; c.txt</code>  &lt;==分数等于100的<br><img src="/images/pasted-219.png" alt="案例8"></p>
</blockquote>
<p><strong>awk练习</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@lihuaning ~]<span class="comment"># cat a.txt </span></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line">adm:x:3:4:adm:/var/adm:/sbin/nologin</span><br><span class="line">lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin</span><br></pre></td></tr></table></figure>
<p>问题1：取test.txt文件的第2行到第3行的内容。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@lihuaning ~]# awk -F &quot;:&quot; &#x27;NR==2,NR==3&#123;print $0&#125;&#x27; a.txt </span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br></pre></td></tr></table></figure>
<p>问题2：过滤出含有root字符串的行※。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@lihuaning ~]# awk -F &quot;:&quot; &#x27;$1~/root/&#123;print $0&#125;&#x27; a.txt </span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br></pre></td></tr></table></figure>
<p>问题3：删除含有root字符串的行※。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@lihuaning ~]# awk -F &quot;:&quot; &#x27;$1~/[^root]/&#123;print $0&#125;&#x27; a.txt </span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line">adm:x:3:4:adm:/var/adm:/sbin/nologin</span><br><span class="line">lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin</span><br></pre></td></tr></table></figure>
<p>问题4：取文件的第一列、第三列和最后一列内容，并打印行号※。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@lihuaning ~]# awk -F &quot;:&quot; &#x27;&#123;print NR,$1,$3,$NF&#125;&#x27; a.txt </span><br><span class="line">1 root 0 /bin/bash</span><br><span class="line">2 bin 1 /sbin/nologin</span><br><span class="line">3 daemon 2 /sbin/nologin</span><br><span class="line">4 adm 3 /sbin/nologin</span><br><span class="line">5 lp 4 /sbin/nologin</span><br></pre></td></tr></table></figure>
<p>问题5：取出Linux中执行ifconfig eth0后对应的IP地址（只能输出IP地址）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@lihuaning ~]# ifconfig ens3 | awk -F &quot; &quot; &#x27;NR==2&#123;print $2&#125;&#x27;</span><br><span class="line">10.93.169.253</span><br></pre></td></tr></table></figure>
<p>问题6：过滤文件中第一列内容匹配root的字符串，把符合的行的最后一列输出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@lihuaning ~]# awk -F &quot;:&quot; &#x27;$1~/root/&#123;print $NF&#125;&#x27; a.txt </span><br><span class="line">/bin/bash</span><br></pre></td></tr></table></figure>
<p>问题7：过滤下列test1.txt文件中第三列内容分数大于70，并且小于95的人名和性别。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@lihuaning ~]# cat c.txt </span><br><span class="line">张三 男 80</span><br><span class="line">李四 女 70</span><br><span class="line">王五 男 88</span><br><span class="line">赵六 男 100</span><br><span class="line">[root@lihuaning ~]# awk -F &quot; &quot; &#x27;$3&gt;70&amp;&amp;$3&lt;95&#123;print $1,$2&#125;&#x27; c.txt </span><br><span class="line">张三 男</span><br><span class="line">王五 男</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>cut命令:</strong> 简单取列<br><code>cut -d&quot; &quot; -f2-6 a.txt</code> &lt;==-d指定分隔符，-f指定取第几列。也可用逗号，单个字符提取<br><img src="/images/pasted-220.png" alt="cut"><br><code>cut -c7-,1-5 felixis.txt</code> &lt;==取第7个字符到结尾，再取1-5五个字符<br><img src="/images/pasted-221.png" alt="cut"></p>
</blockquote>
<h3 id="sed"><a href="#sed" class="headerlink" title="sed"></a>sed</h3><p><img src="/images/pasted-222.png" alt="upload successful"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">复杂语法：</span><br><span class="line"><span class="string">&#x27;$&#x27;</span>    文件最后一行，</span><br><span class="line"><span class="string">&#x27;!&#x27;</span>     不进行</span><br><span class="line"><span class="string">&#x27;N&#x27;</span>    读入下一行并加入缓存尾；</span><br><span class="line"><span class="string">&#x27;;&#x27;</span>     语句分隔</span><br><span class="line"><span class="string">&#x27;/&#x27;</span>     查找（起始）</span><br><span class="line"><span class="string">&#x27;\n&#x27;</span>   换行符（转意写法）</span><br><span class="line"><span class="string">&#x27;Number&#x27;</span>    Number（字符序列）</span><br><span class="line"><span class="string">&#x27;/&#x27;</span>    （查找结束）</span><br><span class="line"><span class="string">&#x27;P&#x27;</span>    输出缓存中顺序第一字符到’\n<span class="string">&#x27;之间的字符序列</span></span><br><span class="line"><span class="string">&#x27;</span>D<span class="string">&#x27;    删除缓存中顺序第一字符到’\n&#x27;</span>之间的字符序列</span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;/abc/d;/efg/d&#x27;</span> a.txt &gt; a.log   删除abc或efg的行</span><br><span class="line">其中，<span class="string">&quot;abc&quot;</span>也可以用正则表达式来代替</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>sed案例1:</strong> 打印二到三行<br><code>sed -n &#39;2,3p&#39; test.txt</code> &lt;==取消默认输出<br><img src="/images/pasted-223.png" alt="案例1"></p>
</blockquote>
<blockquote>
<p><strong>sed案例2:</strong> 过滤出含有oldboy字符串的行※<br><code>sed -n &#39;/oldboy/p&#39; test.txt</code><br><img src="/images/pasted-224.png" alt="案例2"></p>
</blockquote>
<blockquote>
<p><strong>sed案例3:</strong> 删除含有oldboy字符串的行※<br><code>sed &#39;/oldboy/d&#39; test.txt</code> &lt;==未更改源文件<br><img src="/images/pasted-225.png" alt="案例3"><br>按行删除<br><code>sed  &#39;2d&#39; test.txt</code> &lt;==删除第二行 加-i写入文件;也可 ‘5,8d’ 删除5-8行<br><img src="/images/pasted-226.png" alt="案例3"></p>
</blockquote>
<blockquote>
<p><strong>sed案例4:</strong> 将文件中的oldboy字符串全部替换为oldgirl※<br>vim中的替换 :%s/oldboy/oldgirl/g<br><code>sed &#39;s/oldboy/oldgirl/g&#39; test.txt</code>  &lt;== -i 直接修改文件<br><img src="/images/pasted-227.png" alt="案例4"></p>
</blockquote>
<blockquote>
<p><strong>sed案例5:</strong> 一次性替换多次,替换oldboy为felix and 49000448为513247869<br><code>sed -e &#39;s/oldboy/felix/g&#39; -e &#39;s/49000448/513247869/g&#39; test.txt</code> &lt;==-e多次编辑,可通过-i 直接修改文件<br><img src="/images/pasted-228.png" alt="案例5"></p>
</blockquote>
<blockquote>
<p><strong>sed案例6:</strong> 追加 a 按行追加<br><code>sed &#39;2a woca&#39; test.txt</code>  &lt;==在第二行后面追加 wocao<br><img src="/images/pasted-229.png" alt="案例6"></p>
</blockquote>
<blockquote>
<p><strong>sed案例7:</strong> 插入 i 在指定行插入<br><code>sed &#39;2i wocacharu\n第二行\n第三行&#39; test.txt est.txt</code> &lt;== 加上\n 可插入多行<br><img src="/images/pasted-230.png" alt="案例7"></p>
</blockquote>
<p><strong>sed练习</strong><br>正则是贪婪匹配模式。</p>
<p><strong>ifconfig取ip</strong><br><img src="/images/pasted-231.png" alt="ifconfig"><br><code>ifconfig ens3 | sed -n 2p | sed &#39;s/^.*inet //g&#39; | sed &#39;s/  netm.*$//g&#39;</code><br>输出：10.93.169.253</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ifconfig ens3 &lt;===查看ens3网卡的配置信息</span><br><span class="line">sed -n 2p     &lt;===取出第2行</span><br><span class="line">sed &#x27;s/^.*inet //g&#x27;   &lt;===开始匹配以任意字符开头,匹配到(inet )后结束,并且替换为空(即删除匹配到的字符)</span><br><span class="line">sed &#x27;s/  netm.*$//g &lt;===继续匹配以(  netm)且任意字符结尾,并且替换为空(即删除匹配到的字符)</span><br></pre></td></tr></table></figure>
<p><strong>方法论：</strong><br>要取出目标,删除目标两边的,就得到了目标:先匹配上,然后再删除.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@lihuaning felix]<span class="comment"># ifconfig ens3 | sed -n 2p | sed -e &#x27;s/^.*inet //g&#x27; -e &#x27;s/  netm.*$//g&#x27;  &lt;===通过-e 进行多次编辑,减少了管道的使用</span></span><br><span class="line"></span><br><span class="line">[root@lihuaning felix]<span class="comment"># ifconfig ens3 | sed -ne &#x27;s/^.*inet //g&#x27; -e &#x27;s/  netm.*$//gp&#x27;  &lt;===通过-n 取消默认输出,再在结尾通过p输出已经匹配到的东西</span></span><br><span class="line"></span><br><span class="line">[root@lihuaning felix]<span class="comment"># ifconfig ens3 | sed -nr &#x27;2s#^.*inet (.*)  netmask.*$#\1#gp&#x27;  &lt;===通过\1将第一个括号里匹配到的东西通过p打印输出</span></span><br><span class="line">10.93.169.253</span><br><span class="line">ifconfig ens3  &lt;===查看ens3网卡配置信息</span><br><span class="line">sed -nr <span class="string">&#x27;2s#^.*inet (.*)  netmask.*$#\1#gp&#x27;</span>   &lt;== -n参数取消默认输出,-r参数支持ERE扩展元字符在这里指括号()。取出第二行,匹配出inet及其开头和netmask及其末尾,然后通过\n取出内容并替换为 (.*)所匹配到的ip,并它通过内置命令符p打印出来.</span><br></pre></td></tr></table></figure>

<p><strong>截取第四行 权限部分 不含0</strong><br><img src="/images/pasted-232.png" alt="qx"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@lihuaning felix]<span class="comment"># stat /etc/hosts | sed -nr &#x27;4s#^.*\(0([0-9]*)/-.*$#\1#gp&#x27;</span></span><br><span class="line">644</span><br></pre></td></tr></table></figure>

<p><strong>ip addr 取出ip</strong><br><img src="/images/pasted-233.png" alt="ip"></p>
<h3 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h3><p><img src="/images/pasted-234.png" alt="grep"></p>
<h3 id="find"><a href="#find" class="headerlink" title="find"></a>find</h3><p><strong>find命令</strong><br><strong>原理：</strong>磁盘遍历（速度慢）<br><strong>用法：</strong>按文件名查找：路径 名字(-name) “具体的文件*”<br><strong>参数：</strong></p>
<ul>
<li>-name 按文件名查找</li>
<li>-type 按文件类型查找</li>
<li>-exec 对查找的结果进行再处理</li>
<li>-mtime 按修改时间查找<ul>
<li>-4 表示文件更改时间距现在4天以内</li>
<li>+4 表示文件更改时间距现在4天以前</li>
<li>4 表示第4天<br><img src="/images/pasted-235.png" alt="find"></li>
<li>-perm 按权限查找<br><img src="/images/pasted-236.png" alt="find"></li>
<li>-a and 并且</li>
<li>-o or 或者</li>
<li>! 取反 放在哪个参数后面，就对该参数的结果取反</li>
</ul>
</li>
</ul>
<p><strong>示例：</strong></p>
<ol>
<li><code>find ~/felix -name &quot;felix*&quot; -type f  -exec ls -l &#123;&#125; \;</code>（{} 表占位符，将-exec之前处理的结果放入其中进行再处理，”;“作为结束标识符，考虑到各系统中分号会有不同的意义，所以前面要加反斜杠对分号进行转义。）</li>
<li><code>find / -type d[f] -name &quot;felix&quot;</code> 按文件类型查找，多参数并存取交集</li>
<li><code>find / -type d -o -name &quot;felix&quot;</code>  //-o参数取并集（结果匹配到了：所有目录 和 文件名为felix的文件）</li>
</ol>
<p><strong>xargs</strong><br>分组，或从标准输入执行命令</p>
<ul>
<li>-n数字 每个分组包含几个元素</li>
<li>-d”” 指定分隔符，不指定默认是空格</li>
<li>-i 把{}当作前面查找的结果</li>
</ul>
<p><strong>示例：</strong><br><code>find ./ -name &quot;felix*&quot; -type f | xargs -i cp &#123;&#125; /root/1/</code> //从标准输入执行命令</p>
<h2 id="SHELL脚本"><a href="#SHELL脚本" class="headerlink" title="SHELL脚本"></a>SHELL脚本</h2><h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p><strong>shell登录方式：</strong></p>
<ul>
<li>通过系统用户登录后默认运行的Shell</li>
<li>非登录交互式运行Shell（手动敲下bash或不需要输密码或远程ssh等操作）</li>
<li>执行脚本运行非交互式Shell</li>
</ul>
<p>正常登录时的加载顺序：<br><img src="/images/pasted-254.png" alt="load"></p>
<p><strong>父子shell问题：</strong><br>使用sh或bash或者默认执行脚本时，会开启一个子Shell运行，而使用source或者.执行脚本，则不会开子Shell，而是在同一个Shell里执行。</p>
<p>通过source或”.”点号加载执行过的脚本，由于是在当前Shell中执行脚本，因此在脚本结束后，脚本中的变量（包括函数）值在当前Shell中依然存在，而sh和bash执行脚本都会启动新的子Shell执行，执行完后退回到父Shell。所以，变量（包括函数）值等无法保留。</p>
<p>因此，在做Shell脚本开发时，如果脚本中有引用或执行其他脚本的内容或者配置文件的需求时，最好用“”点号或source先加载该脚本或配置文件，这样处理后，在加载脚本下面就可以调用source加载的脚本及配置文件中变量及函数等内容了。</p>
<p><strong>变量：</strong><br>环境变量：又称为全局变量</p>
<ul>
<li>内置环境变量</li>
<li>自定义环境变量</li>
</ul>
<p>查看：env命令<br><strong>定义：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">方法1:</span><br><span class="line">[root@Felix ~]<span class="comment"># export FELIX=1</span></span><br><span class="line">[root@Felix ~]<span class="comment"># echo $FELIX</span></span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">方法2：</span><br><span class="line">[root@Felix ~]<span class="comment"># QIAOMU=2</span></span><br><span class="line">[root@Felix ~]<span class="comment"># export QIAOMU  &lt;==不用export导出的话，就是普通变量</span></span><br><span class="line">[root@Felix ~]<span class="comment"># echo $QIAOMU</span></span><br><span class="line">2</span><br><span class="line"></span><br><span class="line">方法3：</span><br><span class="line">[root@Felix ~]<span class="comment"># declare -x FLX=3</span></span><br><span class="line">[root@Felix ~]<span class="comment"># echo $FLX</span></span><br><span class="line">3</span><br></pre></td></tr></table></figure>
<p>永久生效：可以放入/etc/bashrc中。</p>
<p><strong>取消：</strong>unset FLX<br><strong>注意：</strong>书写crond定时任务时要注意，脚本中用到的环境变量最好在执行的Shell脚本中重新定义。</p>
<p><strong>普通变量：</strong>又称为局部变量<br><strong>赋值方法：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">变量名=value   <span class="comment">#&lt;==赋值时不加引号。</span></span><br><span class="line">变量名=<span class="string">&#x27;value&#x27;</span>  <span class="comment">#&lt;==赋值时加单引号。</span></span><br><span class="line">变量名=<span class="string">&quot;value&quot;</span> <span class="comment">#&lt;==赋值时加双引号。</span></span><br><span class="line">变量名=`<span class="built_in">ls</span>`     <span class="comment">#&lt;==赋值时加反引号。</span></span><br></pre></td></tr></table></figure>
<p><strong>常规普通变量定义：</strong><br>变量内容为连续数字或字符串时赋值，变量内容两边可以不加引号，例如a=123。</p>
<ol>
<li><p>变量的内容很多，有空格且希望解析内容中的变量，就加双引号，例如a=”/etc/rc.local $USER”，此时输出变量会对内容中的$USER进行解析然后再输出。(ps：双引号解析变量)</p>
</li>
<li><p>希望原样输出变量的内容时就用单引号引起内容进行赋值，例如：a=’$USER’。（ps：单引号所见即所得）</p>
</li>
<li><p>希望变量内容是命令的解析结果的定义及赋值：(ps：$()或` `可以解析命令) 要使用反引号将赋值的命令括起来，例如：a=`ls`，或者用$() 括起来，例如：a=$(ls)。</p>
</li>
<li><p>{金庸新}著 天子心经（ps：{}大括号用于区分变量与字符串）</p>
</li>
</ol>
<p><strong>特殊的awk：</strong><br><img src="/images/pasted-255.png" alt="awk"></p>
<p><strong>变量总结：</strong></p>
<ol>
<li>变量名<br>变量名组成、定义规范</li>
<li>等号<br>赋值符，两边不能有空格</li>
<li>变量内容<br>单引号(所见即所得)、双引号(解析变量)、反引号(解析命令)、不加引号(连续的数字或字符串赋值)</li>
<li>输出<br>用echo 或 printf<br>变量名加$符号，如果变量后面有内容，用{}引用变量部分。</li>
</ol>
<h3 id="特殊变量"><a href="#特殊变量" class="headerlink" title="特殊变量"></a>特殊变量</h3><p><img src="/images/pasted-263.png" alt="特殊变量"><br><strong>常用特殊位置变量：</strong></p>
<ul>
<li>$0 获取当前执行Shell脚本文件名，如果执行脚本带路径，那么就包括脚本路径</li>
<li>$n 获取当前执行的shell脚本的第n个参数值，n=1..9，当n为0时表示脚本的文件名，如果n大于9，则用大括号括起来，例如${10}，防止金庸新的情况出现，接的参数以空格隔开</li>
<li>$# 获取当前执行的shell脚本后面接的参数的总个数</li>
<li>$* 获取当前执行的shell脚本的所有参数，但是将所有参数视为一个单个字符串”$1 $2 $3”</li>
<li>$@ 获取当前执行的shell脚本的所有参数，但是将所有参数是为独立字符串”$1” “$2” “$3”</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@db02 ~]<span class="comment"># set -- &quot;I am&quot; itsix felix</span></span><br><span class="line">[root@db02 ~]<span class="comment"># echo $1</span></span><br><span class="line">I am</span><br><span class="line">[root@db02 ~]<span class="comment"># echo $2</span></span><br><span class="line">itsix</span><br><span class="line">[root@db02 ~]<span class="comment"># echo $3</span></span><br><span class="line">felix</span><br><span class="line">[root@db02 ~]<span class="comment"># echo $#</span></span><br><span class="line">3</span><br><span class="line">[root@db02 ~]<span class="comment"># echo $*</span></span><br><span class="line">I am itsix felix</span><br><span class="line">[root@db02 ~]<span class="comment"># echo $@</span></span><br><span class="line">I am itsix felix</span><br></pre></td></tr></table></figure>
<p><strong>shell进程特殊状态变量</strong></p>
<ul>
<li>$? 获取执行上一个指令的执行状态返回值（0为成功，非零为失败），这个变量最常用</li>
<li>$$ 获取当前执行的shell脚本的进程号（PID），这个变量不常用，了解即可</li>
<li>$! 获取上一个在后台工作的进程的进程号（PID），这个变量不常用，了解即可</li>
<li>$_ 获取在此之前执行的命令或脚本的最后一个参数，这个变量不常用，了解即可</li>
</ul>
<h3 id="变量子串"><a href="#变量子串" class="headerlink" title="变量子串"></a>变量子串</h3><p><img src="/images/pasted-264.png" alt="变量子串"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;parameter&#125;</span>返回变量<span class="variable">$parameter</span>的内容</span><br><span class="line"><span class="variable">$&#123;#parameter&#125;</span> 返回变量<span class="variable">$parameter</span>内容的长度（按字符），也适合特殊变量*</span><br><span class="line"><span class="variable">$&#123;parameter:offset&#125;</span>在变量<span class="variable">$&#123;parameter&#125;</span>中，从位置offset之后开始提取子串到结尾</span><br><span class="line"><span class="variable">$&#123;parameter:offset:length&#125;</span>在变量<span class="variable">$&#123;parameter&#125;</span>中，从位置offset之后开始提取长度为length的子串</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@db02 ~]<span class="comment"># echo $&#123;OLDBOY&#125;</span></span><br><span class="line">I am oldboy</span><br><span class="line">[root@db02 ~]<span class="comment"># echo $&#123;#OLDBOY&#125;  &lt;==返回变量内容长度。**</span></span><br><span class="line">11</span><br><span class="line">[root@db02 ~]<span class="comment"># echo $&#123;OLDBOY:5:3&#125;  &lt;==从第五个字符开始，往后取三个字符。**</span></span><br><span class="line">old</span><br></pre></td></tr></table></figure>

<p><strong>字串应用-删除</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#从开头删除</span></span><br><span class="line"><span class="variable">$&#123;parameter#word&#125;</span>		从变量<span class="variable">$&#123;parameter&#125;</span>【开头】开始删除最【短】匹配的word子串</span><br><span class="line"><span class="variable">$&#123;parameter##word&#125;</span>		从变量<span class="variable">$&#123;parameter&#125;</span>【开头】开始删除最【长】匹配的word子串</span><br></pre></td></tr></table></figure>
<p><img src="/images/pasted-256.png" alt="delete"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#从结尾删除</span></span><br><span class="line"><span class="variable">$&#123;parameter%word&#125;</span>		从变量<span class="variable">$&#123;parameter&#125;</span>结尾开始删除最短匹配的word子串</span><br><span class="line"><span class="variable">$&#123;parameter%%word&#125;</span>		从变量<span class="variable">$&#123;parameter&#125;</span>结尾开始删除最长匹配的word子串</span><br></pre></td></tr></table></figure>
<p><img src="/images/pasted-257.png" alt="delete"><br><strong>删除小结：</strong></p>
<ul>
<li>#表示从开头删除匹配最短。</li>
<li>##表示从开头删除匹配最长。</li>
<li>%表示从结尾删除匹配最短。</li>
<li>%%表示从结尾删除匹配最长。</li>
<li>a*c表示匹配的字符串，<em>匹配所有，a</em>c匹配开头为a中间任意多个字符结尾为c的。</li>
<li>a*C表示匹配的字符串，<em>匹配所有，a</em>C匹配开头为a中间任意多个字符结尾为C的。<br>口诀：一个匹配删除最短，两个匹配删除最长</li>
</ul>
<p><strong>字串应用-替换</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#类似sed替换</span></span><br><span class="line"><span class="variable">$&#123;parameter/pattern/string&#125;</span>	    使用string代替第一个匹配的pattern</span><br><span class="line"><span class="variable">$&#123;parameter//pattern/string&#125;</span>	使用string代替所有匹配的pattern</span><br><span class="line">[root@db02 ~]<span class="comment"># OLDBOY=&quot;I am Felix. yes. Felix.&quot;</span></span><br><span class="line">[root@db02 ~]<span class="comment"># echo $OLDBOY</span></span><br><span class="line">I am Felix. <span class="built_in">yes</span>. Felix.</span><br><span class="line">[root@db02 ~]<span class="comment"># echo $&#123;OLDBOY/Felix/bangbang&#125;</span></span><br><span class="line">I am bangbang. <span class="built_in">yes</span>. Felix.</span><br><span class="line">[root@db02 ~]<span class="comment"># echo $&#123;OLDBOY//Felix/bangbang&#125;</span></span><br><span class="line">I am bangbang. <span class="built_in">yes</span>. bangbang.</span><br></pre></td></tr></table></figure>

<p><strong>获取变量内容长度的方法：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$OLDBOY</span>|<span class="built_in">wc</span> -L</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;#OLDBOY&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">expr</span> length <span class="string">&quot;<span class="variable">$OLDBOY</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$OLDBOY</span>|awk <span class="string">&#x27;&#123;print length&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$OLDBOY</span>|awk <span class="string">&#x27;&#123;print length($0)&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>练习：句子中小于6个字符的单词打印出来</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Whatever is worth doing is worth doing well.</span><br><span class="line">[root@db02 ~]<span class="comment"># sh ww.sh </span></span><br><span class="line">is</span><br><span class="line">worth</span><br><span class="line">doing</span><br><span class="line">is</span><br><span class="line">worth</span><br><span class="line">doing</span><br><span class="line">well.</span><br><span class="line">[root@db02 ~]<span class="comment"># cat ww.sh </span></span><br><span class="line">judge=<span class="string">&quot;Whatever is worth doing is worth doing well.&quot;</span></span><br><span class="line"><span class="keyword">for</span> word <span class="keyword">in</span> <span class="variable">$judge</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$&#123;#word&#125;</span> -lt 6 ]</span><br><span class="line">  <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$word</span>&quot;</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<h3 id="特殊扩展变量"><a href="#特殊扩展变量" class="headerlink" title="特殊扩展变量"></a>特殊扩展变量</h3><p><img src="/images/pasted-258.png" alt="Shell特殊扩展变量"></p>
<p><img src="/images/pasted-265.png" alt="特殊扩展变量"><br><code>$&#123;parameter:-word&#125;</code>：主胎不在家，备胎启用<br><strong>解释：</strong>如果parameter 变量值为空或未赋值，就会返回word字符串替代变量的值。*<br><strong>用途：</strong>如果变量未定义，则返回备用的值，防止变量为空值或未定义而导致异常。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@db02 ~]<span class="comment"># test=feichi</span></span><br><span class="line">[root@db02 ~]<span class="comment"># echo $test</span></span><br><span class="line">feichi</span><br><span class="line">[root@db02 ~]<span class="comment"># result=$&#123;test:-gun&#125;  &lt;==test变量存在，所有内容保持不变</span></span><br><span class="line">[root@db02 ~]<span class="comment"># echo $result</span></span><br><span class="line">feichi</span><br><span class="line">[root@db02 ~]<span class="comment"># unset test  &lt;==删除该变量</span></span><br><span class="line">[root@db02 ~]<span class="comment"># echo $test</span></span><br><span class="line"></span><br><span class="line">[root@db02 ~]<span class="comment"># result=$&#123;test:-gun&#125;  &lt;==test变量未定义或为空，被替换成gun</span></span><br><span class="line">[root@db02 ~]<span class="comment"># echo $result</span></span><br><span class="line">gun</span><br><span class="line">[root@db02 ~]<span class="comment"># echo $test</span></span><br></pre></td></tr></table></figure>

<p><code>$&#123;parameter:=word&#125;</code>：主胎不在家，备胎转正<br><strong>解释：</strong>如果parameter变量值为空或未赋值，就设置这个变量值为word，并返回其值。位置变量和特殊变量不适用。<br><strong>用途：</strong>基本同上一个${parameter:-word}，但是又额外给parameter变量赋值了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@db02 ~]<span class="comment"># felix=feichi</span></span><br><span class="line">[root@db02 ~]<span class="comment"># echo $felix</span></span><br><span class="line">feichi</span><br><span class="line">[root@db02 ~]<span class="comment"># result=$&#123;felix:=513247869&#125;  &lt;==主胎在家，备胎未转正</span></span><br><span class="line">[root@db02 ~]<span class="comment"># echo $result</span></span><br><span class="line">feichi</span><br><span class="line">[root@db02 ~]<span class="comment"># echo $felix</span></span><br><span class="line">feichi</span><br><span class="line">[root@db02 ~]<span class="comment"># unset felix  &lt;==删除该变量</span></span><br><span class="line">[root@db02 ~]<span class="comment"># echo $felix</span></span><br><span class="line"></span><br><span class="line">[root@db02 ~]<span class="comment"># result=$&#123;felix:=513247869&#125;  &lt;==主胎不在家，备胎转正</span></span><br><span class="line">[root@db02 ~]<span class="comment"># echo $felix</span></span><br><span class="line">513247869</span><br><span class="line">[root@db02 ~]<span class="comment"># echo $result</span></span><br><span class="line">513247869</span><br></pre></td></tr></table></figure>
<p><code>$&#123;parameter:?word&#125;</code>：主胎不在，直接报错<br><strong>解释：</strong>如果parameter 变量值为空或未赋值，word字符串将被作为标准错误输出，否则输出变量的值。<br><strong>用途：</strong>用于捕捉由于变量未定义而导致的错误，并退出程序。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@db02 ~]<span class="comment"># felix=feichi</span></span><br><span class="line">[root@db02 ~]<span class="comment"># echo $felix</span></span><br><span class="line">feichi</span><br><span class="line">[root@db02 ~]<span class="comment"># echo $&#123;felix:?error wocao&#125;  &lt;==主胎在，输出主胎</span></span><br><span class="line">feichi</span><br><span class="line">[root@db02 ~]<span class="comment"># unset felix</span></span><br><span class="line">[root@db02 ~]<span class="comment"># echo $&#123;felix:?error wocao&#125;  &lt;==主胎不在，将?后的字符当error输出</span></span><br><span class="line">bash: felix: error wocao</span><br></pre></td></tr></table></figure>

<p><code>$&#123;parameter:+word&#125;</code>：主胎在家，+后面的字符进行替换 来抢</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@db02 ~]<span class="comment"># echo $felix</span></span><br><span class="line"></span><br><span class="line">[root@db02 ~]<span class="comment"># result=$&#123;felix:+dengao&#125;  &lt;==felix变量为空，什么都不干</span></span><br><span class="line">[root@db02 ~]<span class="comment"># echo $felix</span></span><br><span class="line"></span><br><span class="line">[root@db02 ~]<span class="comment"># echo $result</span></span><br><span class="line"></span><br><span class="line">[root@db02 ~]<span class="comment"># felix=feichi</span></span><br><span class="line">[root@db02 ~]<span class="comment"># echo $felix</span></span><br><span class="line">feichi</span><br><span class="line">[root@db02 ~]<span class="comment"># result=$&#123;felix:+dengao&#125;  &lt;==felix定义了内容，+后面的字符将其替换但不改变felix变量内的内容</span></span><br><span class="line">[root@db02 ~]<span class="comment"># echo $result</span></span><br><span class="line">dengao</span><br><span class="line">[root@db02 ~]<span class="comment"># echo $felix</span></span><br><span class="line">feichi</span><br></pre></td></tr></table></figure>

<h3 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h3><p><strong>运算符：</strong><br><code>+、- </code>：        加、减*<br><code>*、/、%</code>：    乘法、除法、取余（取模）*<br><code>**</code>：        幂运算<br><code>++、--</code>：    增加及减少，可前置也可放在变量结尾，默认步长为1 如123，321<br><code>!、&amp;&amp;、||</code>：    逻辑非(取反)、逻辑与(and)、逻辑或(or)*<br><code>&lt;、&lt;=、&gt;、&gt;=</code>：比较符号（小于、小于等于、大于、大于等于）<br><code>==、!=、=</code>：    比较符号（相等、不相等、对于字符串“=”也可以表示相等）*<br><code>&lt;&lt;、&gt;&gt;</code>：    向左移位、向右移位<br><code>~、|、&amp;、^</code>：    按位取反、按位异或、按位与、按位或<br><code>=、+=、-=、*=、/=、%=</code>:    赋值运算符，例如a+=1相当a=a+1，a-=1相当a=a-1*</p>
<p><strong>shell常见运算命令：</strong><br><img src="/images/pasted-259.png" alt="运算命令"><br><strong>数值运算：</strong><br>1）整数运算：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">方法1：<span class="built_in">let</span></span><br><span class="line">[root@db02 ~]<span class="comment"># a=1</span></span><br><span class="line">[root@db02 ~]<span class="comment"># let a=a+1</span></span><br><span class="line">[root@db02 ~]<span class="comment"># echo $a</span></span><br><span class="line">2</span><br><span class="line"></span><br><span class="line">方法2：(())</span><br><span class="line">[root@db02 ~]<span class="comment"># a=1</span></span><br><span class="line">[root@db02 ~]<span class="comment"># ((a=a+1))</span></span><br><span class="line">[root@db02 ~]<span class="comment"># echo $a</span></span><br><span class="line">2</span><br><span class="line"></span><br><span class="line">方法3：<span class="built_in">expr</span></span><br><span class="line">[root@db02 ~]<span class="comment"># a=10</span></span><br><span class="line">[root@db02 ~]<span class="comment"># expr $a + 10</span></span><br><span class="line">20</span><br><span class="line">[root@db02 ~]<span class="comment"># a=`expr $a + 10`</span></span><br><span class="line">[root@db02 ~]<span class="comment"># echo $a</span></span><br><span class="line">20</span><br><span class="line"></span><br><span class="line">方法4：$[]</span><br><span class="line">[root@db02 ~]<span class="comment"># a=11</span></span><br><span class="line">[root@db02 ~]<span class="comment"># echo $[a+11]</span></span><br><span class="line">22</span><br><span class="line">[root@db02 ~]<span class="comment"># c=$[a+11]</span></span><br><span class="line">[root@db02 ~]<span class="comment"># echo $c</span></span><br><span class="line">22</span><br><span class="line"></span><br><span class="line">方法5：<span class="built_in">declare</span></span><br><span class="line">[root@db02 ~]<span class="comment"># a=8</span></span><br><span class="line">[root@db02 ~]<span class="comment"># declare -i a=a+10</span></span><br><span class="line">[root@db02 ~]<span class="comment"># echo $a</span></span><br><span class="line">18</span><br><span class="line"></span><br><span class="line">案例：</span><br><span class="line">[root@db02 ~]<span class="comment"># ((a=1+2**3-4%3))</span></span><br><span class="line">[root@db02 ~]<span class="comment"># echo $a</span></span><br><span class="line">8</span><br></pre></td></tr></table></figure>

<p><strong>2）整数或者小数运算</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">方法1：bc</span><br><span class="line">[root@db02 ~]<span class="comment"># echo 10+9|bc #加</span></span><br><span class="line">19</span><br><span class="line">[root@db02 ~]<span class="comment"># echo 10*9|bc #乘</span></span><br><span class="line">90</span><br><span class="line">[root@db02 ~]<span class="comment"># echo 10/9|bc #除</span></span><br><span class="line">1</span><br><span class="line">[root@db02 ~]<span class="comment"># echo &quot;scale=4;10/9&quot;|bc #保留4位小数</span></span><br><span class="line">1.1111</span><br><span class="line">[root@db02 ~]<span class="comment"># echo 3^2|bc  #幂运算</span></span><br><span class="line">9</span><br><span class="line">[root@db02 ~]<span class="comment"># echo 1.1*2|bc  #小数乘</span></span><br><span class="line">2.2</span><br><span class="line"></span><br><span class="line">方法2：awk</span><br><span class="line">[root@db02 ~]<span class="comment"># echo 1.1 2 | awk &#x27;&#123;print $1*$2&#125;&#x27;</span></span><br><span class="line">2.2</span><br><span class="line">[root@db02 ~]<span class="comment"># echo 1.1 2 | awk &#x27;&#123;print $1%$2&#125;&#x27;</span></span><br><span class="line">1.1</span><br><span class="line">[root@db02 ~]<span class="comment"># echo 4 2 | awk &#x27;&#123;print $1%$2&#125;&#x27;</span></span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<p><strong>3）自增或自减运算（++--）</strong><br>执行echo $((a++))和echo $((a–))命令输出整个表达式时，输出的值为a的值，表达式执行完毕后，会对a进行++、–的运算，<br>执行echo $((++a))和echo $((–a))命令输出整个表达式时，会先对a进行++、–的运算，然后再输出表达式的值，即为a运算后的值。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@db02 ~]<span class="comment"># a=10</span></span><br><span class="line">[root@db02 ~]<span class="comment"># echo $((a--))  &lt;== --在$a后，表达式先不减。表达式执行完成会对$a进行++ --运算。</span></span><br><span class="line">10</span><br><span class="line">[root@db02 ~]<span class="comment"># echo $a</span></span><br><span class="line">9</span><br><span class="line">[root@db02 ~]<span class="comment"># echo $((--a)) &lt;== --在$a前，先对$a进行运算。表达式在输出值。</span></span><br><span class="line">8</span><br><span class="line">[root@db02 ~]<span class="comment"># echo $a</span></span><br><span class="line">8</span><br></pre></td></tr></table></figure>
<p>有关++，–运算的记忆方法：<br>变量a在运算符前，输出表达式的值为a，然后a自增或自减；变量a在运算符后，输出表达式会先自增或自减，表达式的值就是自增或自减后a的值。</p>
<p><strong>4）(())的逻辑判断</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@web01 /server/scripts]<span class="comment"># ((8&gt;7))</span></span><br><span class="line">[root@web01 /server/scripts]<span class="comment"># echo $?</span></span><br><span class="line">0</span><br><span class="line">[root@web01 /server/scripts]<span class="comment"># ((8&lt;7))</span></span><br><span class="line">[root@web01 /server/scripts]<span class="comment"># echo $?</span></span><br><span class="line">1</span><br><span class="line">[root@web01 /server/scripts]<span class="comment"># ((8&lt;7&amp;&amp;6&gt;5))</span></span><br><span class="line">[root@web01 /server/scripts]<span class="comment"># echo $?</span></span><br><span class="line">1</span><br><span class="line">[root@web01 /server/scripts]<span class="comment"># ((8&lt;9&amp;&amp;6&gt;5))</span></span><br><span class="line">[root@web01 /server/scripts]<span class="comment"># echo $?</span></span><br><span class="line">0</span><br><span class="line">[root@web01 /server/scripts]<span class="comment"># ((8&lt;7||6&gt;5))</span></span><br><span class="line">[root@web01 /server/scripts]<span class="comment"># echo $?</span></span><br></pre></td></tr></table></figure>
<p><strong>5）expr功能：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">1.计算</span><br><span class="line">[root@web01 /server/scripts]<span class="comment"># expr 10 + 10</span></span><br><span class="line">20</span><br><span class="line"></span><br><span class="line">2.获取字符串长度</span><br><span class="line">[root@db02 ~]<span class="comment"># a=&quot;felix&quot;</span></span><br><span class="line">[root@db02 ~]<span class="comment"># echo $a</span></span><br><span class="line">felix</span><br><span class="line">[root@db02 ~]<span class="comment"># expr length $a</span></span><br><span class="line">5</span><br><span class="line"></span><br><span class="line">3.判断字符串是否为整数数字或字符</span><br><span class="line">[root@web01 /server/scripts]<span class="comment"># a=1</span></span><br><span class="line">[root@web01 /server/scripts]<span class="comment"># expr $a + 1 &amp;&gt;/dev/null</span></span><br><span class="line">[root@web01 /server/scripts]<span class="comment"># echo $?</span></span><br><span class="line">0 </span><br><span class="line">[root@web01 /server/scripts]<span class="comment"># a=oldboy</span></span><br><span class="line">[root@web01 /server/scripts]<span class="comment"># expr $a + 1 &amp;&gt;/dev/null</span></span><br><span class="line">[root@web01 /server/scripts]<span class="comment"># echo $?</span></span><br><span class="line">2  &lt;==逆向思维：<span class="built_in">expr</span>字符串或小数与整数相加会报错，即$? 不为0. 即$?为0</span><br><span class="line">              就表示 两边运算符两边都是整数数，而不是字符串或浮点数</span><br><span class="line">              </span><br><span class="line">4.用来判断文件扩展名是否符合指定扩展名</span><br><span class="line">[root@web01 /server/scripts]<span class="comment"># cat judge.sh </span></span><br><span class="line">  <span class="keyword">if</span> <span class="built_in">expr</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> : <span class="string">&quot;.*\.avi$&quot;</span> &gt;/dev/null ; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;好兴奋啊&quot;</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;好失望啊&quot;</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">[root@web01 /server/scripts]<span class="comment"># sh judge.sh oldboy.avi</span></span><br><span class="line">好兴奋啊</span><br><span class="line">[root@web01 /server/scripts]<span class="comment"># sh judge.sh oldboy.log</span></span><br><span class="line">好失望啊</span><br></pre></td></tr></table></figure>

<h3 id="脚本传参"><a href="#脚本传参" class="headerlink" title="脚本传参"></a>脚本传参</h3><p><img src="/images/pasted-266.png" alt="脚本传参"><br><strong>read命令：</strong><br>参数：</p>
<ul>
<li>-p：输出文字提示</li>
<li>-t：指定超时时间</li>
</ul>
<p>本质：交互式给变量赋值<br><strong>例：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1）相当于n=100</span><br><span class="line">[root@db02 ~]<span class="comment"># read -p &quot;请输入一个数字：&quot; n</span></span><br><span class="line">请输入一个数字：100</span><br><span class="line">[root@db02 ~]<span class="comment"># echo $n</span></span><br><span class="line">100</span><br><span class="line">2）相当于n=90 m=100</span><br><span class="line">[root@db02 ~]<span class="comment"># read -p &quot;请输入两个数字：&quot; n m</span></span><br><span class="line">请输入两个数字：90 100</span><br><span class="line">[root@db02 ~]<span class="comment"># echo $n $m</span></span><br><span class="line">90 100</span><br></pre></td></tr></table></figure>
<p><strong>变量赋值的3种方式：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">1.定义式</span><br><span class="line">a=1</span><br><span class="line"></span><br><span class="line">2.<span class="built_in">read</span>读入式</span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;请输入两个数字：&quot;</span> n m</span><br><span class="line"></span><br><span class="line">3.脚本传参</span><br><span class="line"><span class="variable">$1</span>=100</span><br><span class="line"></span><br><span class="line">1.交互式传参：</span><br><span class="line">[root@db02 ~]<span class="comment"># cat 01.dingyi.sh </span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;请输入a,b的值：&quot;</span> a b</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span>+<span class="variable">$b</span>=<span class="subst">$((a+b)</span>)&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span>-<span class="variable">$b</span>=<span class="subst">$((a-b)</span>)&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span>*<span class="variable">$b</span>=<span class="subst">$((a*b)</span>)&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span>/<span class="variable">$b</span>=<span class="subst">$((a/b)</span>)&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span>**<span class="variable">$b</span>=<span class="subst">$((a**b)</span>)&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span>%<span class="variable">$b</span>=<span class="subst">$((a%b)</span>)&quot;</span></span><br><span class="line">[root@db02 ~]<span class="comment"># sh 01.dingyi.sh</span></span><br><span class="line">请输入a,b的值：9 10</span><br><span class="line">9+10=19</span><br><span class="line">9-10=-1</span><br><span class="line">9*10=90</span><br><span class="line">9/10=0</span><br><span class="line">9**10=3486784401</span><br><span class="line">9%10=9</span><br><span class="line"></span><br><span class="line">2.传参：</span><br><span class="line">[root@db02 ~]<span class="comment"># cat 01.dingyi.sh</span></span><br><span class="line">a=<span class="variable">$1</span></span><br><span class="line">b=<span class="variable">$2</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span>+<span class="variable">$b</span>=<span class="subst">$((a+b)</span>)&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span>-<span class="variable">$b</span>=<span class="subst">$((a-b)</span>)&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span>*<span class="variable">$b</span>=<span class="subst">$((a*b)</span>)&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span>/<span class="variable">$b</span>=<span class="subst">$((a/b)</span>)&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span>**<span class="variable">$b</span>=<span class="subst">$((a**b)</span>)&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span>%<span class="variable">$b</span>=<span class="subst">$((a%b)</span>)&quot;</span></span><br><span class="line">[root@db02 ~]<span class="comment"># bash 01.dingyi.sh 7 6</span></span><br><span class="line">7+6=13</span><br><span class="line">7-6=1</span><br><span class="line">7*6=42</span><br><span class="line">7/6=1</span><br><span class="line">7**6=117649</span><br><span class="line">7%6=1</span><br></pre></td></tr></table></figure>

<blockquote>
<p>`stty erase ‘^H’` read -p “input: “ read交互式删除退格</p>
</blockquote>
<h3 id="条件测试"><a href="#条件测试" class="headerlink" title="条件测试"></a>条件测试</h3><p><img src="/images/pasted-260.png" alt="条件测试"><br>一句话定义：判断符合条件才进行处理，不符合条件不处理。<br><strong>表达式1：如果条件成立，那么执行三个命令。</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[ 条件1 ] &amp;&amp; &#123;</span><br><span class="line">    命令1     </span><br><span class="line">	命令2     </span><br><span class="line">	命令3 </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>表达式2：如果表达式不成立，那么执行三个命令。</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ 条件1 ]   </span><br><span class="line"><span class="keyword">then</span>     </span><br><span class="line">	命令1     </span><br><span class="line">	命令2     </span><br><span class="line">	命令3 </span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">【等价】</span><br><span class="line">[ 条件1 ] || &#123;</span><br><span class="line">    	命令1     </span><br><span class="line">	命令2     </span><br><span class="line">	命令3 </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>表达式3：如果条件成立，那么执行命令1命令2，否则执行命令3。</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[ -L oldboy ] &amp;&amp; <span class="built_in">echo</span> 1 || <span class="built_in">echo</span> 0</span><br><span class="line">【等价】</span><br><span class="line">[ 条件1 ] &amp;&amp; &#123;</span><br><span class="line">    命令1     </span><br><span class="line">	命令2     </span><br><span class="line">&#125; || &#123; </span><br><span class="line">	命令3 </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>分析：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[ -x /sbin/ip ] ||        <span class="built_in">exit</span> 1 </span><br><span class="line">可执行         不成立  退出</span><br></pre></td></tr></table></figure>

<p><strong>例子：（判断文件是否存在）test</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@db02 ~]<span class="comment"># ls</span></span><br><span class="line">01.dingyi.sh  anaconda-ks.cfg  ww.sh</span><br><span class="line">[root@db02 ~]<span class="comment"># test -f a.txt &amp;&amp; echo felix &gt; a.txt || echo 没有</span></span><br><span class="line">没有</span><br><span class="line">[root@db02 ~]<span class="comment"># touch a.txt</span></span><br><span class="line">		如果 存在        那么 执行              否则 执行</span><br><span class="line">[root@db02 ~]<span class="comment"># test -f a.txt &amp;&amp; echo felix &gt; a.txt || echo 没有</span></span><br><span class="line">[root@db02 ~]<span class="comment"># cat a.txt </span></span><br><span class="line">felix</span><br></pre></td></tr></table></figure>
<p><strong>例子：（判断文件是否有执行权限）test</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">                       如果 可执行      那么 执行      否则  打印</span><br><span class="line">[root@db02 ~]<span class="comment"># test -x ww.sh &amp;&amp; ./ww.sh || echo &quot;没有执行权限&quot;</span></span><br><span class="line">没有执行权限</span><br><span class="line">[root@db02 ~]<span class="comment"># ll ww.sh </span></span><br><span class="line">-rw-r--r-- 1 root root 133 12月 17 17:53 ww.sh</span><br><span class="line">[root@db02 ~]<span class="comment"># chmod +x ww.sh</span></span><br><span class="line">[root@db02 ~]<span class="comment"># ll ww.sh </span></span><br><span class="line">-rwxr-xr-x 1 root root 133 12月 17 17:53 ww.sh</span><br><span class="line">[root@db02 ~]<span class="comment"># test -x ww.sh &amp;&amp; ./ww.sh || echo &quot;没有执行权限&quot;</span></span><br><span class="line">is</span><br><span class="line">worth</span><br><span class="line">doing</span><br><span class="line">is</span><br><span class="line">worth</span><br><span class="line">doing</span><br><span class="line">well.</span><br></pre></td></tr></table></figure>

<p><strong>例子：（判断文件是否有执行权限）[  ]</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@db02 ~]<span class="comment"># [ -x ww.sh ]&amp;&amp; ./ww.sh || echo &quot;没有执行权限&quot;</span></span><br><span class="line">is</span><br><span class="line">worth</span><br><span class="line">doing</span><br><span class="line">is</span><br><span class="line">worth</span><br><span class="line">doing</span><br><span class="line">well.</span><br></pre></td></tr></table></figure>

<p><strong>例子：（判断文件是否有执行权限）[[]]</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@db02 ~]<span class="comment"># [[ -x ww.sh ]]&amp;&amp; ./ww.sh || echo &quot;没有执行权限&quot;</span></span><br><span class="line">is</span><br><span class="line">worth</span><br><span class="line">doing</span><br><span class="line">is</span><br><span class="line">worth</span><br><span class="line">doing</span><br><span class="line">well.</span><br></pre></td></tr></table></figure>

<h3 id="文件测试表达式"><a href="#文件测试表达式" class="headerlink" title="文件测试表达式"></a>文件测试表达式</h3><p>一句话定义：对问文件的属性进行判断，然后根据结果进行处理。<br><img src="/images/pasted-261.png" alt="文件测试表达式"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@db02 ~]<span class="comment"># touch felix.txt</span></span><br><span class="line">[root@db02 ~]<span class="comment"># [ -f felix.txt ] &amp;&amp; echo 1 || echo 0</span></span><br><span class="line">1                        如果..             那么..      否则..</span><br><span class="line">[root@db02 ~]<span class="comment"># rm -rf felix.txt </span></span><br><span class="line">[root@db02 ~]<span class="comment"># [ -f felix.txt ] &amp;&amp; echo 1 || echo 0  &lt;==文件不存在，则echo 0（-f 测试普通文件）</span></span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">[root@db02 ~]<span class="comment"># mkdir felix</span></span><br><span class="line">[root@db02 ~]<span class="comment"># [ -f felix ] &amp;&amp; echo 1 || echo 0  &lt;==felix为目录，不是普通文件所以输出echo 0</span></span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">[root@db02 ~]<span class="comment"># [ -d felix ] &amp;&amp; echo 1 || echo 0  &lt;==目录存在，则echo 0（-d 测试目录）</span></span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">[root@db02 ~]<span class="comment"># [ -e felix ] &amp;&amp; echo 1 || echo 0  &lt;==文件或目录存在，则echo 1（-e 测试文件或目录）</span></span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">[root@db02 ~]<span class="comment"># [ -r felix.txt ] &amp;&amp; echo 1 || echo 0  &lt;==文件或目录可读，不存在则echo 0（-r 测试文件是否可读）</span></span><br><span class="line">0</span><br><span class="line">[root@db02 ~]<span class="comment"># touch felix.txt</span></span><br><span class="line">[root@db02 ~]<span class="comment"># [ -r felix.txt ] &amp;&amp; echo 1 || echo 0  &lt;==文件或目录可读，则echo 1</span></span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">[root@db02 ~]<span class="comment"># [ -s felix.txt ] &amp;&amp; echo 1 || echo 0  &lt;==文件或目录大小不为0，空文件则输出0（-s 测试文件是否为空）</span></span><br><span class="line">0</span><br><span class="line">[root@db02 ~]<span class="comment"># echo 1 &gt; felix.txt </span></span><br><span class="line">[root@db02 ~]<span class="comment"># [ -s felix.txt ] &amp;&amp; echo 1 || echo 0</span></span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">[root@db02 ~]<span class="comment"># [ -w felix.txt ] &amp;&amp; echo 1 || echo 0 &lt;==文件是否可写，可写则echo 1（-w 测试文件是否可写）</span></span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">[root@db02 ~]<span class="comment"># [ -x felix.txt ] &amp;&amp; echo 1 || echo 0  &lt;==文件是否可执行，不可执行则echo 0（-x 测试文件是否可执行）</span></span><br><span class="line">0</span><br><span class="line">[root@db02 ~]<span class="comment"># [ -L felix.txt ] &amp;&amp; echo 1 || echo 0</span></span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<h3 id="字符串测试表达式"><a href="#字符串测试表达式" class="headerlink" title="字符串测试表达式"></a>字符串测试表达式</h3><p>一句话定义：长度，是否为空，是否相等，是否不等。<br><img src="/images/pasted-262.png" alt="字符串测试表达式"></p>
<blockquote>
<p><strong>注意：</strong></p>
</blockquote>
<ol>
<li>字符串判断要将字符串用 双引号” “</li>
<li>等号两端必须要有空格</li>
<li>“=”和”!=” 用于比较两个字符串是否相同</li>
</ol>
<p><code>-n no zero</code>不为零</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@db02 ~]<span class="comment"># echo &quot;$flx&quot;</span></span><br><span class="line"></span><br><span class="line">[root@db02 ~]<span class="comment"># [ -n &quot;$flx&quot; ] &amp;&amp; echo 1 || echo 0  &lt;==为零为假</span></span><br><span class="line">0</span><br><span class="line">[root@db02 ~]<span class="comment"># flx=felix</span></span><br><span class="line">[root@db02 ~]<span class="comment"># [ -n &quot;$flx&quot; ] &amp;&amp; echo 1 || echo 0  &lt;==不为零为真</span></span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<p><code>-z zero</code>为零</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@db02 ~]<span class="comment"># flx=felix</span></span><br><span class="line">[root@db02 ~]<span class="comment"># [ -z &quot;$flx&quot; ] &amp;&amp; echo 1 || echo 0  &lt;==不为零为假</span></span><br><span class="line">0</span><br><span class="line">[root@db02 ~]<span class="comment"># unset flx</span></span><br><span class="line">[root@db02 ~]<span class="comment"># [ -z &quot;$flx&quot; ] &amp;&amp; echo 1 || echo 0  &lt;==为零为真</span></span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<p>字符串测试相等</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@db02 ~]<span class="comment"># echo &quot;$flx&quot;</span></span><br><span class="line">felix</span><br><span class="line">[root@db02 ~]<span class="comment"># nsu=&quot;12345&quot;</span></span><br><span class="line">[root@db02 ~]<span class="comment"># echo $nsu</span></span><br><span class="line">12345</span><br><span class="line">[root@db02 ~]<span class="comment"># [ &quot;$flx&quot; = &quot;$nsu&quot; ] &amp;&amp; echo 1 || echo 0  &lt;==变量内容不相等为假</span></span><br><span class="line">0</span><br><span class="line">[root@db02 ~]<span class="comment"># [ &quot;$flx&quot; = &quot;felix&quot; ] &amp;&amp; echo 1 || echo 0  &lt;==内容相等为真</span></span><br><span class="line">1</span><br><span class="line">[root@db02 ~]<span class="comment"># [ &quot;$&#123;#flx&#125;&quot; = &quot;$&#123;#nsu&#125;&quot; ] &amp;&amp; echo 1 || echo 0  &lt;==字符串长度相等为真</span></span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<h3 id="传参和条件测试练习"><a href="#传参和条件测试练习" class="headerlink" title="传参和条件测试练习"></a>传参和条件测试练习</h3><p>对传入的参数或者read读入的变量内容判断，如果不符合计算条件，提示用户，并退出。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;请输入两个数，以空格分割：&quot;</span> a b</span><br><span class="line">[ -z <span class="variable">$a</span> ] || [ -z <span class="variable">$b</span> ] &amp;&amp; &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;[error]:请输入两个数值&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> <span class="variable">$a</span> <span class="variable">$b</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="built_in">expr</span> <span class="variable">$n</span> + 1 &amp;&gt; /dev/null</span><br><span class="line">  [ $? -eq 0 ] &amp;&amp; &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$n</span> [Data ok!]&quot;</span>;</span><br><span class="line">  &#125;||&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;[ERROR Data are not Numbers!]&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span>+<span class="variable">$b</span>=<span class="subst">$((a+b)</span>)&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span>-<span class="variable">$b</span>=<span class="subst">$((a-b)</span>)&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span>*<span class="variable">$b</span>=<span class="subst">$((a*b)</span>)&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span>/<span class="variable">$b</span>=<span class="subst">$((a/b)</span>)&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span>%<span class="variable">$b</span>=<span class="subst">$((a%b)</span>)&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span>**<span class="variable">$b</span>=<span class="subst">$((a**b)</span>)&quot;</span></span><br><span class="line"></span><br><span class="line">通过脚本传参的方式完成上面的例子</span><br><span class="line"><span class="comment">#/bin/bash</span></span><br><span class="line"><span class="comment">#1.判断是否为两个参数</span></span><br><span class="line">[ <span class="variable">$#</span> -ne 2 ]&amp;&amp;&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$0</span> num1 num2 ✔&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.判断参数是否为数字</span></span><br><span class="line"><span class="built_in">expr</span> <span class="variable">$1</span> + <span class="variable">$2</span> + 100 &amp;&gt;/dev/null</span><br><span class="line">[ $? -eq 0 ]&amp;&amp;&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;[data ok]:<span class="variable">$1</span> <span class="variable">$2</span>&quot;</span></span><br><span class="line">&#125;||&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;请输入两个正确的整数！&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.开始计算</span></span><br><span class="line">a=<span class="variable">$1</span></span><br><span class="line">b=<span class="variable">$2</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$a</span>+<span class="variable">$b</span>=$((a+b))</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$a</span>-<span class="variable">$b</span>=$((a-b))</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$a</span>^<span class="variable">$b</span>=$((a**b))</span><br><span class="line">[ <span class="variable">$b</span> -eq 0 ]&amp;&amp;&#123;</span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;[error] 除数为0，取余和除法不能计算。×&quot;</span></span><br><span class="line">&#125;||&#123;</span><br><span class="line">   <span class="built_in">echo</span> <span class="variable">$a</span>/<span class="variable">$b</span>=$((a/b))</span><br><span class="line">   <span class="built_in">echo</span> <span class="variable">$a</span>%<span class="variable">$b</span>=$((a%b))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="二元整数比较"><a href="#二元整数比较" class="headerlink" title="二元整数比较"></a>二元整数比较</h3><p><img src="/images/pasted-267.png" alt="二元整数比较"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">整数比较：</span><br><span class="line">[root@db02 ~]<span class="comment"># [ 1 -eq 1 ] &amp;&amp; echo 1 || echo 0  &lt;==等于</span></span><br><span class="line">1</span><br><span class="line">[root@db02 ~]<span class="comment"># [ 1 -ne 1 ] &amp;&amp; echo 1 || echo 0  &lt;==不等于</span></span><br><span class="line">0</span><br><span class="line">[root@db02 ~]<span class="comment"># [ 1 -ge 1 ] &amp;&amp; echo 1 || echo 0  &lt;==大于等于</span></span><br><span class="line">1</span><br><span class="line">[root@db02 ~]<span class="comment"># [ 1 -gt 1 ] &amp;&amp; echo 1 || echo 0  &lt;==大于</span></span><br><span class="line">0</span><br><span class="line">[root@db02 ~]<span class="comment"># [ 1 -lt 1 ] &amp;&amp; echo 1 || echo 0  &lt;==小于</span></span><br><span class="line">0</span><br><span class="line">[root@db02 ~]<span class="comment"># [ 1 -le 1 ] &amp;&amp; echo 1 || echo 0  &lt;==小于等于</span></span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<p><strong>逻辑操作符</strong><br><img src="/images/pasted-268.png" alt="逻辑操作符"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">在一个表达式中，放入多个条件。</span><br><span class="line">[root@db02 ~]<span class="comment"># [ -f /etc/hosts -a 1 -eq 1 ] &amp;&amp; echo 1 || echo 0</span></span><br><span class="line">1</span><br><span class="line">[root@db02 ~]<span class="comment"># [ -f /etc/hosts -a 1 -eq 2 ] &amp;&amp; echo 1 || echo 0</span></span><br><span class="line">0</span><br><span class="line">[root@db02 ~]<span class="comment"># [ -f /etc/hosts -o 1 -eq 2 ] &amp;&amp; echo 1 || echo 0</span></span><br><span class="line">1</span><br><span class="line">[root@db02 ~]<span class="comment"># [ -f /etc/hosts -o 1 -eq 2 ] &amp;&amp; echo 1 || echo 0</span></span><br><span class="line">1</span><br><span class="line">[root@db02 ~]<span class="comment"># [ -f /etc/hosts -a ! 1 -eq 2 ] &amp;&amp; echo 1 || echo 0  &lt;==对指定条件进行取反</span></span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">连接两个括号的操作符：</span><br><span class="line">[root@db02 ~]<span class="comment"># [ -f /etc/hosts ] &amp;&amp; [ 1 -eq 2 ] &amp;&amp; echo 1 || echo 0</span></span><br><span class="line">0</span><br><span class="line">[root@db02 ~]<span class="comment"># [ -f /etc/hosts ] || [ 1 -eq 2 ] &amp;&amp; echo 1 || echo 0</span></span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<p><img src="/images/pasted-269.png" alt="逻辑操作符"></p>
<h3 id="菜单练习"><a href="#菜单练习" class="headerlink" title="菜单练习"></a>菜单练习</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/bin/bash</span></span><br><span class="line">Inl=<span class="string">&quot;即将安装:&quot;</span></span><br><span class="line">One=<span class="string">&quot;\033[40;32m MySQL\033[0m&quot;</span></span><br><span class="line">Two=<span class="string">&quot;\033[40;32m Nginx \033[0m&quot;</span></span><br><span class="line">Three=<span class="string">&quot;\033[40;32m PHP \033[0m&quot;</span></span><br><span class="line">Four=<span class="string">&quot;\033[40;32m Tomcat \033[0m&quot;</span></span><br><span class="line">Five=<span class="string">&quot;\033[40;32m ALL \033[0m&quot;</span></span><br><span class="line">Err=<span class="string">&quot;\033[40;31m[Error]\033[0m Please check the..&quot;</span></span><br><span class="line">Ok=<span class="string">&quot;\033[40;32m[OK] \033[0mSuccessful installation&quot;</span></span><br><span class="line">/bin/clear</span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;Please select a&#123;1|2|3|4|5|6&#125;:&quot;</span> n</span><br><span class="line"><span class="built_in">expr</span> <span class="variable">$n</span> + 1 &amp;&gt;/dev/null</span><br><span class="line">[[ -z <span class="variable">$n</span> || $? -ne 0 || ! <span class="variable">$n</span> =~ [1-6] ]] &amp;&amp; &#123;</span><br><span class="line">     /bin/clear</span><br><span class="line">     /bin/bash <span class="variable">$0</span></span><br><span class="line">     <span class="built_in">exit</span> 0</span><br><span class="line">&#125;</span><br><span class="line">[ <span class="variable">$n</span> -eq 6 ] &amp;&amp; &#123;</span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\033[40;31mQuit!\033[0m&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 0</span><br><span class="line">&#125;||&#123;</span><br><span class="line">    [ <span class="variable">$n</span> -eq 5 ] &amp;&amp; &#123;</span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;Inl&#125;</span><span class="variable">$&#123;Five&#125;</span>&quot;</span></span><br><span class="line">        <span class="built_in">sleep</span> 5</span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;Ok&#125;</span><span class="variable">$&#123;Five&#125;</span>&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 0</span><br><span class="line">    &#125;||</span><br><span class="line">        [ <span class="variable">$n</span> -eq 4 ] &amp;&amp; &#123;</span><br><span class="line">            <span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;Inl&#125;</span><span class="variable">$&#123;Four&#125;</span>&quot;</span></span><br><span class="line">            <span class="built_in">sleep</span> 5</span><br><span class="line">            <span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;Ok&#125;</span><span class="variable">$&#123;Four&#125;</span>&quot;</span></span><br><span class="line">            <span class="built_in">exit</span> 0</span><br><span class="line">        &#125;||</span><br><span class="line">            [ <span class="variable">$n</span> -eq 3 ] &amp;&amp; &#123;</span><br><span class="line">                <span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;Inl&#125;</span><span class="variable">$&#123;Three&#125;</span>&quot;</span></span><br><span class="line">                <span class="built_in">sleep</span> 5</span><br><span class="line">                <span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;Ok&#125;</span><span class="variable">$&#123;Three&#125;</span>&quot;</span></span><br><span class="line">                <span class="built_in">exit</span> 0</span><br><span class="line">            &#125;||</span><br><span class="line">                [ <span class="variable">$n</span> -eq 2 ] &amp;&amp; &#123;</span><br><span class="line">                    <span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;Inl&#125;</span><span class="variable">$&#123;Two&#125;</span>&quot;</span></span><br><span class="line">                    <span class="built_in">sleep</span> 5</span><br><span class="line">                    <span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;Ok&#125;</span><span class="variable">$&#123;Two&#125;</span>&quot;</span></span><br><span class="line">                    <span class="built_in">exit</span> 0</span><br><span class="line">                &#125;||</span><br><span class="line">                    [ <span class="variable">$n</span> -eq 1 ] &amp;&amp; &#123;</span><br><span class="line">                        <span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;Inl&#125;</span><span class="variable">$&#123;One&#125;</span>&quot;</span></span><br><span class="line">                        <span class="built_in">sleep</span> 5</span><br><span class="line">                        <span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;Ok&#125;</span><span class="variable">$&#123;One&#125;</span>&quot;</span></span><br><span class="line">                        <span class="built_in">exit</span> 0</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/images/pasted-270.png" alt="菜单"></p>
<h3 id="if判断"><a href="#if判断" class="headerlink" title="if判断"></a>if判断</h3><p><strong>单分支：</strong>（如果……那么）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> &lt;条件表达式&gt;</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        指令</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> &lt;条件表达式&gt;; <span class="keyword">then</span></span><br><span class="line">    指令</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<p><strong>双分支：</strong>（如果……那么……否则）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> &lt;条件表达式&gt;</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        指令</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        指令</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<p><strong>多分枝：</strong>（如果…….那么……或者那么……或者那么……否则）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> &lt;条件表达式&gt;;<span class="keyword">then</span></span><br><span class="line">    指令1</span><br><span class="line"><span class="keyword">elif</span> &lt;条件表达式&gt;;<span class="keyword">then</span></span><br><span class="line">    指令2</span><br><span class="line"><span class="keyword">elif</span> &lt;条件表达式&gt;;<span class="keyword">then</span></span><br><span class="line">    指令3</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    指令4</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<ol>
<li><strong>传参计算：</strong></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/bin/bash</span></span><br><span class="line"><span class="comment">#1.判断是否为两个参数</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -ne 2 ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$0</span> num1 num2 ✔&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li><strong>判断参数是否为数字</strong></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">expr</span> <span class="variable">$1</span> + <span class="variable">$2</span> + 100 &amp;&gt;/dev/null</span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;[data ok]:<span class="variable">$1</span> <span class="variable">$2</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;请输入两个正确的整数！&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 2</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li><strong>开始计算</strong></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">a=<span class="variable">$1</span></span><br><span class="line">b=<span class="variable">$2</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$a</span>+<span class="variable">$b</span>=$((a+b))</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$a</span>-<span class="variable">$b</span>=$((a-b))</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$a</span>^<span class="variable">$b</span>=$((a**b))</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$b</span> -eq 0 ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;[error] 除数为0，取余和除法不能计算。×&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="variable">$a</span>/<span class="variable">$b</span>=$((a/b))</span><br><span class="line">   <span class="built_in">echo</span> <span class="variable">$a</span>%<span class="variable">$b</span>=$((a%b))</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li><strong>内存告警</strong></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@KFSAMBA ~]<span class="comment"># tail -1 /etc/mail.rc</span></span><br><span class="line"><span class="built_in">set</span> from=513247869@qq.com smtp=smtp.qq.com smtp-auth-user=513247869 smtp-auth-password=qfztqqoggfblbgec</span><br><span class="line"></span><br><span class="line"><span class="comment">#/bin/bash</span></span><br><span class="line">free_mem=$(free -m | awk -F<span class="string">&quot; &quot;</span> <span class="string">&#x27;NR==2&#123;print $7&#125;&#x27;</span>)</span><br><span class="line">flx=`<span class="built_in">echo</span> <span class="string">&quot;scale=2;<span class="variable">$free_mem</span>/1024&quot;</span> |bc`</span><br><span class="line"><span class="built_in">date</span>=`<span class="built_in">date</span> +<span class="string">&quot;%F %H:%M:%S&quot;</span>`</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$free_mem</span> -lt 8000 ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;[<span class="variable">$date</span>] 废了，没内存了: <span class="variable">$&#123;flx&#125;</span>G&quot;</span> |<span class="built_in">tee</span> -a /var/log/mem.log <span class="comment">#追加并输出</span></span><br><span class="line">    /usr/bin/tail -1 /var/log/mem.log | /usr/bin/mail -s <span class="string">&quot;<span class="subst">$(date)</span> 内存警告&quot;</span> 513247869@qq.com</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;[<span class="variable">$date</span>] 内存还够: <span class="variable">$&#123;flx&#125;</span>G&quot;</span> |<span class="built_in">tee</span> -a /var/log/mem.log</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h3 id="服务监控"><a href="#服务监控" class="headerlink" title="服务监控"></a>服务监控</h3><p><img src="/images/pasted-271.png" alt="服务监控"><br>nc的控制参数不少，常用的几个参数如下所列：</p>
<ul>
<li>-l 用于指定nc将处于侦听模式。指定该参数，则意味着nc被当作server，侦听并接受连接，而非向其它地址发起连接。</li>
<li>-p <port> 暂未用到（老版本的nc可能需要在端口号前加-p参数，下面测试环境是centos6.6，nc版本是nc-1.84，未用到-p参数）</li>
<li>-s 指定发送数据的源IP地址，适用于多网卡机 </li>
<li>-u 指定nc使用UDP协议，默认为TCP</li>
<li>-v 输出交互或出错信息，新手调试时尤为有用</li>
<li>-w 超时秒数，后面跟数字 </li>
<li>-z 表示zero，表示扫描时不发送任何数据</li>
</ul>
<p><strong>Nginx监控</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/bin/bash</span></span><br><span class="line"><span class="comment">#nginx=$(/application/nginx/sbin/nginx)</span></span><br><span class="line"><span class="built_in">date</span>=`<span class="built_in">date</span> +<span class="string">&quot;%F %H:%M:%S&quot;</span>`</span><br><span class="line">nginxcmd=<span class="string">&quot;/application/nginx/sbin/nginx&quot;</span></span><br><span class="line"><span class="comment">#监控服务</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -eq 0 ];<span class="keyword">then</span></span><br><span class="line">    /usr/bin/netstat -lntup | grep 80 &amp;&gt; /dev/null</span><br><span class="line">    <span class="keyword">if</span> [ $? -ne 0 ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;[<span class="variable">$date</span>] 不行了，nginx崩了&quot;</span> |<span class="built_in">tee</span> -a /var/log/nginx_state.log</span><br><span class="line">        /usr/bin/tail -1 /var/log/nginx_state.log | /usr/bin/mail -s <span class="string">&quot;<span class="subst">$(date)</span> nginx告警&quot;</span> 513247869@qq.com</span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;[<span class="variable">$date</span>]nginx 状态正常!&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 0</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#启动脚本</span></span><br><span class="line">[[ <span class="variable">$#</span> -ne 1 ]] &amp;&amp; &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$0</span> &#123;start|stop|restart|reload&#125;&quot;</span> </span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> = <span class="string">&quot;start&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">    <span class="variable">$nginxcmd</span> -c /application/nginx/conf/nginx.conf &amp;&gt; /dev/null</span><br><span class="line">    /bin/bash <span class="variable">$0</span></span><br><span class="line">    <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> = <span class="string">&quot;restart&quot;</span> -o <span class="string">&quot;<span class="variable">$1</span>&quot;</span> = <span class="string">&quot;reload&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">    <span class="variable">$nginxcmd</span> -c /application/nginx/conf/nginx.conf &amp;&gt; /dev/null</span><br><span class="line">    <span class="variable">$nginxcmd</span> -s reload &amp;&gt; /dev/null</span><br><span class="line">    <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> = <span class="string">&quot;stop&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">    <span class="variable">$nginxcmd</span> -s stop &amp;&gt; /dev/null</span><br><span class="line">    <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;[ERROR] <span class="variable">$0</span> &#123;start|stop|restart|reload&#125;&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 2</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h3 id="函数传参"><a href="#函数传参" class="headerlink" title="函数传参"></a>函数传参</h3><p>语法1：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> 函数名() &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>语法2：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> 函数名 &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>语法3：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">函数名 () &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>函数的执行过程：</strong></p>
<ol>
<li>执行Shell函数时，函数名前的function和函数后的小括号都不要带。</li>
<li>函数的定义必须在要执行前面定义或加载好（先定义，再执行）。</li>
<li>Shell执行系统中各种程序的顺序为：系统别名→函数→系统命令→可执行文件。</li>
<li>函数执行时，会和调用它的脚本共用变量，也可以为函数设定局部变量以及特殊位置参数。</li>
<li>在shell函数里面，return命令功能与exit类似，作用是退出函数，而exit是退出脚本文件。</li>
<li>return 语句会返回一个退出值（即返回值）给调用函数的当前程序，而exit会返回一个退出值（即返回值）给执行程序的当前Shell。</li>
<li>如果函数存放在独立的文件中，被脚本加载使用时，需要使用source或者.来加载。</li>
<li>在函数内一般使用local定义局部变量，这些变量离开函数后即消失。</li>
</ol>
<p><strong>函数传参：</strong></p>
<ul>
<li>Shell的位置参数（$1、$2…、$#、$*、$?以及$@）都可以作为函数的参数使用。</li>
<li>此时父脚本的参数临时地被函数参数所掩盖或隐藏。</li>
<li>$0比较特殊，它仍然是父脚本的名称。</li>
<li>当函数执行完成时，原来的命令行脚本的参数即恢复。</li>
<li>函数的参数变量是在函数体里面定义的。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@KFSAMBA ~]<span class="comment"># sh function.sh </span></span><br><span class="line">I am felix</span><br><span class="line">[root@KFSAMBA ~]<span class="comment"># cat function.sh </span></span><br><span class="line"><span class="comment">#/bin/bash</span></span><br><span class="line"><span class="function"><span class="title">felix</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;I am felix&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">felix</span><br></pre></td></tr></table></figure>
<p><strong>第一步：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@KFSAMBA ~]<span class="comment"># sh function.sh </span></span><br><span class="line">I am 第一个参数</span><br><span class="line">[root@KFSAMBA ~]<span class="comment"># cat function.sh </span></span><br><span class="line"><span class="comment">#/bin/bash</span></span><br><span class="line"><span class="function"><span class="title">felix</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;I am <span class="variable">$1</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">felix 第一个参数  &lt;==这个参数传递给了函数felix，felix函数中再通过<span class="variable">$1</span>进行带入</span><br></pre></td></tr></table></figure>
<p><strong>第二步：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@KFSAMBA ~]<span class="comment"># sh function.sh 第一 </span></span><br><span class="line">I am 第一</span><br><span class="line">[root@KFSAMBA ~]<span class="comment"># cat function.sh </span></span><br><span class="line"><span class="comment">#/bin/bash</span></span><br><span class="line"><span class="function"><span class="title">felix</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;I am <span class="variable">$1</span>&quot;</span>  &lt;==2.这里的<span class="variable">$1</span>是指函数的第一个参数。此脚本中函数的第一个参数就是脚本的第一个参数</span><br><span class="line">&#125;</span><br><span class="line">felix <span class="variable">$1</span>  &lt;==1.这里的<span class="variable">$1</span>是指脚本的第一个参数，将用户传入脚本的第一个参数传给函数</span><br><span class="line"></span><br><span class="line">函数内定义私有变量：</span><br><span class="line">函数()&#123;</span><br><span class="line"><span class="built_in">local</span> s=1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>检查url是否正常</strong></p>
<ol>
<li>检查url是否正常</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@KFSAMBA ~]<span class="comment"># sh check_url.sh baidi.com</span></span><br><span class="line">URL is no</span><br><span class="line">[root@KFSAMBA ~]<span class="comment"># cat check_url.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">wegt -q <span class="variable">$1</span> &amp;&gt;/dev/null    &lt;==-q 不显示输出</span><br><span class="line">retval=$?</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$retval</span> -eq 0 ]   &lt;==判断返回值</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;URL is ok&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;URL is no&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>调用函数实现</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="function"><span class="title">check_url</span></span>()&#123;</span><br><span class="line">wget -q -o /dev/null --spider --tries=1 -T 5 <span class="variable">$1</span>   &lt;==3.check函数接收main函数的参数，得出结果</span><br><span class="line"><span class="comment">#T#超时时间</span></span><br><span class="line"><span class="comment">#spider#爬虫，模拟访问不下载</span></span><br><span class="line"><span class="comment">#tries #wegt次数</span></span><br><span class="line"><span class="comment">#-T #超时时间   </span></span><br><span class="line">retval=$?</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$retval</span> -eq 0 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;URL is ok&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;URL is no&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">main</span></span>()&#123;</span><br><span class="line">    check_url <span class="variable">$1</span>   &lt;==2.main函数的参数传递给check函数</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main $*   &lt;==1.传递脚本参数给main函数</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>传参的方式调用函数</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="function"><span class="title">usage</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> [[ ! <span class="variable">$1</span> =~ http://.*$ ]]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Usage:<span class="variable">$0</span> http://www.xxx.com&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">check_url</span></span>()&#123;</span><br><span class="line">wget -q <span class="variable">$1</span> &amp;&gt;/dev/null</span><br><span class="line">retval=$?</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$retval</span> -eq 0 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;URL is ok&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;URL is no&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">main</span></span>()&#123;</span><br><span class="line">    usage <span class="variable">$1</span></span><br><span class="line">    check_url <span class="variable">$1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main $*</span><br></pre></td></tr></table></figure>

<h3 id="系统自带函数"><a href="#系统自带函数" class="headerlink" title="系统自带函数"></a>系统自带函数</h3><p><strong>action函数</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Run some action. Log its output.</span></span><br><span class="line"><span class="function"><span class="title">action</span></span>() &#123;</span><br><span class="line">    <span class="built_in">local</span> STRING rc</span><br><span class="line"></span><br><span class="line">    STRING=<span class="variable">$1</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">&quot;<span class="variable">$STRING</span> &quot;</span></span><br><span class="line">    <span class="built_in">shift</span></span><br><span class="line">    <span class="string">&quot;<span class="variable">$@</span>&quot;</span> &amp;&amp; success $<span class="string">&quot;<span class="variable">$STRING</span>&quot;</span> || failure $<span class="string">&quot;<span class="variable">$STRING</span>&quot;</span></span><br><span class="line">    rc=$?</span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">    <span class="built_in">return</span> <span class="variable">$rc</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>调用action</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">[ -f /etc/init.d/functions ] &amp;&amp; . /etc/init.d/functions   &lt;==函数库文件存在就加载</span><br><span class="line"><span class="function"><span class="title">usage</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> [[ ! <span class="variable">$1</span> =~ http://.*$ ]]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Usage:<span class="variable">$0</span> http://www.xxx.com&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">check_url</span></span>()&#123;</span><br><span class="line"></span><br><span class="line">wget -q -o /dev/null --spider --tries=1 -T 5 <span class="variable">$1</span>   </span><br><span class="line"><span class="comment">#spider#爬虫，模拟访问不下载</span></span><br><span class="line"><span class="comment">#tries #wegt次数</span></span><br><span class="line"><span class="comment">#-T #超时时间</span></span><br><span class="line"></span><br><span class="line">retval=$?</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$retval</span> -eq 0 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    action <span class="string">&quot;URL is ok&quot;</span> /bin/true   &lt;==调用action函数</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    action <span class="string">&quot;URL is no&quot;</span> /bin/false</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">main</span></span>()&#123;</span><br><span class="line">    usage <span class="variable">$1</span></span><br><span class="line">    check_url <span class="variable">$1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main $*</span><br></pre></td></tr></table></figure>

<p><strong>测试</strong><br><img src="/images/pasted-272.png" alt="test"></p>
<h3 id="case"><a href="#case" class="headerlink" title="case"></a>case</h3><p>case结构条件句的语法格式为</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">&quot;变量&quot;</span> <span class="keyword">in</span> </span><br><span class="line">    值1)</span><br><span class="line">        指令1...</span><br><span class="line">        ;;</span><br><span class="line">    值2)</span><br><span class="line">        指令2...</span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        指令3...</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line">相当于<span class="keyword">if</span>多分支语句。</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;变量&quot;</span>  =<span class="string">&quot;值1&quot;</span>  ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    指令1...</span><br><span class="line"><span class="keyword">elif</span>  [ <span class="string">&quot;变量&quot;</span>  =<span class="string">&quot;值2&quot;</span>  ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    指令2...</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    指令3...</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p><strong>菜单实现</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">###################################################</span></span><br><span class="line"><span class="comment"># File Name: 3.sh</span></span><br><span class="line"><span class="comment"># Created Time: Thu 26 Dec 2019 01:55:17 PM CST</span></span><br><span class="line"><span class="comment"># Version: V1.0</span></span><br><span class="line"><span class="comment"># Author: Felix</span></span><br><span class="line"><span class="comment"># Organization: 360JR OPS</span></span><br><span class="line"><span class="comment">###################################################</span></span><br><span class="line"><span class="comment">#vars</span></span><br><span class="line">Inl=<span class="string">&quot;即将安装:&quot;</span></span><br><span class="line">One=<span class="string">&quot;\033[40;32m MySQL\033[0m&quot;</span></span><br><span class="line">Two=<span class="string">&quot;\033[40;32m Nginx \033[0m&quot;</span></span><br><span class="line">Three=<span class="string">&quot;\033[40;32m PHP \033[0m&quot;</span></span><br><span class="line">Four=<span class="string">&quot;\033[40;32m Tomcat \033[0m&quot;</span></span><br><span class="line">Five=<span class="string">&#x27;\033[40;32m ALL \033[0m&#x27;</span></span><br><span class="line">Err=<span class="string">&quot;\033[40;31m[Error]\033[0m Please check the..&quot;</span></span><br><span class="line">Ok=<span class="string">&quot;\033[40;32m[OK] \033[0mSuccessful installation&quot;</span></span><br><span class="line">[ -f /etc/init.d/functions ] &amp;&amp; . /etc/init.d/functions</span><br><span class="line"></span><br><span class="line"><span class="comment">#menus</span></span><br><span class="line"><span class="function"><span class="title">list</span></span>()&#123;</span><br><span class="line">    /bin/clear</span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;-------------------------</span></span><br><span class="line"><span class="string"> By Felix:</span></span><br><span class="line"><span class="string">  1.[\033[40;34m Install\033[0m<span class="variable">$One</span>  ].a</span></span><br><span class="line"><span class="string">  2.[\033[40;34m Install\033[0m<span class="variable">$Two</span> ].b</span></span><br><span class="line"><span class="string">  3.[\033[40;34m Install\033[0m<span class="variable">$Three</span>   ].c</span></span><br><span class="line"><span class="string">  4.[\033[40;34m Install\033[0m<span class="variable">$Four</span>].d</span></span><br><span class="line"><span class="string">  5.[\033[40;34m Install\033[0m<span class="variable">$Five</span>   ].e</span></span><br><span class="line"><span class="string">  6.[\033[40;34m Exit\033[0m           ].f</span></span><br><span class="line"><span class="string">-------------------------&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Please select a&#123;1|a,2|b,3|c,4|d,5|e,6|f&#125;:&quot;</span></span><br><span class="line">    <span class="built_in">read</span> n</span><br><span class="line">    gather=<span class="variable">$n</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">ftc</span></span>()&#123;</span><br><span class="line">    /bin/clear</span><br><span class="line">    /bin/bash <span class="variable">$0</span></span><br><span class="line">    <span class="built_in">exit</span> 1      </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#Input value judgment</span></span><br><span class="line"><span class="function"><span class="title">isdigit</span></span>()&#123;</span><br><span class="line">    <span class="built_in">expr</span> <span class="variable">$gather</span> + 1 &amp;&gt;/dev/null</span><br><span class="line">    x=$?</span><br><span class="line">    <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$gather</span>&quot;</span> =~ ^[a-f]$ ]];<span class="keyword">then</span>   <span class="comment">#&lt;==如果匹配到a-f就什么都不干</span></span><br><span class="line">        :</span><br><span class="line">    <span class="keyword">elif</span> [[ -z <span class="variable">$gather</span> || <span class="variable">$x</span> -ne 0 || ! <span class="variable">$gather</span> =~ ^[1-6]$ ]];<span class="keyword">then</span>   <span class="comment">#&lt;==如果传入值不为数字就重新执行脚本</span></span><br><span class="line">        ftc</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#Installation status diagram</span></span><br><span class="line"><span class="function"><span class="title">choose</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;Inl&#125;</span> $*&quot;</span></span><br><span class="line">    <span class="built_in">sleep</span> 5</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">win</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;Ok&#125;</span> $*&quot;</span> </span><br><span class="line">    <span class="built_in">exit</span> 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#Choose to determine</span></span><br><span class="line"><span class="function"><span class="title">checkbox</span></span>()&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$gather</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">        6|f)</span><br><span class="line">            <span class="built_in">echo</span> -e <span class="string">&quot;\033[40;31mQuit!\033[0m&quot;</span></span><br><span class="line">            <span class="built_in">exit</span> 0</span><br><span class="line">            ;;</span><br><span class="line">        5|e)</span><br><span class="line">            choose <span class="variable">$&#123;Five&#125;</span></span><br><span class="line">            win <span class="variable">$&#123;Five&#125;</span></span><br><span class="line">            ;;</span><br><span class="line">        4|d)</span><br><span class="line">            choose <span class="variable">$&#123;Four&#125;</span></span><br><span class="line">            win <span class="variable">$&#123;Four&#125;</span></span><br><span class="line">            ;;</span><br><span class="line">        3|c)</span><br><span class="line">            choose <span class="variable">$&#123;Three&#125;</span></span><br><span class="line">            win <span class="variable">$&#123;Three&#125;</span></span><br><span class="line">            ;;</span><br><span class="line">        2|b)</span><br><span class="line">            choose <span class="variable">$&#123;Two&#125;</span></span><br><span class="line">            win <span class="variable">$&#123;Two&#125;</span></span><br><span class="line">            ;;</span><br><span class="line">        1|a)</span><br><span class="line">            choose <span class="variable">$&#123;One&#125;</span></span><br><span class="line">            win <span class="variable">$&#123;One&#125;</span></span><br><span class="line">            ;;</span><br><span class="line">        *)</span><br><span class="line">            :</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#Call all</span></span><br><span class="line"><span class="function"><span class="title">main</span></span>()&#123;</span><br><span class="line">    list</span><br><span class="line">    isdigit</span><br><span class="line">    checkbox</span><br><span class="line">&#125;</span><br><span class="line">main</span><br></pre></td></tr></table></figure>
<p><img src="/images/pasted-273.png" alt="菜单"></p>
<h3 id="返回值传递"><a href="#返回值传递" class="headerlink" title="返回值传递"></a>返回值传递</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># chkconfig: 2345 21 81</span></span><br><span class="line"><span class="comment"># description: startup rsync scripts</span></span><br><span class="line">PID=/var/run/rsyncd.pid</span><br><span class="line"><span class="function"><span class="title">start</span></span>()&#123;</span><br><span class="line">	<span class="keyword">if</span> [ -f <span class="variable">$PID</span> -a -s <span class="variable">$PID</span> ]</span><br><span class="line">	   <span class="keyword">then</span></span><br><span class="line">	       :</span><br><span class="line">	   <span class="keyword">else</span></span><br><span class="line">	       rsync --daemon</span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">    <span class="built_in">return</span> $?   &lt;==把函数执行结果通过<span class="built_in">return</span>传出</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">stop</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> [ -f <span class="variable">$PID</span> -a -s <span class="variable">$PID</span> ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">kill</span> `<span class="built_in">cat</span> <span class="variable">$PID</span>`</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="built_in">return</span> $?</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    start)</span><br><span class="line">        start</span><br><span class="line">        retval=$?</span><br><span class="line">        ;;</span><br><span class="line">    stop)</span><br><span class="line">        stop</span><br><span class="line">        retval=$?</span><br><span class="line">        ;;</span><br><span class="line">    restart)</span><br><span class="line">        stop</span><br><span class="line">        <span class="built_in">sleep</span> 2</span><br><span class="line">        start</span><br><span class="line">        retval=$?</span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Usage；<span class="variable">$0</span> &#123;start|stop|restart&#125;&quot;</span></span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="built_in">exit</span> <span class="variable">$retval</span></span><br></pre></td></tr></table></figure>

<h3 id="C6启动脚本"><a href="#C6启动脚本" class="headerlink" title="C6启动脚本"></a>C6启动脚本</h3><p>service管理的服务需要将其脚本文件放在/etc/init.d目录中，通过chkconfig管理。<br><strong>rsync启动脚本解析</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># chkconfig: 2345 21 81</span></span><br><span class="line"><span class="comment"># description: rsync service start and stop scripts</span></span><br><span class="line"><span class="comment"># Author: Felix</span></span><br><span class="line"><span class="comment"># Organization:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#加载自带函数库</span></span><br><span class="line">[ -f /etc/rc.d/init.d/functions ] &amp;&amp; <span class="built_in">source</span> /etc/rc.d/init.d/functions</span><br><span class="line"><span class="comment">#程序锁文件，用来判断程序是否启动</span></span><br><span class="line">lockdir=<span class="string">&#x27;/var/lock/subsys&#x27;</span></span><br><span class="line">lock_file_path=<span class="string">&quot;<span class="variable">$lockdir</span>/rsync&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#pid文件</span></span><br><span class="line">rsyncd_pid_file_path=<span class="string">&quot;/var/run/rsyncd.pid&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#成功提示函数</span></span><br><span class="line"><span class="function"><span class="title">log_success_msg</span></span>()&#123;</span><br><span class="line">    <span class="comment">#action为特殊的提示函数，$@为所有参数。</span></span><br><span class="line">    action <span class="string">&quot;SUCCESS! <span class="variable">$@</span>&quot;</span> /bin/true</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#失败提示函数</span></span><br><span class="line"><span class="function"><span class="title">log_failure_msg</span></span>()&#123;</span><br><span class="line">    action  <span class="string">&quot;ERROR! <span class="variable">$@</span>&quot;</span> /bin/false</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#启动函数</span></span><br><span class="line"><span class="function"><span class="title">start</span></span>()&#123;</span><br><span class="line">    rsync --daemon &amp;&gt;/dev/null</span><br><span class="line">    retval=$?</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$retval</span> -eq 0 ]  <span class="comment">#&lt;==获取状态码，为0表示启动成功</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        log_success_msg <span class="string">&quot;Rsyncd is started.&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">test</span> -w <span class="string">&quot;<span class="variable">$lockdir</span>&quot;</span> <span class="comment">#判断锁目录是否可写。</span></span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">touch</span> <span class="string">&quot;<span class="variable">$lock_file_path</span>&quot;</span> <span class="comment">#创建锁文件，表示程序已经正常启动。</span></span><br><span class="line">            <span class="built_in">return</span> <span class="variable">$retval</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            log_failure_msg <span class="string">&quot;Rsync lockfile denied&quot;</span> <span class="comment">#目录不可写，创建锁文件失败，调用失败函数提示。</span></span><br><span class="line">            <span class="built_in">return</span> 1</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Rsyncd startup fail.&quot;</span>  <span class="comment">#返回值不为0，表示启动失败。</span></span><br><span class="line">        <span class="built_in">return</span> 1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#停止函数</span></span><br><span class="line"><span class="function"><span class="title">stop</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">test</span> -s <span class="string">&quot;<span class="variable">$rsyncd_pid_file_path</span>&quot;</span>  <span class="comment">#判断文件是否不为空。</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="comment">#读取pidfile</span></span><br><span class="line">        rsyncd_pid=`<span class="built_in">cat</span> <span class="string">&quot;<span class="variable">$rsyncd_pid_file_path</span>&quot;</span>`  <span class="comment">#不为空则获取pid</span></span><br><span class="line">      </span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">kill</span> -0 <span class="variable">$rsyncd_pid</span> 2&gt;/dev/null)  <span class="comment">#通过进程号，判断对应的进程是否存在。</span></span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">kill</span> <span class="variable">$rsyncd_pid</span>   <span class="comment">#进程存在就杀死进程</span></span><br><span class="line">            retval=$?</span><br><span class="line">            <span class="keyword">if</span> [ <span class="variable">$retval</span> -eq 0 ]</span><br><span class="line">            <span class="keyword">then</span></span><br><span class="line">                log_success_msg <span class="string">&quot;Rsync Stop&quot;</span> <span class="comment">#调用停止成功函数。</span></span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">test</span> -f <span class="string">&quot;<span class="variable">$lock_file_path</span>&quot;</span></span><br><span class="line">                <span class="keyword">then</span></span><br><span class="line">                    <span class="built_in">rm</span> <span class="string">&quot;<span class="variable">$lock_file_path</span>&quot;</span>  <span class="comment">#删除锁文件。</span></span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">                <span class="built_in">return</span> <span class="variable">$retval</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                log_failure_msg <span class="string">&quot;Rsyncd Stop.&quot;</span></span><br><span class="line">                <span class="built_in">return</span> <span class="variable">$retval</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            log_failure_msg <span class="string">&quot;rsync server_pid&#x27;s process is not running!&quot;</span></span><br><span class="line">            <span class="built_in">rm</span> <span class="string">&quot;<span class="variable">$rsyncd_pid_file_path</span>&quot;</span>   <span class="comment">#进程号对应的进程未启动，就删除pid文件。并提示</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        log_failure_msg <span class="string">&quot;Rsync server PID file is null or not exist!&quot;</span>   <span class="comment">#进程号不存，提示</span></span><br><span class="line">        <span class="built_in">return</span> 1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    start)</span><br><span class="line">        start</span><br><span class="line">        retval=$?</span><br><span class="line">        ;;</span><br><span class="line">    stop)</span><br><span class="line">        stop</span><br><span class="line">        retval=$?</span><br><span class="line">        ;;</span><br><span class="line">    restart)</span><br><span class="line">        stop</span><br><span class="line">        <span class="built_in">sleep</span> 2</span><br><span class="line">        start</span><br><span class="line">        retval=$?</span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        <span class="built_in">echo</span> $<span class="string">&quot;Usage:<span class="variable">$0</span> &#123;start|stop|restart&#125;&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="built_in">exit</span> <span class="variable">$retval</span></span><br></pre></td></tr></table></figure>

<p><strong>Nginx启动脚本解析</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># chkconfig: 2345 21 81</span></span><br><span class="line"><span class="comment"># description: nginx service start and stop scripts</span></span><br><span class="line"><span class="comment"># Author: Felix</span></span><br><span class="line"><span class="comment"># Organization:</span></span><br><span class="line"><span class="comment">###################################################</span></span><br><span class="line"><span class="comment"># File Name: 2.sh</span></span><br><span class="line"><span class="comment"># Created Time: 2019年12月30日 星期一 13时52分38秒</span></span><br><span class="line"><span class="comment"># Version: V1.0</span></span><br><span class="line"><span class="comment"># Author: Felix</span></span><br><span class="line"><span class="comment"># Organization: 360JR OPS</span></span><br><span class="line"><span class="comment">###################################################</span></span><br><span class="line"><span class="comment">#加载自带函数库</span></span><br><span class="line">[ -f /etc/rc.d/init.d/functions ] &amp;&amp; <span class="built_in">source</span> /etc/rc.d/init.d/functions</span><br><span class="line"><span class="comment">#程序锁文件，用来判断程序是否启动</span></span><br><span class="line">lockdir=<span class="string">&#x27;/var/lock/subsys&#x27;</span></span><br><span class="line">lock_file_path=<span class="string">&quot;<span class="variable">$lockdir</span>/nginx&quot;</span></span><br><span class="line">installation_site=<span class="string">&quot;/application/nginx&quot;</span> </span><br><span class="line">sbin=<span class="string">&quot;<span class="variable">$installation_site</span>/sbin/nginx&quot;</span></span><br><span class="line">conf=<span class="string">&quot;<span class="variable">$installation_site</span>/conf/nginx.conf&quot;</span></span><br><span class="line"><span class="comment">#pid文件</span></span><br><span class="line">nginx_pid_file_path=<span class="string">&quot;<span class="variable">$installation_site</span>/logs/nginx.pid&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#成功提示函数</span></span><br><span class="line"><span class="function"><span class="title">log_success_msg</span></span>()&#123;</span><br><span class="line">    <span class="comment">#action为特殊的提示函数，$@为所有参数。</span></span><br><span class="line">    action <span class="string">&quot;SUCCESS! <span class="variable">$@</span>&quot;</span> /bin/true</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#失败提示函数</span></span><br><span class="line"><span class="function"><span class="title">log_failure_msg</span></span>()&#123;</span><br><span class="line">    action <span class="string">&quot;ERROR! <span class="variable">$@</span>&quot;</span> /bin/false</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">start</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> [ -f <span class="variable">$lock_file_path</span> ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">exit</span> 0</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="variable">$sbin</span> -c <span class="variable">$conf</span> &amp;&gt; /dev/null</span><br><span class="line">    gather=$?</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$gather</span> -eq 0 ];<span class="keyword">then</span></span><br><span class="line">        log_success_msg <span class="string">&quot;Nginx is started.&quot;</span></span><br><span class="line">        [ -w <span class="variable">$lockdir</span> ] &amp;&amp; &#123;</span><br><span class="line">            <span class="built_in">touch</span> <span class="variable">$lock_file_path</span></span><br><span class="line">            <span class="built_in">return</span> <span class="variable">$gather</span></span><br><span class="line">        &#125;||&#123;</span><br><span class="line">            log_failure_msg <span class="string">&quot;Nginx lockfile denied&quot;</span></span><br><span class="line">            <span class="built_in">return</span> 1</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        log_failure_msg <span class="string">&quot;Nginx startd failed&quot;</span></span><br><span class="line">        <span class="built_in">return</span> <span class="variable">$gather</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">stop</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> [ -s <span class="variable">$nginx_pid_file_path</span> ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        nginx_pid=$(<span class="built_in">cat</span> <span class="string">&quot;<span class="variable">$nginx_pid_file_path</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">kill</span> -0 <span class="variable">$nginx_pid</span> &amp;&gt;/dev/null)</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">            <span class="variable">$sbin</span> -s stop</span><br><span class="line">            gather=$?</span><br><span class="line">            [ <span class="variable">$gather</span> -eq 0 ]&amp;&amp;&#123;</span><br><span class="line">                log_success_msg <span class="string">&quot;Nginx Stop&quot;</span></span><br><span class="line">                <span class="keyword">if</span> [ -f <span class="string">&quot;<span class="variable">$lock_file_path</span>&quot;</span> ]</span><br><span class="line">                <span class="keyword">then</span></span><br><span class="line">                    <span class="built_in">rm</span> <span class="string">&quot;<span class="variable">$lock_file_path</span>&quot;</span></span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">                <span class="built_in">return</span> <span class="variable">$gather</span></span><br><span class="line">            &#125;||&#123;</span><br><span class="line">                log_failure_msg <span class="string">&quot;Nginx Stop&quot;</span></span><br><span class="line">                <span class="built_in">return</span> <span class="variable">$gather</span></span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            log_failure_msg <span class="string">&quot;Nginx service has not been started&quot;</span></span><br><span class="line">            <span class="built_in">rm</span> <span class="string">&quot;<span class="variable">$nginx_pid_file_path</span>&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        log_failure_msg <span class="string">&quot;Nginx service PID file is null or not exist!&quot;</span></span><br><span class="line">        <span class="built_in">return</span> 1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">reload</span></span>()&#123;</span><br><span class="line">   <span class="variable">$sbin</span> -t &amp;&gt; /dev/null</span><br><span class="line">   <span class="keyword">if</span> [ $? -eq 0 ]</span><br><span class="line">   <span class="keyword">then</span></span><br><span class="line">       <span class="built_in">kill</span> -HUP $(<span class="built_in">cat</span> <span class="string">&quot;<span class="variable">$nginx_pid_file_path</span>&quot;</span>)</span><br><span class="line">       log_success_msg <span class="string">&quot;Nginx Reload&quot;</span></span><br><span class="line">   <span class="keyword">fi</span></span><br><span class="line">   <span class="built_in">return</span> $?</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    start)</span><br><span class="line">        start</span><br><span class="line">        retval=$?</span><br><span class="line">        ;;</span><br><span class="line">    stop)</span><br><span class="line">        stop</span><br><span class="line">        retval=$?</span><br><span class="line">        ;;</span><br><span class="line">    restart)</span><br><span class="line">        stop</span><br><span class="line">        <span class="built_in">sleep</span> 2</span><br><span class="line">        start</span><br><span class="line">        retval=$?</span><br><span class="line">        ;;</span><br><span class="line">    reload)</span><br><span class="line">        reload</span><br><span class="line">        retval=$?</span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        <span class="built_in">echo</span> $<span class="string">&quot;Usage:<span class="variable">$0</span> &#123;start|stop|restart|reload&#125;&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="built_in">exit</span> <span class="variable">$retval</span></span><br></pre></td></tr></table></figure>
<h3 id="C7启动脚本"><a href="#C7启动脚本" class="headerlink" title="C7启动脚本"></a>C7启动脚本</h3><p>手动编写脚本，一般会在源码包安装时使用。<br>systemd有系统和用户区分；系统（<code>/user/lib/systemd/system/</code>）、用户（<code>/etc/lib/systemd/user/</code>）.一般系统管理员手工创建的单元文件建议存放在<code>/etc/systemd/system/</code>目录下面;每一个服务以.service结尾，一般会分为3部分：[Unit]、[Service]和[Install]</p>
<p><code>vim /usr/lib/systemd/system/服务名.service</code></p>
<p>脚本的内容格式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[Unit]:服务的说明模块</span><br><span class="line">Description:描述服务</span><br><span class="line">Documentation=man:sshd(8) man:sshd_config(5) :文档列表说明</span><br><span class="line">After:服务依赖类别说明</span><br><span class="line">Wants=sshd-keygen.service:可选的依赖服务</span><br><span class="line"></span><br><span class="line">[Service]服务运行参数的设置</span><br><span class="line">Type=forking是后台运行的形式</span><br><span class="line">PIDFile为存放PID的文件路径</span><br><span class="line">EnvironmentFile=/etc/sysconfig/sshd环境变量等的配置文件</span><br><span class="line">ExecStart为服务的具体运行命令</span><br><span class="line">ExecReload为重启命令</span><br><span class="line">ExecStop为停止命令</span><br><span class="line">PrivateTmp=True表示给服务分配独立的临时空间</span><br><span class="line">注意：启动、重启、停止命令全部要求使用绝对路径</span><br><span class="line"></span><br><span class="line">[Install]服务安装的相关设置，可设置为多用户</span><br><span class="line">WantedBy=multi-user.target这里为设置多用户级别。可为空格分隔的列表， 表示在使用 systemctl <span class="built_in">enable</span> 启用此单元时， 将会在对应的目录设置对应文件的软连接/etc/systemd/system/multi-user.target.wants/目录下新建一个/usr/lib/systemd/system/nginx.service 文件的链接。想对应，可以用 <span class="built_in">disable</span> 把它从 wants 目录给删除</span><br></pre></td></tr></table></figure>
<p><strong>附录：</strong></p>
<ul>
<li>Type=simple（默认值）：systemd认为该服务将立即启动。服务进程不会fork。如果该服务要启动其他服务，不要使用此类型启动，除非该服务是socket激活型。</li>
<li>Type=forking：systemd认为当该服务进程fork，且父进程退出后服务启动成功。对于常规的守护进程（daemon），除非你确定此启动方式无法满足需求，使用此类型启动即可。使用此启动类型应同时指定 PIDFile=，以便systemd能够跟踪服务的主进程。</li>
<li>Type=oneshot：这一选项适用于只执行一项任务、随后立即退出的服务。可能需要同时设置 RemainAfterExit=yes 使得 systemd 在服务进程退出之后仍然认为服务处于激活状态。</li>
<li>Type=notify：与 Type=simple 相同，但约定服务会在就绪后向 systemd 发送一个信号。这一通知的实现由 libsystemd-daemon.so 提供。</li>
<li>Type=dbus：若以此方式启动，当指定的 BusName 出现在DBus系统总线上时，systemd认为服务就绪。</li>
</ul>
<p>编写php-fpm的启动脚本</p>
<ol>
<li>创建php-fpm.service 脚本文件<br><code>vim /usr/lib/systemd/system/nginx.service</code></li>
<li>编写脚本内容<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=php</span><br><span class="line">After=network.target remote-fs.target nss-lookup.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/usr/local/php/sbin/php-fpm</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="PPTP安装脚本"><a href="#PPTP安装脚本" class="headerlink" title="PPTP安装脚本"></a>PPTP安装脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line"><span class="comment"># Check if user is root</span></span><br><span class="line">[ $(<span class="built_in">id</span> -u) != <span class="string">&quot;0&quot;</span> ] &amp;&amp; &#123; <span class="built_in">echo</span> -e <span class="string">&quot;\033[31mError: You must be root to run this script\033[0m&quot;</span>; <span class="built_in">exit</span> 1; &#125; </span><br><span class="line">clear</span><br><span class="line"></span><br><span class="line"><span class="comment">#文件不存在则执行安装</span></span><br><span class="line">[ ! -e <span class="string">&#x27;/usr/bin/curl&#x27;</span> ] &amp;&amp; yum -y install curl</span><br><span class="line"></span><br><span class="line"><span class="comment">#获取公网IP</span></span><br><span class="line">VPN_IP=`curl ipv4.icanhazip.com`</span><br><span class="line"><span class="comment">#网关</span></span><br><span class="line">VPN_LOCAL=<span class="string">&quot;192.168.0.150&quot;</span></span><br><span class="line"><span class="comment">#地址池</span></span><br><span class="line">VPN_REMOTE=<span class="string">&quot;192.168.0.151-200&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#输入内容不为空则跳出循环</span></span><br><span class="line"><span class="keyword">while</span> :; <span class="keyword">do</span> <span class="built_in">echo</span></span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;Please input UserName: &quot;</span> VPN_USER </span><br><span class="line">    [ -n <span class="string">&quot;<span class="variable">$VPN_USER</span>&quot;</span> ] &amp;&amp; <span class="built_in">break</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#输入内容不为空则跳出循环</span></span><br><span class="line"><span class="keyword">while</span> :; <span class="keyword">do</span> <span class="built_in">echo</span></span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;Please input PassWord: &quot;</span> VPN_PASS</span><br><span class="line">    [ -n <span class="string">&quot;<span class="variable">$VPN_PASS</span>&quot;</span> ] &amp;&amp; <span class="built_in">break</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">clear</span><br><span class="line"></span><br><span class="line"><span class="comment">#判断是文件是否存在&amp;&amp;过滤出的字符串长度是否为0。如果不为0就是C7系统</span></span><br><span class="line"><span class="comment">#if [ -f /etc/redhat-release -a -n &quot;`grep &#x27; 7\.&#x27; /etc/redhat-release`&quot; ];then</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#判断是文件是否存在&amp;&amp;过滤出的字符串长度是否为0。如果不为0就是C6系统</span></span><br><span class="line">[ -f /etc/redhat-release -a -n <span class="string">&quot;`grep &#x27; 6\.&#x27; /etc/redhat-release`&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="title">C7</span></span>()&#123;  </span><br><span class="line">    <span class="comment">#CentOS_REL=7 安装epel源</span></span><br><span class="line">    <span class="keyword">if</span> [ ! -e /etc/yum.repos.d/epel.repo ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">cat</span> &gt; /etc/yum.repos.d/epel.repo &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">[epel]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux 7 - <span class="variable">$basearch</span></span><br><span class="line"><span class="comment">#baseurl=http://download.fedoraproject.org/pub/epel/7/$basearch</span></span><br><span class="line">mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-7&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span></span><br><span class="line">failovermethod=priority</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">EOF</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="comment">#安装依赖包，和iptables</span></span><br><span class="line">    <span class="keyword">for</span> Package <span class="keyword">in</span> wget make openssl gcc-c++ ppp pptpd iptables iptables-services </span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">        yum -y install <span class="variable">$Package</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">	[ $? -ne 0 ] &amp;&amp; <span class="built_in">exit</span> 1</span><br><span class="line">    <span class="comment">#开启防火墙转发功能</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&#x27;net.ipv4.ip_forward = 1&#x27;</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">C6</span></span>()&#123;</span><br><span class="line">    <span class="comment">#CentOS_REL=6</span></span><br><span class="line">    <span class="keyword">for</span> Package <span class="keyword">in</span> wget make openssl gcc-c++ iptables ppp </span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">        yum -y install <span class="variable">$Package</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    </span><br><span class="line">    [ $? -eq 0 ] &amp;&amp; &#123;</span><br><span class="line">    sed -i <span class="string">&#x27;s@net.ipv4.ip_forward.*@net.ipv4.ip_forward = 1@g&#x27;</span> /etc/sysctl.conf</span><br><span class="line">    rpm -Uvh http://poptop.sourceforge.net/yum/stable/rhel6/pptp-release-current.noarch.rpm</span><br><span class="line">    yum -y install pptpd</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="built_in">return</span> $?</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">es</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\033[31mDoes not support this OS, Please contact the author! \033[0m&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">conf</span></span>()&#123;</span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ]</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;1&quot;</span> &gt; /proc/sys/net/ipv4/ip_forward</span><br><span class="line">    sysctl -p /etc/sysctl.conf</span><br><span class="line">    <span class="comment">#pptpd.conf配置</span></span><br><span class="line">    <span class="comment"># Local IP address of your VPN server</span></span><br><span class="line">    [ -z <span class="string">&quot;`grep &#x27;^localip&#x27; /etc/pptpd.conf`&quot;</span> ] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;localip <span class="variable">$VPN_LOCAL</span>&quot;</span> &gt;&gt; /etc/pptpd.conf </span><br><span class="line">    </span><br><span class="line">    <span class="comment">#Scope for your home network</span></span><br><span class="line">    [ -z <span class="string">&quot;`grep &#x27;^remoteip&#x27; /etc/pptpd.conf`&quot;</span> ] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;remoteip <span class="variable">$VPN_REMOTE</span>&quot;</span> &gt;&gt; /etc/pptpd.conf </span><br><span class="line">    </span><br><span class="line">    [ -z <span class="string">&quot;`grep &#x27;^stimeout&#x27; /etc/pptpd.conf`&quot;</span> ] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;stimeout 172800&quot;</span> &gt;&gt; /etc/pptpd.conf</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#dns配置</span></span><br><span class="line">    <span class="keyword">if</span> [ -z <span class="string">&quot;`grep &#x27;^ms-dns&#x27; /etc/ppp/options.pptpd`&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">         <span class="built_in">cat</span> &gt;&gt; /etc/ppp/options.pptpd &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">ms-dns 223.5.5.5 # Aliyun DNS Primary</span></span><br><span class="line"><span class="string">ms-dns 114.114.114.114 # 114 DNS Primary</span></span><br><span class="line"><span class="string">ms-dns 8.8.8.8 # Google DNS Primary</span></span><br><span class="line"><span class="string">ms-dns 209.244.0.3 # Level3 Primary</span></span><br><span class="line"><span class="string">ms-dns 208.67.222.222 # OpenDNS Primary</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">    <span class="comment">#账号密码配置</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$VPN_USER</span> pptpd <span class="variable">$VPN_PASS</span> *&quot;</span> &gt;&gt; /etc/ppp/chap-secrets</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">FiWa</span></span>()&#123;</span><br><span class="line">ETH=`route | grep default | awk <span class="string">&#x27;&#123;print $NF&#125;&#x27;</span>`</span><br><span class="line">iptables -F</span><br><span class="line">iptables -X</span><br><span class="line">iptables -Z</span><br><span class="line"><span class="comment">#允许22端口</span></span><br><span class="line">iptables -A INPUT -p tcp -m tcp --dport 22 -j ACCEPT</span><br><span class="line"><span class="comment">#允许本地环回口</span></span><br><span class="line">iptables -A INPUT -i lo -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment">#允许pptp端口，针对已经或即将启动的新链接</span></span><br><span class="line">[ -z <span class="string">&quot;`grep &#x27;1723 -j ACCEPT&#x27; /etc/sysconfig/iptables`&quot;</span> ] &amp;&amp; iptables -I INPUT 1 -p tcp -m state --state NEW -m tcp --dport 1723 -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment">#允许47端口</span></span><br><span class="line">[ -z <span class="string">&quot;`grep &#x27;gre -j ACCEPT&#x27; /etc/sysconfig/iptables`&quot;</span> ] &amp;&amp; iptables -I INPUT 2 -p gre -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment">#只放行关系连接和回应报文，防止攻击</span></span><br><span class="line">iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br><span class="line">iptables -t nat -A POSTROUTING -o <span class="variable">$ETH</span> -j MASQUERADE</span><br><span class="line">iptables -I FORWARD -p tcp --syn -i ppp+ -j TCPMSS --set-mss 1356</span><br><span class="line">service iptables save</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sed -i <span class="string">&#x27;s@^-A INPUT -j REJECT --reject-with icmp-host-prohibited@#-A INPUT -j REJECT --reject-with icmp-host-prohibited@&#x27;</span> /etc/sysconfig/iptables </span><br><span class="line">sed -i <span class="string">&#x27;s@^-A FORWARD -j REJECT --reject-with icmp-host-prohibited@#-A FORWARD -j REJECT --reject-with icmp-host-prohibited@&#x27;</span> /etc/sysconfig/iptables </span><br><span class="line">service iptables restart</span><br><span class="line">chkconfig iptables on</span><br><span class="line">&#125;</span><br><span class="line">service pptpd restart</span><br><span class="line">chkconfig pptpd on</span><br><span class="line">clear</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;You can now connect to your VPN via your external IP \033[32m<span class="variable">$&#123;VPN_IP&#125;</span>\033[0m&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;Username: \033[32m<span class="variable">$&#123;VPN_USER&#125;</span>\033[0m&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;Password: \033[32m<span class="variable">$&#123;VPN_PASS&#125;</span>\033[0m&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="while"><a href="#while" class="headerlink" title="while"></a>while</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> &lt;条件表达式&gt;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">   命令集</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> &lt;条件表达式&gt;;<span class="keyword">do</span></span><br><span class="line">    命令集</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p><strong>计算器无限循环</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/bin/bash</span></span><br><span class="line"><span class="comment">#1.判断是否为两个参数</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line"><span class="comment">#如果用户未输入，就一直进行循环。否则跳出循环 进行下面的判断</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;Please enter two Numbers：&quot;</span> x y</span><br><span class="line"><span class="keyword">if</span> [ -z <span class="variable">$x</span> -o -z <span class="variable">$y</span> ]</span><br><span class="line"><span class="keyword">then</span> </span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$0</span> num1 num2 ✔&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">break</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#if [ $# -ne 2 ]</span></span><br><span class="line"><span class="comment">#    then</span></span><br><span class="line"><span class="comment">#    echo &quot;$0 num1 num2 ✔&quot;</span></span><br><span class="line"><span class="comment">#    exit 1</span></span><br><span class="line"><span class="comment">#fi</span></span><br><span class="line"><span class="comment">#2.判断参数是否为数字</span></span><br><span class="line"><span class="built_in">expr</span> <span class="variable">$x</span> + <span class="variable">$y</span> + 100 &amp;&gt;/dev/null</span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;[data ok]:<span class="variable">$x</span> <span class="variable">$y</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;请输入两个正确的整数！&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 2</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3.开始计算</span></span><br><span class="line">a=<span class="variable">$x</span></span><br><span class="line">b=<span class="variable">$y</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$a</span>+<span class="variable">$b</span>=$((a+b))</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$a</span>-<span class="variable">$b</span>=$((a-b))</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$a</span>^<span class="variable">$b</span>=$((a**b))</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$b</span> -eq 0 ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;[error] 除数为0，取余和除法不能计算。×&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="variable">$a</span>/<span class="variable">$b</span>=$((a/b))</span><br><span class="line">   <span class="built_in">echo</span> <span class="variable">$a</span>%<span class="variable">$b</span>=$((a%b))</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p><strong>检查URL是否正常</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/bin/bash</span></span><br><span class="line">[ -f /etc/init.d/functions ] &amp;&amp; . /etc/init.d/functions</span><br><span class="line"><span class="function"><span class="title">usage</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> [[ ! <span class="variable">$1</span> =~ http://.*$ ]]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Usage:<span class="variable">$0</span> http://www.xxx.com&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">check_url</span></span>()&#123;</span><br><span class="line">    wget -q -o /dev/null --spider --tries=1 -T 5 <span class="variable">$1</span></span><br><span class="line">    retval=$?</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$retval</span> -eq 0 ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        action <span class="string">&quot;URL is ok&quot;</span> /bin/true</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        action <span class="string">&quot;URL is no&quot;</span> /bin/false</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">main</span></span>()&#123;</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">    usage <span class="variable">$1</span></span><br><span class="line">    check_url <span class="variable">$1</span></span><br><span class="line">    <span class="built_in">sleep</span> 2</span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main $*</span><br></pre></td></tr></table></figure>

<p><strong>计算从1++到100</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> 1 <span class="comment">#!/bin/bash</span></span><br><span class="line"> 2 <span class="comment">###################################################</span></span><br><span class="line"> 3 <span class="comment"># File Name: 1+100.sh  </span></span><br><span class="line"> 4 <span class="comment"># Created Time: Thu 09 Jan 2020 03:23:14 PM CST</span></span><br><span class="line"> 5 <span class="comment"># Version: V1.0 </span></span><br><span class="line"> 6 <span class="comment"># Author: Felix </span></span><br><span class="line"> 7 <span class="comment"># Organization: 360JR OPS</span></span><br><span class="line"> 8 <span class="comment">###################################################</span></span><br><span class="line"> 9 <span class="built_in">sum</span>=0    </span><br><span class="line">10 i=1                                                                                                                 </span><br><span class="line">11 <span class="keyword">while</span> [ <span class="variable">$i</span> -lt 101 ]</span><br><span class="line">12 <span class="keyword">do</span>  </span><br><span class="line">13     ((sum=<span class="variable">$sum</span>+<span class="variable">$i</span>))  &lt;==<span class="built_in">let</span>的话不要加$</span><br><span class="line">14     ((i++))</span><br><span class="line">15 <span class="keyword">done</span></span><br><span class="line">16 <span class="built_in">echo</span> <span class="variable">$sum</span></span><br></pre></td></tr></table></figure>

<p><strong>读入文件里的年龄并计算</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@KFSAMBA ~]<span class="comment"># cat age.txt </span></span><br><span class="line">feichi 20</span><br><span class="line">feichi01 22</span><br><span class="line">feichi02 23</span><br><span class="line">feichi03 24</span><br><span class="line">feichi04 25</span><br><span class="line">[root@KFSAMBA ~]<span class="comment"># cat age.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">###################################################</span></span><br><span class="line"><span class="comment"># File Name: age.sh</span></span><br><span class="line"><span class="comment"># Created Time: Fri 10 Jan 2020 01:02:34 PM CST</span></span><br><span class="line"><span class="comment"># Version: V1.0</span></span><br><span class="line"><span class="comment"># Author: Felix</span></span><br><span class="line"><span class="comment"># Organization: 360JR OPS</span></span><br><span class="line"><span class="comment">###################################################</span></span><br><span class="line">age=0</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line  &lt;==一行一行读入</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    i=`<span class="built_in">echo</span> <span class="variable">$line</span> | awk -F<span class="string">&quot; &quot;</span> <span class="string">&#x27;&#123;print $NF&#125;&#x27;</span>`  &lt;==通过awk取年龄</span><br><span class="line">    ((age=<span class="variable">$age</span>+<span class="variable">$i</span>))  &lt;==计算赋值</span><br><span class="line"><span class="keyword">done</span>&lt;./age.txt </span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$age</span></span><br></pre></td></tr></table></figure>

<h3 id="生成随机数"><a href="#生成随机数" class="headerlink" title="生成随机数"></a>生成随机数</h3><ol>
<li><p>使用openssl生成随机密码<br><code>openssl rand -base64 20</code>几乎所有Linux发行版都包含openssl。我们可以利用它的随机功能来生成可以用作密码的随机字母字符串，其中后面的数字10和20是指定密码的长度。</p>
</li>
<li><p>使用urandom生成随机密码<br><code>strings /dev/urandom |tr -dc A-Za-z0-9 | head -c20; echo</code></p>
</li>
</ol>
<ul>
<li>tr -dc 保留哪些字符</li>
</ul>
<ol start="3">
<li><code>$RANDOM</code>：<br>作用：可以随机生成0~32767之间的整数数字</li>
</ol>
<p><img src="/images/pasted-276.png" alt="RANDOM"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$RANDOM</span>|<span class="built_in">md5sum</span>|<span class="built_in">cut</span> -c 1-10|<span class="built_in">tr</span> <span class="string">&quot;[A-Z0-9]&quot;</span> <span class="string">&quot;[a-z]&quot;</span></span><br><span class="line">       随机数      md5计算   截取1-10  替换数字为字符</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><p>UUID随机数<br><code>cat /proc/sys/kernel/random/uuid</code></p>
</li>
<li><p>使用md5sum生成随机密码<br><code>date |md5sum</code><br>以上是用Linux命令生成随机密码，除此之外还可以使用第三方工具进行生成，如mkpasswd、randpw、pwgen、spw，gpg、xkcdpass等，有兴趣的可以了解一下！</p>
</li>
<li><p>mkpasswd命令<br>mkpasswd命令 是make password的简写。可以随机生成字符串。<br>安装：<code>yum install -y expect</code><br>语法：<br>mkpasswd [选项] [参数]<br>选项：</p>
</li>
</ol>
<ul>
<li>-l：指定长度</li>
<li>-d：数字的个数</li>
<li>-c：小写字母个数</li>
<li>-C：大写字母个数</li>
<li>-s：特殊字符个数</li>
</ul>
<p><strong>随机文件生成</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[ ! -d felix ] &amp;&amp; <span class="built_in">mkdir</span> -p felix</span><br><span class="line"><span class="built_in">cd</span> felix/</span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;How many do I need to create: &quot;</span> x</span><br><span class="line">c=`<span class="built_in">seq</span> <span class="variable">$x</span>`</span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> <span class="variable">$c</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    prefix=`<span class="built_in">date</span> +%N|<span class="built_in">md5sum</span>| <span class="built_in">echo</span> <span class="variable">$RANDOM</span>|<span class="built_in">md5sum</span>|<span class="built_in">cut</span> -c 1-6|<span class="built_in">tr</span> <span class="string">&#x27;[0-9]&#x27;</span> <span class="string">&#x27;[a-z]&#x27;</span>`</span><br><span class="line">    <span class="built_in">touch</span> <span class="variable">$&#123;prefix&#125;</span>_felix.html</span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$n</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p><strong>脚本执行技巧</strong><br>后台执行脚本<br><img src="/images/pasted-274.png" alt="后台执行脚本"><br>杀死后台脚本<br><img src="/images/pasted-275.png" alt="杀死后台脚本"></p>
<p><strong>简单的文本处理</strong><br><img src="/images/pasted-277.png" alt="简单的文本处理"></p>
<p><strong>随机文件+批量改名</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">批量创建随机文件</span><br><span class="line">[ ! -d felix ] &amp;&amp; <span class="built_in">mkdir</span> -p felix</span><br><span class="line"><span class="built_in">cd</span> felix/</span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;How many do I need to create: &quot;</span> x</span><br><span class="line">c=`<span class="built_in">seq</span> <span class="variable">$x</span>`</span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> <span class="variable">$c</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    prefix=`<span class="built_in">date</span> +%N|<span class="built_in">md5sum</span>|<span class="built_in">cut</span> -c 1-6|<span class="built_in">tr</span> <span class="string">&#x27;[0-9]&#x27;</span> <span class="string">&#x27;[a-z]&#x27;</span>`</span><br><span class="line">    <span class="built_in">touch</span> <span class="variable">$&#123;prefix&#125;</span>_felix.html</span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$n</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">批量修改文件</span><br><span class="line">方法1：<span class="keyword">for</span>循环</span><br><span class="line">files=`<span class="built_in">ls</span> felix/`</span><br><span class="line"><span class="built_in">cd</span> felix</span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> <span class="variable">$files</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">   <span class="built_in">mv</span> <span class="variable">$file</span> <span class="variable">$&#123;file//felix.html/feieileks.HTML&#125;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">方法2：rename命令</span><br><span class="line">rename from  to towards</span><br><span class="line">例：飞驰.html 改成马飞飞.html</span><br><span class="line">rename 飞驰.html 马飞飞.html *飞驰.html</span><br><span class="line">            源文件名 目标文件名  针对哪些文件进行修改</span><br><span class="line"></span><br><span class="line">方法3：拼接法</span><br><span class="line">[root@KFSAMBA ~/felix]<span class="comment"># ls | awk -F &#x27;_&#x27; &#x27;&#123;print &quot;mv&quot;,$0,$1&quot;_felix.html&quot;&#125;&#x27; | bash</span></span><br><span class="line">bcechf_felix.html  cfbbbc_felix.html  djeaad_felix.html  fchafb_felix.html  hcgagf_felix.html</span><br></pre></td></tr></table></figure>

<p><strong>ddos防御</strong></p>
<blockquote>
<p>思路：查ESTABLISHED并对其进行排序去重，看ESTABLISHED状态下是否有IP大于指定次数。如果大于指定次数就利用防火墙进行屏蔽。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">###################################################</span></span><br><span class="line"><span class="comment"># File Name: ctrl_ddos.sh</span></span><br><span class="line"><span class="comment"># Created Time: Tue 14 Jan 2020 02:36:15 PM CST</span></span><br><span class="line"><span class="comment"># Version: V1.0</span></span><br><span class="line"><span class="comment"># Author: Felix</span></span><br><span class="line"><span class="comment"># Organization: 360JR OPS</span></span><br><span class="line"><span class="comment">###################################################</span></span><br><span class="line">[ -f /etc/init.d/functions ] &amp;&amp; . /etc/init.d/functions</span><br><span class="line"><span class="built_in">log</span>=/tmp/ip.log</span><br><span class="line"><span class="function"><span class="title">pan</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$1</span> -eq 0 ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        action <span class="string">&quot;<span class="variable">$2</span>&quot;</span> /bin/true</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        action <span class="string">&quot;<span class="variable">$2</span>&quot;</span> /bin/false</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">defense</span></span>()&#123;</span><br><span class="line">netstat -na | awk -F<span class="string">&#x27;[ :]+&#x27;</span> <span class="string">&#x27;$NF~/ESTABLISHED/&#123;print $(NF-2)&#125;&#x27;</span>|<span class="built_in">sort</span>|<span class="built_in">uniq</span> -c|<span class="built_in">sort</span> -nr|<span class="built_in">head</span> -10 &gt; <span class="variable">$log</span> &amp;&amp; <span class="built_in">echo</span> --operation: <span class="variable">$i</span>--</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    ip=`<span class="built_in">echo</span> <span class="variable">$line</span>|awk <span class="string">&#x27;&#123;print $(NF)&#125;&#x27;</span>`</span><br><span class="line">    zahl=`<span class="built_in">echo</span> <span class="variable">$line</span>|awk <span class="string">&#x27;&#123;print $(NF-1)&#125;&#x27;</span>`</span><br><span class="line">    fw=`iptables -nL|grep -w <span class="variable">$ip</span> |<span class="built_in">wc</span> -l`</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$zahl</span> -gt 10 ] &amp;&amp; [ <span class="variable">$fw</span> -eq 0 ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        pan 1 <span class="string">&quot;Source IP: <span class="variable">$ip</span>&quot;</span></span><br><span class="line">        iptables -I INPUT -s <span class="variable">$ip</span> -j DROP</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        pan 0 <span class="string">&quot;Source IP: <span class="variable">$ip</span>&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span>&lt;<span class="variable">$log</span></span><br><span class="line">    ((i++))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">main</span></span>()&#123;</span><br><span class="line">   <span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line">   <span class="keyword">do</span></span><br><span class="line">       <span class="built_in">sleep</span> 5</span><br><span class="line">       defense</span><br><span class="line">   <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> :;<span class="keyword">do</span></span><br><span class="line">    <span class="built_in">read</span> -p<span class="string">&quot;是否启动DDOS主动防御 [Y/n] &quot;</span> n</span><br><span class="line">    [ -n <span class="variable">$&#123;n:=y&#125;</span> ] &amp;&amp; <span class="built_in">break</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">gather=`<span class="built_in">echo</span> <span class="variable">$n</span>|<span class="built_in">tr</span> [A-Z] [a-z]`</span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$&#123;gather&#125;</span>&quot;</span> = <span class="string">&quot;y&quot;</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    pan 0 <span class="string">&quot;已开启&quot;</span></span><br><span class="line">    main</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    pan 1 <span class="string">&quot;<span class="variable">$gather</span> 未识别&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p><strong>单词长度判断</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#判断句子中的单词是否大于三个字母</span></span><br><span class="line"><span class="built_in">log</span>=<span class="string">&quot;To be or not to be that is a question&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$log</span></span><br><span class="line"><span class="keyword">for</span> l <span class="keyword">in</span> <span class="variable">$log</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;#l&#125;</span> -le 3 ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;这是不大于3个字母的单词&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$l</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;这是大于3个字母的单词&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$l</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p><strong>华为华三交换机配置备份</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">###################################################</span></span><br><span class="line"><span class="comment"># File Name: back_swcfg.sh</span></span><br><span class="line"><span class="comment"># Created Time: Thu Jan 16 12:27:00 2020</span></span><br><span class="line"><span class="comment"># Version: V2.0</span></span><br><span class="line"><span class="comment"># Author: Felix</span></span><br><span class="line"><span class="comment"># Organization: 360JR OPS</span></span><br><span class="line"><span class="comment">###################################################</span></span><br><span class="line">[ -f /etc/init.d/functions ] &amp;&amp; . /etc/init.d/functions</span><br><span class="line">[ <span class="variable">$UID</span> -ne 0 ] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;Please use the root account!&quot;</span> &amp;&amp; <span class="built_in">exit</span> 1</span><br><span class="line"><span class="function"><span class="title">pan</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$1</span> -eq 0 ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        action <span class="string">&quot;<span class="variable">$2</span>&quot;</span> /bin/true</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        action <span class="string">&quot;<span class="variable">$2</span>&quot;</span> /bin/false</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sw=(`<span class="built_in">seq</span> 1 16` `<span class="built_in">seq</span> 31 47` 61 `<span class="built_in">seq</span> 63 76`)</span><br><span class="line"><span class="built_in">date</span>=`<span class="built_in">date</span> +%F`</span><br><span class="line">net=<span class="string">&quot;10.93.130.&quot;</span></span><br><span class="line">logfile=<span class="string">&quot;/cfgdata/backup_cfg.log&quot;</span></span><br><span class="line">cfgname=<span class="string">&quot;startup.cfg&quot;</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /cfgdata/<span class="variable">$date</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&#x27;SAMBA:\\\10.93.131.251\SWCFG USER:zjadmin PASS:591740 \nAutomatic backup every Friday morning at 1:30 a.m\n&#x27;</span> &gt; <span class="variable">$logfile</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The SWCFG backup situation:&quot;</span> &gt;&gt; <span class="variable">$logfile</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$&#123;sw[@]&#125;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    sshpass -p admin=h3c scp admin@<span class="variable">$&#123;net&#125;</span><span class="variable">$&#123;i&#125;</span>:flash:/<span class="variable">$cfgname</span> /cfgdata/<span class="variable">$date</span>/<span class="variable">$&#123;net&#125;</span><span class="variable">$&#123;i&#125;</span>_<span class="variable">$cfgname</span></span><br><span class="line">    cfg_file=<span class="string">&quot;/cfgdata/<span class="variable">$date</span>/<span class="variable">$&#123;net&#125;</span><span class="variable">$&#123;i&#125;</span>_<span class="variable">$cfgname</span>&quot;</span></span><br><span class="line">    <span class="keyword">if</span> [ -f <span class="variable">$cfg_file</span> ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        pan 0 <span class="string">&quot;<span class="variable">$cfg_file</span> BACKUP&quot;</span> </span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$cfg_file</span>  BACKUP   [OK]&quot;</span> &gt;&gt; <span class="variable">$logfile</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        pan 1 <span class="string">&quot;<span class="variable">$cfg_file</span> BACKUP&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$cfg_file</span>  BACKUP   [BAD!]&quot;</span> &gt;&gt; <span class="variable">$logfile</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">find /cfgdata/ -<span class="built_in">type</span> d -mtime +30 | xargs <span class="built_in">rm</span> -rf </span><br><span class="line">mail -s <span class="string">&quot;<span class="subst">$(date +%S_%T)</span> ZJSW Configuration file backup report!&quot;</span> liwenjie@360jinrong.net &lt;  <span class="variable">$logfile</span></span><br><span class="line">mail -s <span class="string">&quot;<span class="subst">$(date +%S_%T)</span> ZJSW Configuration file backup report!&quot;</span> yaofeichi-jk@360jinrong.net &lt;  <span class="variable">$logfile</span></span><br></pre></td></tr></table></figure>

<h3 id="循环状态控制"><a href="#循环状态控制" class="headerlink" title="循环状态控制"></a>循环状态控制</h3><p><img src="/images/pasted-278.png" alt="循环状态控制"></p>
<p><strong>随机MD5破解</strong><br><img src="/images/pasted-279.png" alt="随机MD5破解"><br>f4cb084dc0  &lt;==破解这个</p>
<p>原理：$RANDOM可以随机生成0~32767</p>
<ol>
<li><p>利用seq进行生成seq 0 32767</p>
</li>
<li><p>利用md5进行加密运算并前1-10位和源字符串进行比对</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;计算中...&quot;</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> `<span class="built_in">seq</span> 0 32767`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    pass=`<span class="built_in">echo</span> <span class="variable">$x</span>|<span class="built_in">md5sum</span>|<span class="built_in">cut</span> -c 1-10`  &lt;==此处有小问题</span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$pass</span>&quot;</span> == <span class="string">&quot;f4cb084dc0&quot;</span> ] </span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Calculate the number to be <span class="variable">$x</span>!&quot;</span></span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p>正解:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;计算中...&quot;</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> `<span class="built_in">seq</span> 0 32767`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    pass=`<span class="built_in">echo</span> <span class="variable">$x</span>|<span class="built_in">md5sum</span>`</span><br><span class="line">    <span class="keyword">if</span> [[ <span class="variable">$pass</span> =~ ^.*f4cb084dc0.*$ ]]   <span class="comment">#正则匹配</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Calculate the number to be <span class="variable">$x</span>!&quot;</span></span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#数组改编判断单词长度</span></span><br><span class="line">array=(1 2 3 4 5)</span><br><span class="line"><span class="built_in">log</span>=(To be or not to be that is a questio)</span><br><span class="line">i=0                                       </span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$i</span> -lt <span class="variable">$&#123;#log[@]&#125;</span> ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;#log[i]&#125;</span> -le 3 ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;此单词 <span class="variable">$&#123;log[i]&#125;</span>，小于等于3&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;此单词 <span class="variable">$&#123;log[i]&#125;</span>，大于3&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    ((i++))</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">length=(To be or not to be that is a questio)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;length[*]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">for</span>((i=<span class="number">0</span>;i&lt;<span class="variable">$&#123;#length[*]&#125;</span>;i++))</span><br><span class="line"><span class="keyword">do</span>   </span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;#length[i]&#125;</span> -ge 3 ]               </span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;length[i]&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">#检查url</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">[ -f /etc/init.d/functions ] &amp;&amp; . /etc/init.d/functions</span><br><span class="line">url_arr=(</span><br><span class="line">    https://www.baidu.com/</span><br><span class="line">    https://www.qq.com/</span><br><span class="line">    https://www.jd.com/</span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="title">pan</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$1</span> -eq 0 ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        action <span class="string">&quot;<span class="variable">$2</span>&quot;</span> /bin/true</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        action <span class="string">&quot;<span class="variable">$2</span>&quot;</span> /bin/false</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">check_url</span></span>()&#123;</span><br><span class="line">    wget -q -o /dev/null --spider --tries=1 -T 5 <span class="variable">$1</span></span><br><span class="line">    retval=$?</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$retval</span> -eq 0 ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        pan 0 <span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        pan 1 <span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">loop</span></span>()&#123;</span><br><span class="line">    <span class="keyword">for</span> url <span class="keyword">in</span> <span class="variable">$@</span></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">        check_url <span class="variable">$url</span></span><br><span class="line">        <span class="built_in">sleep</span> 2</span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">main</span></span>()&#123;</span><br><span class="line">    <span class="keyword">while</span> :;<span class="keyword">do</span></span><br><span class="line">        loop <span class="variable">$&#123;url_arr[*]&#125;</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line">main</span><br></pre></td></tr></table></figure>



<h1 id="定时任务"><a href="#定时任务" class="headerlink" title="定时任务"></a>定时任务</h1><p><img src="/images/pasted-237.png" alt="cron"><br><strong>用户的定时任务</strong></p>
<ul>
<li><code>cron</code> 定时任务的软件名</li>
<li><code>crond</code> 服务进程名</li>
<li><code>crontab</code> 命令是用来设置定时任务规则的配置命令</li>
</ul>
<p><strong>语法：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@lihuaning ~]<span class="comment"># cat /etc/crontab </span></span><br><span class="line">SHELL=/bin/bash</span><br><span class="line">PATH=/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line">MAILTO=root</span><br><span class="line"></span><br><span class="line"><span class="comment"># For details see man 4 crontabs</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Example of job definition:</span></span><br><span class="line"><span class="comment"># .---------------- minute (0 - 59)</span></span><br><span class="line"><span class="comment"># |  .------------- hour (0 - 23)</span></span><br><span class="line"><span class="comment"># |  |  .---------- day of month (1 - 31)</span></span><br><span class="line"><span class="comment"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span></span><br><span class="line"><span class="comment"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span></span><br><span class="line"><span class="comment"># |  |  |  |  |</span></span><br><span class="line"><span class="comment"># *  *  *  *  * (command to be executed)</span></span><br></pre></td></tr></table></figure>
<p><strong>共6列：</strong></p>
<ol>
<li>分钟（0-59） </li>
<li>小时（0-23） </li>
<li>日（1-31）</li>
<li>月（1-12）</li>
<li>周（0-6）</li>
<li>要执行的命令或程序</li>
</ol>
<p><strong>特殊字符：</strong></p>
<ul>
<li>* &lt;==每，每个<ul>
<li>00 23 * * * cmd &lt;==每天的23:00执行cmd</li>
</ul>
</li>
<li>- &lt;==连续的区间<ul>
<li>00 8-23 * * * cmd &lt;==每天的8:00 9:00 …23:00 执行cmd</li>
</ul>
</li>
<li>列举 1,2,5,8<ul>
<li>00 1,2,5,8 * * * cmd &lt;==每天的1:00,2:00,5:00,8:00执行cmd</li>
</ul>
</li>
<li>/n n任意数字 每隔n单位时间<ul>
<li>00 */10 * * * cmd &lt;==每隔10小时执行cmd</li>
</ul>
</li>
</ul>
<p><strong>方法论：</strong>大象放冰箱分三步<br>   a.命令行执行成功<br>   b.配置定时任务 crontab -e<br>   c.检查</p>
<p><strong>练习：</strong></p>
<ol>
<li>让服务器每5分钟和互联网时间做一次同步</li>
<li>每天晚上0带你把站点目录/var/www/html下的内容打包备份到/data目录下，并生成不同的备份名称</li>
</ol>
<p>解答：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@lihuaning ~]<span class="comment"># crontab -l</span></span><br><span class="line">*/5 * * * * /usr/sbin/ntpdate ntp1.aliyun.com  &amp;&gt;/dev/null == &gt;/dev/null 2&gt;&amp;1 &lt;==防止生成的小文件占用inode</span><br><span class="line">00 00 */1 * * /usr/bin/tar -czf /root/www_$(<span class="built_in">date</span> +%F).tar.gz /root/felix &amp;&gt;/dev/null</span><br><span class="line"></span><br><span class="line">报错日志：<span class="built_in">cat</span> /var/log/cron</span><br><span class="line">Oct 15 23:08:01 lihuaning CROND[2483]: (root) CMD (/usr/bin/tar -czf /root/www_$(<span class="built_in">date</span> +)</span><br><span class="line">原因：定时任务对于%的要求，需要\转义</span><br></pre></td></tr></table></figure>
<p>正确答案：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*/1 * * * * /usr/bin/tar -czf /root/www_$(<span class="built_in">date</span> +\%F\%T).tar.gz /root/felix &amp;&gt; /dev/null</span><br></pre></td></tr></table></figure>
<p>优秀答案：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1.命令行执行</span><br><span class="line">cd /root</span><br><span class="line">/usr/bin/tar -czf /root/www_$(date +\%F\%T).tar.gz ./felix</span><br><span class="line"></span><br><span class="line">2.尽量用脚本文件实现</span><br><span class="line">[root@lihuaning ~]# mkdir /server/scripts -p  &lt;==建立专门存放脚本的目录</span><br><span class="line">[root@lihuaning ~]# cd /server/scripts/ </span><br><span class="line">[root@lihuaning scripts]# vim bak.sh  &lt;==编写备份脚本</span><br><span class="line">cd /root</span><br><span class="line">/usr/bin/tar -czf /root/www_$(date +%F_%T).tar.gz ./felix</span><br><span class="line">[root@lihuaning scripts]# /bin/sh /server/scripts/bak.sh  &lt;==/bin/bash 作用是不需要额外再给脚本加上执行权限</span><br><span class="line">编写定时任务</span><br><span class="line">*/1 * * * * /bin/sh /server/scripts/bak.sh &amp;&gt; /dev/null</span><br></pre></td></tr></table></figure>
<p><strong>系统定时任务计划</strong></p>
<ol>
<li>不用管理员干预，系统自动执行。</li>
<li>也可以利用系统任务位管理员服务。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@lihuaning ~]<span class="comment"># ll /var/log/messages*  &lt;==系统的日志</span></span><br><span class="line">-rw------- 1 root root   88198 2019-10-15 20:52 /var/log/messages</span><br><span class="line">-rw------- 1 root root  785720 2019-09-22 03:41 /var/log/messages-20190922</span><br><span class="line">-rw------- 1 root root 1762523 2019-09-29 03:42 /var/log/messages-20190929</span><br><span class="line">-rw------- 1 root root  240134 2019-10-07 03:17 /var/log/messages-20191007</span><br><span class="line">-rw------- 1 root root  153081 2019-10-13 03:25 /var/log/messages-20191013</span><br><span class="line">[root@lihuaning ~]<span class="comment"># ll /var/log/secure*  &lt;==系统安全日志</span></span><br><span class="line">-rw------- 1 root root 2728 2019-10-15 20:52 /var/log/secure</span><br><span class="line">-rw------- 1 root root 3869 2019-09-21 17:10 /var/log/secure-20190922</span><br><span class="line">-rw------- 1 root root 2940 2019-09-29 03:05 /var/log/secure-20190929</span><br><span class="line">-rw------- 1 root root 2580 2019-10-07 00:01 /var/log/secure-20191007</span><br><span class="line">-rw------- 1 root root 4750 2019-10-12 18:05 /var/log/secure-20191013</span><br><span class="line"></span><br><span class="line">[root@lihuaning ~]<span class="comment"># ll /etc/cron.daily/logrotate /etc/logrotate.conf </span></span><br><span class="line">-rwx------. 1 root root 180 2013-07-31 19:46 /etc/cron.daily/logrotate</span><br><span class="line">-rw-r--r--. 1 root root 662 2013-07-31 19:46 /etc/logrotate.conf</span><br><span class="line">按天切割日志，就可以用logrottate</span><br></pre></td></tr></table></figure>

<h2 id="常见错误"><a href="#常见错误" class="headerlink" title="常见错误"></a>常见错误</h2><ol>
<li>No space left on device</li>
</ol>
<p><strong>原因：</strong>磁盘满的报错，往往是inode被占满了。(df -i)<br><strong>诱因：</strong>因为定时任务结尾没添加：&amp;&gt; /dev/null，导致定时任务执行的时候把输出部分给系统(root)发邮件。系统邮件服务postfix默认不开，这些给系统发的邮件就会堆在临时目录（大量小文件堆积）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C5 /var/spool/clientmqueue/</span><br><span class="line">C6 C7 /var/spool/postfix/maildrop/</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>定时任务手动可以执行，但是放定时任务中不执行。<br>export变量生产案例<br>现象：登陆后怎么操作命令都对，但是命令就是放到定时任务不行。<br>原因：定时任务在执行脚本的时候，多数情况没办法加载环境变量，特别是（/etc/profile）中所定义的变量。</li>
</ol>
<p><strong>本质原因：</strong>bash的登陆方式</p>
<ul>
<li>手工登录，加载所有环境变量(/.bash_profile,~/.bash_rc,/etc/profile,/etc/bashrc)。</li>
<li>定时任务执行脚本属于非登陆状态(/etc/bashrc)。</li>
</ul>
<p>由于大部分运维都会把变量放到此文件/etc/profile，把这个文件里的变量定义在执行的脚本中进行 重新定义即可。而在crond执行Shell时只能识别位数不多的系统环境变量，普通环境变量一般是无法识别的，如果在编写的脚本中需要使用环境变量，最好使用exprot重新声明一下该变量，以确保脚本正确执行。</p>
<h2 id="编写例子"><a href="#编写例子" class="headerlink" title="编写例子"></a>编写例子</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">命令实例1：*/1 * * * * /bin/sh /scripts/data.sh</span><br><span class="line">在本例中除了数字与命令脚本外，还使用到了符号<span class="string">&quot;*&quot;</span>，*号的意思“每一”。</span><br><span class="line">第一列的意思为分钟，特殊符号“/”表示每隔的意思，即表示每隔一分钟执行/bin/sh /scripts/data.sh程序。</span><br><span class="line"></span><br><span class="line">命令实例2：30 3,12 * * * /bin/sh /scripts/oldboy.sh</span><br><span class="line">在本例中，第一列为30，表示30分钟；第二列为 3,12，这代表3点及 12点，此定时任务的意思是每天凌晨3点和中午12点的半点时刻（或描述为每天凌晨3：30和中午12：30）执行/scripts/oldboy.sh脚本。</span><br><span class="line"></span><br><span class="line">命令实例3：30 */6 * * * /bin/sh /scripts/oldboy.sh</span><br><span class="line">在本例中，第一列为30，表示30分钟；第二列*/6代表每6个小时，也相当于 6、12、18、24 的作用。此定时任务的意思是每隔6个小时的半点时刻执行/scripts/oldboy.sh脚本任务。</span><br><span class="line"></span><br><span class="line">命令实例4：30 8-18/2 * * * /bin/sh /scripts/oldboy.sh </span><br><span class="line">在本例中，其中的第一列为30，表示30分钟；第二列8-18/2代表在早晨8点到下午18点之间每隔2小时，也相当于把8、10、12、14、16、18单独列出。</span><br><span class="line">那么，此定时任务的意思就是早晨8点到下午18点之间，每隔2小时的半点时刻执行/scripts/oldboy.sh脚本任务。</span><br><span class="line"></span><br><span class="line">命令实例5：30 21 * * * /application/apache/bin/apachectl graceful</span><br><span class="line">本例表示每晚的21:30重启apache。</span><br><span class="line"></span><br><span class="line">命令实例6：45 4 1,10,22 * * /application/apache/bin/apachectl graceful</span><br><span class="line">本例表示每月1、10、22日的凌晨4 : 45分重启apache。</span><br><span class="line"></span><br><span class="line">命令实例7：10 1 * * 6,0 /application/apache/bin/apachectl graceful</span><br><span class="line">本例表示每周六、周日的凌晨1 : 10分重启apache。</span><br><span class="line"></span><br><span class="line">命令实例8：0,30 18-23 * * * /application/apache/bin/apachectl graceful</span><br><span class="line">本例表示在每天18 : 00至23 : 00之间每隔30分钟重启apache。</span><br><span class="line"></span><br><span class="line">命令实例9：00 */1 * * * /application/apache/bin/apachectl graceful</span><br><span class="line">本例表示每隔一小时整点重启apache</span><br><span class="line"></span><br><span class="line">命令实例10：* 23,00-07/1 * * * /application/apache/bin/apachectl graceful</span><br><span class="line">本例并不表示晚上23点和早上0-7点之间每隔一小时重启Apache。</span><br><span class="line">要说明的是，以上结果是不规范的，也是不对的。大家想想为什么？</span><br><span class="line">以上定时任务的第一列为*，表示每分都执行任务即晚上23点和早上0-7点之间每隔一小时的每分都重启Apache，很可怕吧。</span><br><span class="line"></span><br><span class="line">命令实例11：00 11 * 4 1-3 /application/apache/bin/apachectl graceful</span><br><span class="line">本例表示4月的每周一到周三的上午11点整重启Apache。</span><br><span class="line"></span><br><span class="line">命令实例12：30 09 * * 0 去做兼职</span><br><span class="line">本例表示每周日上午9:30去做兼职。</span><br><span class="line"></span><br><span class="line">命令实例13：00 10 * * * 去国政中心上班</span><br><span class="line">本例表示每上午10:00去国政中心上班。</span><br></pre></td></tr></table></figure>

<h1 id="磁盘和存储"><a href="#磁盘和存储" class="headerlink" title="磁盘和存储"></a>磁盘和存储</h1><h2 id="存储介绍"><a href="#存储介绍" class="headerlink" title="存储介绍"></a>存储介绍</h2><p>SCSI比喻成驴，SATA比喻为马，SAS比喻为骡子，骡子既不爱得病，力气又大。因此SAS比SATA、SCSI的综合情况要更优秀。</p>
<p>SAS是新一代的SCSI技术，和现在流行的Serial ATA（SATA）磁盘相同，都是采用串行技术以获得更高的传输速度<br>SAS优势：</p>
<ul>
<li>SAS技术降低了磁盘阵列的成本</li>
<li>串行接口让传输性能提高</li>
<li>扩展性更好</li>
<li>安装简单，可以热插拔</li>
<li>兼容性好，兼容SATA</li>
</ul>
<p>对比：</p>
<ul>
<li>企业生产场景普及程度：SAS&gt;SSD&gt;SATA</li>
<li>单位容量对比性能和价格：SSD&gt;SAS&gt;SATA（一块SSD和一块SATA）</li>
<li>单位价格购买磁盘容量：SATA&gt;SAS&gt;SSD</li>
</ul>
<p>光纤通道<br>作用：光纤通道磁盘是为了提高磁盘存储系统的速度和灵活性才开发的，它的出现大大提高了多磁盘系统的通信速度。光纤通道是为在像服务器这样的多磁盘系统环境而设计，能满足高端工作站、服务器、海量存储子网络、外设间通过集线器、交换机和点对点连接进行双向、串行数据通讯等系统对高数据传输率的要求。<br>特性：热拔插性、高速带宽、远程连接、连接设备数量大等。</p>
<p>SSD硬盘：<br>固态磁盘（Solid State Drive、IDE FLASH DISK）是由控制单元和存储单元（FLASH芯片）组成的。简单说：就是用固态电子存储芯片阵列而制成的磁盘。</p>
<p>分类：</p>
<ol>
<li>基于闪存（FLASH 芯片）的固态磁盘，类似于U盘</li>
<li>基于DROM的固态磁盘</li>
</ol>
<p>接口类型：</p>
<ul>
<li>SATA接口：SATA SATA2 SATA3.0</li>
<li>PATA(IDE接口)：IDE44PIN IDE40PIN</li>
<li>PCI-E接口：mSATA PCIE(IDE) PCIE(SATA)ZIF:ZIF接口等</li>
</ul>
<h2 id="磁盘选型"><a href="#磁盘选型" class="headerlink" title="磁盘选型"></a>磁盘选型</h2><ol>
<li><p>企业级SAS硬盘（默认）<br>常见的SAS硬盘是15000转/分，没有特殊需求默认买SAS硬盘。满足容量的基础上，尽量保持4块磁盘以上。</p>
</li>
<li><p>企业级SATA硬盘<br>7200-10000转/分，常见容量为1T、2T、4T、6T，优点是经济实惠，容量大，从具体需求和性价比考虑。在工作中多用SATA盘做线下备份（即不提供服务的数据存储或者并发业务访问不是很大的业务应用），比如站点程序及数据库、图片的线下备份等<br>适用场景：没钱、数据量少、数据不给用户提供服务、用于备份</p>
</li>
</ol>
<p>小结：</p>
<ul>
<li>线上业务，用SAS磁盘</li>
<li>线下业务，用SATA磁盘，磁带库</li>
<li>线上高并发，小容量业务，SSD磁盘</li>
<li>成本思想：根据数据的访问热度，智能分析分层存储。SATA+SSD</li>
</ul>
<ol start="3">
<li>SSD固态盘<br>特点：容量小，价格贵，速度快。一般用于数据量小并且有超大规模高并发的业务（这不是唯一的办法，还可以通过磁盘加内存缓存的技术方式解决这个大规模并发问题。）</li>
</ol>
<p>百度、腾讯、360核心业务都会采用SSD磁盘，应用层也必须会在项目架构层面做各种缓存。<br>大公司如淘宝，某些业务可能会根据数据的热度来综合使用分层存储，以达到性价比最佳的情况。</p>
<p>服务器默认的RAID板卡，一般只支持：0和1<br>如果是独立RAID板卡，一般支持：0、1、5、10等常见级别</p>
<h2 id="RAID"><a href="#RAID" class="headerlink" title="RAID"></a>RAID</h2><p><strong>什么是Raid?</strong><br>Raid是廉价冗余磁盘阵列( Redundant Array of Inexpensive Disk)的简称,有时也简称磁盘阵列( Disk Array)Raid是一种把多块独立的物理磁盘按不同的技术方式组合起来形成一个磁盘组,在逻辑上(做完RAID,装系统后)看起来就是一块大的磁盘,可以提供比单个物理磁盘更大的存储容量或更高的存储性能,同时又能提供不同级别数据冗余备份的一种技术。</p>
<p><strong>Raid级别介绍</strong><br>把多个物理磁盘通过不同的技术方式组成磁盘阵列,这个不同的技术方式就被称为<br>RAID级别</p>
<ul>
<li>Raid级别一般有:Raid0、Raid1、Raid2、Raid3、Raid4、Raid5,Raid6、Raid7、Raid0+1（即Raid10）、Raid53等</li>
<li>生产环境常用Raid级别：Raid0，Raid1，Raid5，Raid10。</li>
</ul>
<p>冗余：冗余,指重复配置系统的一些部件,当系统发生故障时,冗余配置的部件介入并承担故障部件的工作,由此减少系统的故障时间 Redundant,自动备援,即当某一设备发生损坏时它可以自动作为后备式设备替代该设备。</p>
<p><strong>RAID分类：</strong></p>
<ol>
<li><p>软RAID技术（退出历史舞台）<br>在Linuⅸ下在安装系统过程中或者安装系统后通过自带的软件就能实现软RAID功能使用软RAID可省去购买昂贵的硬件RAID控制器和附件就能极大地增强磁盘的IO性能和可靠性。由于是用软件去实现的RAID功能,所以它配置灵活、管理方便。同时使用软件RAID,还可以实现将几个物理磁盘合并成一个更大的虚拟设备,从而达到性能改进和数据冗余的目的。</p>
</li>
<li><p>硬RAID技术<br>基于硬件的RAID解决方案比基于软件RAID技术在使用性能和服务性能上会更胜筹,具体表现在检测和修复多位错误的能力、错误磁盘自动检测和阵列重建等方面。从安全性上考虑,基于硬件的RAID解决方案也是更安全的,因此,在实际的生产场景工作中,基于硬件的RAD解决方案应该是我们的首选。互联网公司常用的生产DELL服务器,默认的就会支持RAID0,1,如果RAID5,10就需要买RAID卡。</p>
</li>
<li><p>LVM全称（Logic Volume Management（Manager））逻辑卷管理，它的最大用途是可以【灵活的管理磁盘的容量】，让磁盘分区可以随意放大或缩小，便于更好的应用磁盘的剩余空间，如果过于强调性能与备份，那么还是应该使用RAID功能，而不是LVM。</p>
</li>
</ol>
<p>LVM是软件实现的，性能一般降低5%-10%。买服务器插满磁盘做好RAID，分区规划好，永远都不需要LVM。<br><strong>RAID和LVM区别：</strong></p>
<ul>
<li>LVM：灵活的管路磁盘容量，有一定的冗余和性能，很弱。</li>
<li>RAID：更侧重性能和数据安全。</li>
</ul>
<p>磁盘阵列可以把多个磁盘驱动器通过不同的连接方式连接在一起协同工作，大大提高读取速度，同时把磁盘系统的可靠性提高到接近无错的境界，使其可靠性极高。<br>用RAID最直接的好处是：</p>
<ul>
<li>提升数据安全性。</li>
<li>提升数据读写性能。</li>
<li>提供更大的单一逻辑磁盘数据容量存储。</li>
</ul>
<p>DELLR740使用6块盘实践RAID制作结论</p>
<ul>
<li>Raid0支持1块盘到多块盘，容量是所有盘之和。(可靠性最低，坏一块全部坏)</li>
<li>Raid1只支持2块盘，容量损失一块盘。（镜像）</li>
<li>Raid5最少三块盘，不管硬盘数量多少，只损失一块盘容量。（奇偶校验）</li>
<li>Raid6最少4块盘，5块盘也可以，损失2块盘，不管硬盘多少，只损失两块盘容量。</li>
<li>Raid10最少4块盘，必须偶数硬盘，不管硬盘多少，都损失一半容量，不支持虚拟磁盘。（镜像过后做条带）</li>
</ul>
<h3 id="RAID0"><a href="#RAID0" class="headerlink" title="RAID0"></a>RAID0</h3><p><img src="/images/pasted-238.png" alt="RAID0"><br>生产应用场景：</p>
<ul>
<li>负载均衡集群下面的多个相同RS节点服务器。</li>
<li>分布式文件存储下面的主节点或CHUNK SERVER。</li>
<li>MySQL主从复制的多个Slave服务器。</li>
<li>对性能要求很高，对冗余要求很低的相关业务。<br>以4块做RAID0为例：<br><img src="/images/pasted-239.png" alt="RAID0"></li>
</ul>
<h3 id="RAID1"><a href="#RAID1" class="headerlink" title="RAID1"></a>RAID1</h3><p><img src="/images/pasted-240.png" alt="RAID1"></p>
<ol>
<li>RAID1又称为Mirror或Mirroring（镜像），它的宗旨是最大限度的保证用户数据的可用性和可修复性。RAID1的操作方式是把用户写入一个磁盘的数据百分之百地自动复制到另外一个磁盘上，从而实现存储双份的数据。</li>
<li>要制作RAID1，要求至少是两块磁盘（仅支持2块盘？），整个RAID大小等于两个磁盘中最小的那块磁盘的容量（当然，最好使用同样大小的磁盘），数据有50%的冗余，在存储时同时写入两块磁盘，实现了数据完整备份；但相对降低了写入性能，但是读取数据时可以并发，相当于两块Raid0的读取效率（有待实践验证）。</li>
</ol>
<p><img src="/images/pasted-241.png" alt="RAID1"></p>
<h3 id="RAID5"><a href="#RAID5" class="headerlink" title="RAID5"></a>RAID5</h3><p><img src="/images/pasted-242.png" alt="RAID5"></p>
<ol>
<li>RAID5是一种存储性能、数据安全和存储成本兼顾（中庸）的存储解决方案。</li>
<li>RAID5需要三块或以上的物理磁盘，可以提供热备盘实现故障的恢复；采用奇偶校验，可靠性强，且只有同时损坏两块硬盘时数据才会完全损坏，只损坏一块硬盘时，系统会根据存储的奇偶校验位重建数据，临时提供服务；此时如果有热备盘，系统还会自动在热备盘上重建故障磁盘上的数据；</li>
</ol>
<p><img src="/images/pasted-243.png" alt="RAID5"><br><img src="/images/pasted-244.png" alt="RAID5"></p>
<h3 id="RAID10"><a href="#RAID10" class="headerlink" title="RAID10"></a>RAID10</h3><p><img src="/images/pasted-245.png" alt="RAID10"><br>RAID10是先将四块硬盘在纵向上分别两两做镜像，镜像后再在横向上做条带。<br><img src="/images/pasted-246.png" alt="RAID10"><br>RAID10极端情况下，支持一边坏1块。</p>
<h3 id="RAID01"><a href="#RAID01" class="headerlink" title="RAID01"></a>RAID01</h3><p><img src="/images/pasted-247.png" alt="RAID01"><br>RAID01是先将四块硬盘中横向上分别两两做条带，条带后再在纵向上做镜像。<br>RAID01极端情况下，支持单边坏2块。</p>
<p>总结：RAID10和RAID01在读和写的性能上没有太大差距，从发生故障的概率上看RAID01远大于RAID10</p>
<h2 id="分区"><a href="#分区" class="headerlink" title="分区"></a>分区</h2><p>生产场景分区方案：<br><img src="/images/pasted-250.png" alt="分区"></p>
<p>磁盘命名规则：</p>
<ul>
<li>IDE: /dev/hda /dev/hdb</li>
<li>SCSI:/dev/sda /dev/sdb</li>
<li>NVME:/dev/nvme0n1 nvme1n1 （内核版本3.3开始支持）<br>分区：</li>
<li>sda1 sda2 sda3</li>
<li>nvme0n1p1 nvme0n1p2 nvme0n1p3</li>
</ul>
<p><strong>磁盘分区的类型：</strong></p>
<ol>
<li><p>主分区（primary）</p>
<ul>
<li>系统中必须要存在的分区，系统盘选择主分区安装。</li>
<li>数字编号1-4(sda1-sda4)。</li>
<li>主分区最多四个，最少一个。</li>
</ul>
</li>
<li><p>扩展分区（extend）</p>
<ul>
<li>相当于一个独立的小磁盘。</li>
<li>拥有独立的分区表。</li>
<li>不能独立存在，即不能存放数据。</li>
<li>必须在扩展分区上建立逻辑分区能存放数据。</li>
<li>占用主分区的编号（主分区+扩展分区）最多4个。</li>
<li>扩展分区可以没有，最多一个。</li>
</ul>
</li>
<li><p>逻辑分区（logic）</p>
<ul>
<li>数字编号从5开始。</li>
<li>逻辑分区存放于扩展分区之上。</li>
<li>存放任意普通数据。</li>
</ul>
</li>
</ol>
<p><strong>磁盘分区的工作原理：</strong><br>磁盘存储逻辑结构图<br><img src="/images/pasted-248.png" alt="upload successful"></p>
<ol>
<li>磁盘是按柱面分区的</li>
<li>磁盘分区登记的地点，磁盘分区表<ul>
<li>磁盘分区表存放分区是结果信息的（起始柱面-结束柱面）C6精细到了扇区。</li>
<li>磁盘分区表存放位置，0磁道(最外围)，0磁头(第一个盘面)，1扇区。（512字节）。</li>
<li>占用1扇区前512字节的最后64字节（分区表），前446字节存放系统引导信息。后两个字节存放分区结束标志（55AA）</li>
<li>磁盘分区表容量有限为64字节，一个分区固定占16字节。所以64/16=4个分区（主分区+扩展分区）</li>
</ul>
</li>
</ol>
<p><strong>磁盘分区的实践：</strong><br>磁盘分区的本质，就是修改64字节的分区表。（如果是扩展分区，则修改扩展分区独立的分区表）</p>
<h3 id="fdisk"><a href="#fdisk" class="headerlink" title="fdisk"></a>fdisk</h3><p><strong>fdisk命令</strong>，修改MBR分区表：<br>既能修改小于2T也能修改大于2T的磁盘.</p>
<ul>
<li>fdisk-Partition table manipulator for Linux linux下最常用的分区工具，一般是装完系统后进行分区。装系统之前的分区，多数都是系统ISO里面的工具分，或者raid里分小磁盘。</li>
<li>fdisk只能root权限用户使用。</li>
<li>fdisk适合于对装系统后的剩余空间进行分区，例如：安装系统时没有全部分区，或者安装系统后添加新磁盘。</li>
<li>fdisk 支持mbr分区表（2TB以内）,大于2TB的磁盘需要先转换硬盘格式为gpt格式 <code>g</code>参数进行转换。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre></td><td class="code"><pre><span class="line">分区实战：3P+1E(3L)  1 2 3 5 6 7 每个150M</span><br><span class="line">[root@S1 ~]# ll /dev/sd*</span><br><span class="line">brw-rw----. 1 root disk 8,  0 Oct 20 23:59 /dev/sda</span><br><span class="line">brw-rw----. 1 root disk 8,  1 Oct 20 23:59 /dev/sda1</span><br><span class="line">brw-rw----. 1 root disk 8,  2 Oct 20 23:59 /dev/sda2</span><br><span class="line">brw-rw----. 1 root disk 8,  3 Oct 20 23:59 /dev/sda3</span><br><span class="line">brw-rw----. 1 root disk 8, 16 Oct 20 23:59 /dev/sdb</span><br><span class="line">[root@S1 ~]# fdisk -l  &lt;==查看分区信息</span><br><span class="line"></span><br><span class="line">Disk /dev/sda: 21.5 GB, 21474836480 bytes, 41943040 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk label type: dos</span><br><span class="line">Disk identifier: 0x000ed3d3</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sda1   *        2048     1050623      524288   83  Linux</span><br><span class="line">/dev/sda2         1050624     5244927     2097152   82  Linux swap / Solaris</span><br><span class="line">/dev/sda3         5244928    41943039    18349056   83  Linux</span><br><span class="line"></span><br><span class="line">Disk /dev/sdb: 1073 MB, 1073741824 bytes, 2097152 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line"></span><br><span class="line">[root@S1 ~]# fdisk /dev/sdb &lt;==对sdb进行分区</span><br><span class="line">Welcome to fdisk (util-linux 2.23.2).</span><br><span class="line"></span><br><span class="line">Changes will remain in memory only, until you decide to write them.</span><br><span class="line">Be careful before using the write command.</span><br><span class="line"></span><br><span class="line">Device does not contain a recognized partition table</span><br><span class="line">Building a new DOS disklabel with disk identifier 0x8ecef2f8.</span><br><span class="line"></span><br><span class="line">Command (m for help): m</span><br><span class="line">Command action</span><br><span class="line">   a   toggle a bootable flag</span><br><span class="line">   b   edit bsd disklabel</span><br><span class="line">   c   toggle the dos compatibility flag</span><br><span class="line">   d   delete a partition		&lt;==删除一个分区</span><br><span class="line">   g   create a new empty GPT partition table &lt;==转换硬盘格式为gpt</span><br><span class="line">   G   create an IRIX (SGI) partition table</span><br><span class="line">   l   list known partition types	&lt;==查看已知的分区类型</span><br><span class="line">   m   print this menu		&lt;==查看分区的帮助信息</span><br><span class="line">   n   add a new partition		&lt;==添加一个新分区</span><br><span class="line">   o   create a new empty DOS partition table</span><br><span class="line">   p   print the partition table	&lt;==查看分区结果信息</span><br><span class="line">   q   quit without saving changes	&lt;==退出不保存</span><br><span class="line">   s   create a new empty Sun disklabel</span><br><span class="line">   t   change a partition&#x27;s system id&lt;==调整分区类型</span><br><span class="line">   u   change display/entry units</span><br><span class="line">   v   verify the partition table</span><br><span class="line">   w   write table to disk and exit	&lt;==保存并退出</span><br><span class="line">   x   extra functionality (experts only)</span><br><span class="line"></span><br><span class="line">Command (m for help): p</span><br><span class="line"></span><br><span class="line">Disk /dev/sdb: 1073 MB, 1073741824 bytes, 2097152 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk label type: dos</span><br><span class="line">Disk identifier: 0x5faeac4d</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line"></span><br><span class="line">=======================开始创建主分区==========================</span><br><span class="line">Command (m for help): n</span><br><span class="line">Partition type:</span><br><span class="line">   p   primary (0 primary, 0 extended, 4 free)</span><br><span class="line">   e   extended</span><br><span class="line">Select (default p): </span><br><span class="line">Using default response p</span><br><span class="line">Partition number (1-4, default 1): </span><br><span class="line">First sector (2048-2097151, default 2048): </span><br><span class="line">Using default value 2048</span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G&#125; (2048-2097151, default 2097151): +150M</span><br><span class="line">Partition 1 of type Linux and of size 150 MiB is set</span><br><span class="line"></span><br><span class="line">Command (m for help): n   </span><br><span class="line">Partition type:</span><br><span class="line">   p   primary (1 primary, 0 extended, 3 free)</span><br><span class="line">   e   extended</span><br><span class="line">Select (default p): p</span><br><span class="line">Partition number (2-4, default 2): </span><br><span class="line">First sector (309248-2097151, default 309248): </span><br><span class="line">Using default value 309248</span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G&#125; (309248-2097151, default 2097151): +150M</span><br><span class="line">Partition 2 of type Linux and of size 150 MiB is set</span><br><span class="line"></span><br><span class="line">Command (m for help): n</span><br><span class="line">Partition type:</span><br><span class="line">   p   primary (2 primary, 0 extended, 2 free)</span><br><span class="line">   e   extended</span><br><span class="line">Select (default p): p</span><br><span class="line">Partition number (3,4, default 3): </span><br><span class="line">First sector (616448-2097151, default 616448): </span><br><span class="line">Using default value 616448</span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G&#125; (616448-2097151, default 2097151): +150M</span><br><span class="line">Partition 3 of type Linux and of size 150 MiB is set</span><br><span class="line"></span><br><span class="line">=======================开始创建扩展分区==========================</span><br><span class="line">Command (m for help): n</span><br><span class="line">Partition type:</span><br><span class="line">   p   primary (3 primary, 0 extended, 1 free)</span><br><span class="line">   e   extended</span><br><span class="line">Select (default e): </span><br><span class="line">Using default response e</span><br><span class="line">Selected partition 4</span><br><span class="line">First sector (923648-2097151, default 923648): </span><br><span class="line">Using default value 923648</span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G&#125; (923648-2097151, default 2097151): 	&lt;==给剩余全部空间</span><br><span class="line">Using default value 2097151</span><br><span class="line">Partition 4 of type Extended and of size 573 MiB is set</span><br><span class="line"></span><br><span class="line">Command (m for help): p</span><br><span class="line"></span><br><span class="line">Disk /dev/sdb: 1073 MB, 1073741824 bytes, 2097152 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk label type: dos</span><br><span class="line">Disk identifier: 0x5faeac4d</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sdb1            2048      309247      153600   83  Linux</span><br><span class="line">/dev/sdb2          309248      616447      153600   83  Linux</span><br><span class="line">/dev/sdb3          616448      923647      153600   83  Linux</span><br><span class="line">/dev/sdb4          923648     2097151      586752    5  Extended</span><br><span class="line"></span><br><span class="line">=======================开始创建逻辑分区==========================</span><br><span class="line">Command (m for help): n</span><br><span class="line">All primary partitions are in use</span><br><span class="line">Adding logical partition 5</span><br><span class="line">First sector (925696-2097151, default 925696): </span><br><span class="line">Using default value 925696</span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G&#125; (925696-2097151, default 2097151): +150M</span><br><span class="line">Partition 5 of type Linux and of size 150 MiB is set</span><br><span class="line"></span><br><span class="line">Command (m for help): n</span><br><span class="line">All primary partitions are in use</span><br><span class="line">Adding logical partition 6</span><br><span class="line">First sector (1234944-2097151, default 1234944): </span><br><span class="line">Using default value 1234944</span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G&#125; (1234944-2097151, default 2097151): +150M</span><br><span class="line">Partition 6 of type Linux and of size 150 MiB is set</span><br><span class="line"></span><br><span class="line">Command (m for help): n</span><br><span class="line">All primary partitions are in use</span><br><span class="line">Adding logical partition 7</span><br><span class="line">First sector (1544192-2097151, default 1544192): </span><br><span class="line">Using default value 1544192</span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G&#125; (1544192-2097151, default 2097151):  </span><br><span class="line">Using default value 2097151</span><br><span class="line">Partition 7 of type Linux and of size 270 MiB is set</span><br><span class="line"></span><br><span class="line">=======================查看结果3P 1E(3L)==========================</span><br><span class="line">Command (m for help): p</span><br><span class="line"></span><br><span class="line">Disk /dev/sdb: 1073 MB, 1073741824 bytes, 2097152 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk label type: dos</span><br><span class="line">Disk identifier: 0x5faeac4d</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sdb1            2048      309247      153600   83  Linux</span><br><span class="line">/dev/sdb2          309248      616447      153600   83  Linux</span><br><span class="line">/dev/sdb3          616448      923647      153600   83  Linux</span><br><span class="line">/dev/sdb4          923648     2097151      586752    5  Extended</span><br><span class="line">/dev/sdb5          925696     1232895      153600   83  Linux</span><br><span class="line">/dev/sdb6         1234944     1542143      153600   83  Linux</span><br><span class="line">/dev/sdb7         1544192     2097151      276480   83  Linux</span><br><span class="line"></span><br><span class="line">Command (m for help):</span><br></pre></td></tr></table></figure>

<h3 id="parted"><a href="#parted" class="headerlink" title="parted"></a>parted</h3><p><strong>parted命令</strong>，gpt分区格式：<br>既能修改小于2T也能修改大于2T的磁盘.</p>
<p><img src="/images/pasted-249.png" alt="parted命令"><br>改硬盘格式：<code>parted -s /dev/sdb mklabel gpt/msdos</code> 二选一，大于两T用gpt反之选msdos即mbr<br>增加分区：<code>parted -s /dev/sdb mkpart primary 581 100%==-1</code><br>删除分区：<code>parted -s /dev/sdb rm [分区号]</code><br>查看分区：<code>parted -s /dev/sdb p</code></p>
<p><strong>mkpart PART-TYPE START END</strong><br>PART-TYPE(分区类型)</p>
<ul>
<li>primary 主分区</li>
<li>logical 逻辑分区</li>
<li>extended 扩展分区</li>
</ul>
<p><strong>START 设定磁盘分区起始点；可以为0，numberMiB/GiB/TiB；</strong></p>
<ul>
<li>0 设定当前分区的起始点为磁盘的第一个扇区；</li>
<li>1G 设定当前分区的起始点为磁盘的1G处开始；</li>
</ul>
<p><strong>END 设定磁盘分区结束点；</strong></p>
<ul>
<li>-1 设定当前分区的结束点为磁盘的最后一个扇区；</li>
<li>10G 设定当前分区的结束点为磁盘的10G处；</li>
</ul>
<p>需求：4块2T盘，RAID5大小6T（RAID5损失了1块盘的容量）<br>现有一个做了RAID5的硬盘，要求三个分区<br>硬盘分区总大小：    6.2T<br>/data0            4.8T<br>/data1            1T<br>            400G （无需格式化，作DRBD+Hearbeat+MySQL高可用集群）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">[root@S1 ~]# parted /dev/sdb</span><br><span class="line">GNU Parted 3.1</span><br><span class="line">Using /dev/sdb</span><br><span class="line">Welcome to GNU Parted! Type &#x27;help&#x27; to view a list of commands.</span><br><span class="line">(parted) p                                                                </span><br><span class="line">Model: ATA VBOX HARDDISK (scsi)</span><br><span class="line">Disk /dev/sdb: 1074MB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: msdos		&lt;==此时文件系统为msdos</span><br><span class="line">Disk Flags: </span><br><span class="line"></span><br><span class="line">Number  Start  End  Size  Type  File system  Flags</span><br><span class="line"></span><br><span class="line">(parted) mklabel gpt                  &lt;==修改磁盘为GPT格式[MBR格式为 msdos ]</span><br><span class="line">		等价于：parted -s /dev/sdb mklabel gpt &lt;==非交互式磁盘为GPT格式，-s取消提示</span><br><span class="line">Warning: The existing disk label on /dev/sdb will be destroyed and all data on this disk will be lost. Do you want to</span><br><span class="line">continue?</span><br><span class="line">Yes/No? Y                                                                 </span><br><span class="line">(parted) p                                                                </span><br><span class="line">Model: ATA VBOX HARDDISK (scsi)</span><br><span class="line">Disk /dev/sdb: 1074MB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: gpt		&lt;==修改结果</span><br><span class="line">Disk Flags: </span><br><span class="line"></span><br><span class="line">Number  Start  End  Size  File system  Name  Flags</span><br><span class="line"></span><br><span class="line">(parted) mkpart primary 0 124	&lt;==新建分区定义起始大小（M）为单位</span><br><span class="line">				等价于：parted -s /dev/sdb mkpart primary 0 124</span><br><span class="line">Warning: The resulting partition is not properly aligned for best performance.</span><br><span class="line">Ignore/Cancel? I                                                          </span><br><span class="line">(parted) p              		&lt;==显示分区信息                                                  </span><br><span class="line">Model: ATA VBOX HARDDISK (scsi)</span><br><span class="line">Disk /dev/sdb: 1074MB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: gpt</span><br><span class="line">Disk Flags: </span><br><span class="line"></span><br><span class="line">Number  Start   End    Size   File system  Name     Flags</span><br><span class="line"> 1      17.4kB  124MB  124MB               primary</span><br><span class="line"></span><br><span class="line">(parted) mkpart primary 581 -1    &lt;==分配所有剩余空间给第2个分区</span><br><span class="line">				 等价于：parted -s /dev/sdb mkpart primary 581 100%</span><br><span class="line">(parted) p                                                                </span><br><span class="line">Model: ATA VBOX HARDDISK (scsi)</span><br><span class="line">Disk /dev/sdb: 1074MB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: gpt</span><br><span class="line">Disk Flags: </span><br><span class="line"></span><br><span class="line">Number  Start   End     Size   File system  Name     Flags</span><br><span class="line"> 1      17.4kB  580MB   580MB               primary</span><br><span class="line"> 2      581MB   1073MB  492MB              primary</span><br><span class="line"></span><br><span class="line">(parted) rm 2 &lt;==删除分区2</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="文件系统"><a href="#文件系统" class="headerlink" title="文件系统"></a>文件系统</h2><p><strong>文件系统：</strong></p>
<ul>
<li>什么是文件系统？<ul>
<li>是计算机存储和组织数据的方法或机制。落地是一个软件。</li>
</ul>
</li>
<li>为什么需要文件系统？<ul>
<li>磁盘、物理介质、磁粒子物理元素。硬件需要软件驱动使用，磁盘需要文件系统驱动。</li>
<li>文件系统通过磁盘实现管理规划、存取数据。</li>
</ul>
</li>
<li>文件系统都有哪些常见种类？<ul>
<li>Windows: NTFS、fat32、msdos</li>
<li>Linux: ext2、ext3(C5)、ext4(C6)、xfs(C7)</li>
</ul>
</li>
</ul>
<h3 id="文件系统创建和挂载"><a href="#文件系统创建和挂载" class="headerlink" title="文件系统创建和挂载"></a>文件系统创建和挂载</h3><p>mkfs 格式化（的本质创建文件系统）</p>
<ul>
<li>-t //指定文件系统</li>
<li>-b //指定Block大小</li>
<li>-I //指定Inode大小</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">[root@S1 ~]<span class="comment"># mkfs -t ext4 /dev/sdb1  &lt;==格式化ext4文件系统，本质就是生成一定数量的Inode和Block。等价于mkfs.exts /dev/sdb1</span></span><br><span class="line">		</span><br><span class="line">mke2fs 1.42.9 (28-Dec-2013)</span><br><span class="line">Filesystem label=</span><br><span class="line">OS <span class="built_in">type</span>: Linux</span><br><span class="line">Block size=1024 (<span class="built_in">log</span>=0)</span><br><span class="line">Fragment size=1024 (<span class="built_in">log</span>=0)</span><br><span class="line">Stride=0 blocks, Stripe width=0 blocks</span><br><span class="line">25688 inodes, 102400 blocks</span><br><span class="line">5120 blocks (5.00%) reserved <span class="keyword">for</span> the super user</span><br><span class="line">First data block=1</span><br><span class="line">Maximum filesystem blocks=33685504</span><br><span class="line">13 block <span class="built_in">groups</span></span><br><span class="line">8192 blocks per group, 8192 fragments per group</span><br><span class="line">1976 inodes per group</span><br><span class="line">Superblock backups stored on blocks: </span><br><span class="line">	8193, 24577, 40961, 57345, 73729</span><br><span class="line"></span><br><span class="line">Allocating group tables: <span class="keyword">done</span>                            </span><br><span class="line">Writing inode tables: <span class="keyword">done</span>                            </span><br><span class="line">Creating journal (4096 blocks): <span class="keyword">done</span></span><br><span class="line">Writing superblocks and filesystem accounting information: <span class="keyword">done</span></span><br><span class="line">-----------------------------------------------------------------------------------</span><br><span class="line">[root@S1 ~]<span class="comment"># mkfs -t ext4 -b 4096 -I 512 /dev/sdb1 &lt;==指定Inode和Block大小</span></span><br><span class="line">mke2fs 1.42.9 (28-Dec-2013)</span><br><span class="line">Filesystem label=</span><br><span class="line">OS <span class="built_in">type</span>: Linux</span><br><span class="line">Block size=4096 (<span class="built_in">log</span>=2)</span><br><span class="line">Fragment size=4096 (<span class="built_in">log</span>=2)</span><br><span class="line">Stride=0 blocks, Stripe width=0 blocks</span><br><span class="line">25600 inodes, 25600 blocks</span><br><span class="line">1280 blocks (5.00%) reserved <span class="keyword">for</span> the super user</span><br><span class="line">First data block=0</span><br><span class="line">Maximum filesystem blocks=27262976</span><br><span class="line">1 block group</span><br><span class="line">32768 blocks per group, 32768 fragments per group</span><br><span class="line">25600 inodes per group</span><br><span class="line"></span><br><span class="line">Allocating group tables: <span class="keyword">done</span>                            </span><br><span class="line">Writing inode tables: <span class="keyword">done</span>                            </span><br><span class="line">Creating journal (1024 blocks): <span class="keyword">done</span></span><br><span class="line">Writing superblocks and filesystem accounting information: <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">[root@S1 ~]<span class="comment"># dumpe2fs /dev/sdb1 | egrep -i &quot;size&quot; &lt;==检查结果</span></span><br><span class="line">dumpe2fs 1.42.9 (28-Dec-2013)</span><br><span class="line">Filesystem features:      has_journal ext_attr resize_inode dir_index filetype extent 64bit flex_bg sparse_super large_file huge_file uninit_bg dir_nlink extra_isize</span><br><span class="line">Block size:               4096</span><br><span class="line">Fragment size:            4096</span><br><span class="line">Group descriptor size:    64</span><br><span class="line">Flex block group size:    16</span><br><span class="line">Inode size:	          512</span><br><span class="line">Required extra isize:     28</span><br><span class="line">Desired extra isize:      28</span><br><span class="line">Journal size:             4096k</span><br><span class="line"></span><br><span class="line">-----------------------------------------------------------------------------------</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>mount </p>
<ul>
<li>-t 指定文件类型</li>
<li>-o 挂载的选项[rw,remount]</li>
<li>-a 挂载所有磁盘</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@S1 ~]<span class="comment"># mount -t ext4 /dev/sdb1 /mnt/ &lt;==挂载文件系统</span></span><br><span class="line">[root@S1 ~]<span class="comment"># df -h</span></span><br><span class="line">[root@S1 ~]<span class="comment"># cat /proc/mounts &lt;==查看挂载状态</span></span><br><span class="line">[root@S1 ~]<span class="comment"># umount -lf /mnt/ &lt;==强制卸载</span></span><br><span class="line"></span><br><span class="line">[root@S1 ~]<span class="comment"># mount  /dev/sdb2 /mnt/  &lt;==没有格式化，没法挂载。</span></span><br><span class="line">mount: /dev/sdb2 is write-protected, mounting read-only</span><br><span class="line">mount: unknown filesystem <span class="built_in">type</span> <span class="string">&#x27;(null)&#x27;</span></span><br><span class="line"></span><br><span class="line">xfs格式化sdb2</span><br><span class="line">[root@S1 ~]<span class="comment"># mkfs.xfs /dev/sdb2</span></span><br><span class="line">meta-data=/dev/sdb2         isize=256    agcount=4, agsize=59072 blks</span><br><span class="line">          =                          sectsz=512   attr=2, projid32bit=1</span><br><span class="line">          =                          crc=0        finobt=0</span><br><span class="line">data    =                          bsize=4096   blocks=236288, imaxpct=25</span><br><span class="line">          =                          sunit=0      swidth=0 blks</span><br><span class="line">naming=version 2              bsize=4096   ascii-ci=0 ftype=0</span><br><span class="line"><span class="built_in">log</span>      =internal <span class="built_in">log</span>           bsize=4096   blocks=853, version=2</span><br><span class="line">           =                         sectsz=512   sunit=0 blks, lazy-count=1</span><br><span class="line">realtime =none                  extsz=4096   blocks=0, rtextents=0</span><br><span class="line">[root@S1 ~]<span class="comment"># mount  /dev/sdb2 /mnt/</span></span><br></pre></td></tr></table></figure>

<p>开机自动挂载</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">方法一：</span><br><span class="line">[root@S1 ~]<span class="comment"># blkid &lt;==查看设备属性 UUID fstype</span></span><br><span class="line">/dev/sda1: UUID=<span class="string">&quot;4b292773-2b2d-4f7d-807c-ba025a45dc58&quot;</span> TYPE=<span class="string">&quot;xfs&quot;</span> </span><br><span class="line">/dev/sda2: UUID=<span class="string">&quot;3fc4e794-5e50-437e-87e1-1e692621df3c&quot;</span> TYPE=<span class="string">&quot;swap&quot;</span> </span><br><span class="line">/dev/sda3: UUID=<span class="string">&quot;4664ec93-5655-4d88-80cd-aec984aaf857&quot;</span> TYPE=<span class="string">&quot;xfs&quot;</span> </span><br><span class="line">/dev/sdb1: UUID=<span class="string">&quot;360280b7-4a46-4e11-843d-d97e62cfe3bc&quot;</span> TYPE=<span class="string">&quot;ext4&quot;</span> </span><br><span class="line">/dev/sdb2: UUID=<span class="string">&quot;814731d0-a1ca-48fc-9522-8cf3eae33c8a&quot;</span> TYPE=<span class="string">&quot;xfs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># /etc/fstab</span></span><br><span class="line"><span class="comment"># Created by anaconda on Wed Oct  9 11:54:43 2019</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Accessible filesystems, by reference, are maintained under &#x27;/dev/disk&#x27;</span></span><br><span class="line"><span class="comment"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">UUID=4664ec93-5655-4d88-80cd-aec984aaf857   /               xfs           defaults           0              0</span><br><span class="line">UUID=4b292773-2b2d-4f7d-807c-ba025a45dc58  /boot         xfs            defaults           0              0</span><br><span class="line">UUID=3fc4e794-5e50-437e-87e1-1e692621df3c   swap         swap         defaults           0              0</span><br><span class="line">设备				                挂载点  文件系统类型  默认挂载选项   是否备份 是否开机磁盘检查</span><br><span class="line">defaults</span><br><span class="line">              Use default options: rw, suid, dev, <span class="built_in">exec</span>, auto, nouser, and async.</span><br><span class="line"></span><br><span class="line">UUID=814731d0-a1ca-48fc-9522-8cf3eae33c8a    /mnt         xfs            defaults           0              0  &lt;==开机挂载</span><br><span class="line"></span><br><span class="line">mount -a &lt;==实现fstab中的配置文件立刻生效</span><br><span class="line"></span><br><span class="line">方法二：</span><br><span class="line">/usr/bin/mount -t xfs /dev/sdb2 /mnt &lt;==为临时挂载，可将其放入/etc/rc.local，也可实现自动挂载。</span><br></pre></td></tr></table></figure>

<h3 id="文件系统修复"><a href="#文件系统修复" class="headerlink" title="文件系统修复"></a>文件系统修复</h3><p>查看ext文件系统的内部细节：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@S1 ~]<span class="comment"># dumpe2fs /dev/sdb1</span></span><br><span class="line">Inode count:              25688</span><br><span class="line">Block count:              102400 &lt;==inode block数量</span><br><span class="line">Block size:               1024 &lt;==Block大小 1k</span><br><span class="line">Inode size:	          128 &lt;==Inode大小</span><br><span class="line"></span><br><span class="line">[root@S1 ~]<span class="comment"># fsck #检查并修复Linux⽂件系统</span></span><br><span class="line">fsck         fsck.btrfs   fsck.cramfs  fsck.ext2    fsck.ext3    fsck.ext4    fsck.minix   fsck.xfs</span><br></pre></td></tr></table></figure>
<p>注意：</p>
<ol>
<li>正常的磁盘不能操作</li>
<li>操作时要卸载</li>
</ol>
<p>参数:</p>
<ul>
<li>-a非互交模式，自动修复</li>
<li>-c检查是否存在有损坏的区块。</li>
<li>-C fsck.ext3命令会把全部的执行过程，都交由其逆向叙述，便于监控程序</li>
<li>-d详细显示命令执行过程</li>
<li>-f强制进行检查</li>
<li>-F检查文件系统之前，先清理该保存设备块区内的数据</li>
<li>-l把文件中所列出的损坏区块，加入标记</li>
<li>-L清除所有损坏标志，重新标记</li>
<li>-n非交互模式,把欲检查的文件系统设成只读</li>
<li>-P 设置fsck.ext2命令所能处理的inode大小为多少</li>
<li>-r交互模式</li>
<li>-R忽略目录</li>
<li>-s顺序检查</li>
<li>-S效果和指定“-s”参数类似</li>
<li>-t 显示fsck.ext2命令的时序信息。</li>
<li>-v显示详细的处理过程</li>
<li>-y关闭互动模式</li>
</ul>
<p>选择参数:</p>
<ul>
<li>-b指定分区的第一个磁区的起始地址/Super Block</li>
<li>-B 设置该分区每个区块的大小</li>
<li>-I设置欲检查的文件系统，其inode缓冲区的区块数目</li>
<li>-V显示版本信息</li>
</ul>
<p><code>[root@S1 ~]# xfs_repair /dev/sdb2</code> 检查和修复xfs文件系统</p>
<h2 id="救援模式"><a href="#救援模式" class="headerlink" title="救援模式"></a>救援模式</h2><p>当系统磁盘挂载项写入fstab中，此时机器重启了。但是盘被拔出来或者磁盘的文件系统损坏无法挂载时，系统会开不开机。这个时候就要进入救援模式吧fstab中的挂载项注释掉。</p>
<ol>
<li>grub菜单按e键，找到如下位置。</li>
</ol>
<p><img src="/images/pasted-251.png" alt="救援模式1"><br>2. 修改为：</p>
<p><img src="/images/pasted-252.png" alt="救援模式2"><br>3. Ctrl+x执行：</p>
<p><img src="/images/pasted-253.png" alt="救援模式3"><br>执行<code>chroot sysroot</code>获取root权限。<br>vi 编辑fstab<br>exec /sbin/init 重启OK</p>
<p>同样适用单用户模式找回root密码<br>如果开启了selinux 还需要执行<br><code>touch /.autorelabel</code>  &lt;==selinux在重启后更新label(既selinux安全上下文 其中包含：SELinux用户、SELinux角色、类型、安全级别)</p>
</article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info">Linux 基础知识 [已完结]</span></div><div class="post-copyright__url"><span class="post-copyright-info"><a id="post-url" href="https://cakepanit.com/forward/312ec9e0.html">https://cakepanit.com/forward/312ec9e0.html</a><a id="post-url-copy" title="复制文章链接" onclick="btf.copyFn(&quot;https://cakepanit.com/forward/312ec9e0.html&quot;)"><i class="fas fa-paste copy-button"></i></a></span></div><div class="post-copyright__cc"><span class="post-copyright-info">转载前请阅读本站 <a href="/protocol/copyright/" title="本站所有原创文章采用知识共享(Creative Commons)署名—非商业性使用—相同方式共享4.0国际公共许可协议">版权协议</a>，文章著作权归 <a href="https://cakepanit.com">饼铛</a> 所有，转载请注明出处。</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/OPS/">🌍OPS</a><a class="post-meta__tags" href="/tags/SHELL/">SHELL</a><a class="post-meta__tags" href="/tags/RAID/">RAID</a></div><div class="post_share"><div class="social-share" data-image="/images/img-75.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/DC9cYFtFic5G6JZgktjajza5fVfRJLaXLS.png" target="_blank"><img class="post-qr-code-img" src="/img/DC9cYFtFic5G6JZgktjajza5fVfRJLaXLS.png" alt="狗狗币(DogeCoin)"/></a><div class="post-qr-code-desc">狗狗币(DogeCoin)</div></li><li class="reward-item"><a href="/img/bc1q63xj5a3xgfulv8guate5qxmh6qh8ws7c3casqm.png" target="_blank"><img class="post-qr-code-img" src="/img/bc1q63xj5a3xgfulv8guate5qxmh6qh8ws7c3casqm.png" alt="比特币(BitCoin)"/></a><div class="post-qr-code-desc">比特币(BitCoin)</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/forward/d6f16b84.html" title="集群搭建前优化方案"><img class="cover" src="/images/img-75.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">集群搭建前优化方案</div><div class="content">1.分区方案1.1普通分区形式
/boot 引导分区 512M-1024M
swap 交换分区   内存大于8G，给8G。内存小于8G，给到1.5倍的内存。
/   给所有空间

1.1.1使用条件
1、数据不那么重要。
2、必须必须要有备份策略：就是实时的。
内部人员发布数据，同时发布到两台以上生产服务器里。是三个备份，GIT上，代码。
外部用户写入数据（图片、视频 文字），
同时发布到两台服务器后面共享的服务器上（对这个共享服务器做备份），
两个备份。



1.2存储服务器（含数据库）的分区方式
/boot 引导分区 512M-1024M
swap 交换分区   内存大于8G，给8G。内存小于8G，给到1.5倍的内存。
/   给100G
/data  剩余给数据分区 ，data可以是任意名称。

1.3门户网站的分区方案
/boot 引导分区 512M-1024M
swap 交换分区   内存大于8G，给8G。内存小于8G，给到1.5倍的内存。
/   给100G
剩余保留，将来哪个部门使用，使用部门自己分剩余的分区。

1.4错误分区方案
/boot 引导分区 512M-10 ...</div></div></a></div><div class="next-post pull-right"><a href="/forward/d7240237.html" title="Linux基础-iptables防火墙相关配置"><img class="cover" src="/images/pasted-33.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Linux基础-iptables防火墙相关配置</div><div class="content">容器：瓶瓶罐罐 存放东西
表(table)：存放链的容器
链(chain)：存放规则的容器
规则(policy)：

准许或拒绝规则
准许或拒绝规则ACCPT DROP police：警察




iptables执行过程工作流程：
防火墙是层层过滤的，实际是按照配置规则的顺序从上到下，从前到后进行过滤的。
如果匹配上规则，即明确表示是阻止还是通过，数据包就不再向下匹配新的规则。
如果规则中没有明确表明是阻止还是通过的，也就是没有匹配规则，向下进行匹配，直到匹配默认规则得到明确的阻止还是通过。
防火墙的默认规则是所有规则执行完才执行的。

四表与五链filter(默认，防火墙功能 准许 拒绝)nat表 nat功能

内网服务器上外网
端口映射

mangleraw
filter表强调：主要和主机自身相关，真正负责主机防火墙功能的（过滤流入流出主机的数据包）filter表示iptables默认使用的表，这个表定义了三个链（chains）企业工作场景：主机防火墙相关链：

INPUT：负责过滤所有目标地址是本机地址的数据包，人话：就是过滤进入主机的数据包(检票员)
FORWARD：负责转发 ...</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/forward/408a4bb8.html" title="Docker-安装&amp;基础管理"><img class="cover" src="/images/img-163.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-16</div><div class="title">Docker-安装&amp;基础管理</div><div class="info">1.Docker介绍1.1什么是容器？容器就是在隔离的环境运行的一个进程，如果进程停止，容器就会销毁。隔离的环境拥有自己的系统文件，ip地址， 主机名等。
1.2docker的主要组成部分docker是传统的CS架构分为docker client和docker server,向mysql一样docker主要组件有：镜像、容器、仓库、网络、存储 
2.Docker安装12[root@wikifx2 ~]# uname -r3.10.0-1127.13.1.el7.x86_64

2.1配置网卡转发,看值是否为112$ sysctl -a |grep -w net.ipv4.ip_forwardnet.ipv4.ip_forward = 1

若未配置，需要执行如下123456$ cat &lt;&lt;EOF &gt;  /etc/sysctl.d/docker.confnet.bridge.bridge-nf-call-ip6tables = 1net.bridge.bridge-nf-call-iptables = 1net.ipv4.ip_forward=1EOF$ sysctl  ...</div></div></a></div><div><a href="/forward/60c1bc2d.html" title="Git-C7下Gitlab-12.3.5安装"><img class="cover" src="/images/img-160.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-06-22</div><div class="title">Git-C7下Gitlab-12.3.5安装</div><div class="info">1.GitLab 概述：　　是一个利用 Ruby on Rails 开发的开源应用程序，实现一个自托管的 Git 项目仓库，可通过 Web界面进行访问公开的或者私人项目。Ruby on Rails 是一个可以使你开发、部署、维护 web 应用程序变得简单的框架。
   GitLab 拥有不 Github 类似的功能，能够浏览源代码，管理缺陷和注释。可以管理团队对仓库的访问，它非常易于浏览提交过的版本并提供一个文件历史库。它还提供一个代码片段收集功能可以轻松实现代码复用，便于日后有需要的时候进行查找。GitLab 中文网：https://www.gitlab.cc/installation/#centos-7
2.GitHub 和 GitLab 的区别:2.1相同点:
二者都是基于 web 的 Git 仓库，在很大程度上 GitLab 是仿照 GitHub 来做的，它们都提供了分享开源项目的平台，为开发团队提供了存储、分享、发布和合作开发项目的中心化云存储的场所。

2.2不同点：
GitHub 如果要使用私有仓库，超过 3 个人就收费。GitLab 可以在上面创建私人的克费仓库。
Gi ...</div></div></a></div><div><a href="/forward/882d9505.html" title="Docker-手动构建dotnet镜像"><img class="cover" src="/images/img-163.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-21</div><div class="title">Docker-手动构建dotnet镜像</div><div class="info">1.docker环境12345678910111213[root@wikifx2 ~]# docker image lsREPOSITORY          TAG                 IMAGE ID            CREATED             SIZEnginx               latest              0901fa9da894        10 days ago         132MBnginx               latest              0901fa9da894        10 days ago         132MBalpine              latest              a24bb4013296        7 weeks ago         5.57MBcentos              7                   b5b4d78bc90c        2 months ago        203MB[root@wikifx2 ~ ...</div></div></a></div><div><a href="/forward/d063782.html" title="Docker安装Skywalking"><img class="cover" src="/images/pasted-25.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-22</div><div class="title">Docker安装Skywalking</div><div class="info">采用H2部署oapskywalking默认的数据存储方式即是内存数据库H2。该方式用于方便体验skywalking，但不推荐使用在生产环境。
运行容器命令：
1234567docker run --name oap-h2 --restart always -d \--restart=always \-e TZ=Asia/Shanghai \-p 12800:12800 \-p 11800:11800 \-e SW_STORAGE=h2 \apache/skywalking-oap-server:8.3.0-es7
采用MySQL部署oap需要注意原生的docker镜像中没有mysql驱动，所以需要手动上传mysql的驱动到/skywalking/oap-libs/下，命令如下：
1docker cp mysql-connector-java-8.0.19.jar e2ea45eb7118124cf1d89bdf4eac1e798f857d1a2b6d7b43416bf30a57d2af6b:/skywalking/oap-libs/mysql-connector-java-8.0.19 ...</div></div></a></div><div><a href="/forward/47eea66c.html" title="ELK-Logstah 定义管道解析Nginx日志传递至Elasticsearch"><img class="cover" src="/images/img-156.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-04-12</div><div class="title">ELK-Logstah 定义管道解析Nginx日志传递至Elasticsearch</div><div class="info">通过filebeat读取日志后传送至logstash进行处理，处理完成再保存在elasticsearch中。其中最重要的一步就是logstash的处理，我们需要根据日志的格式编写相关的匹配代码，以便logstash进行匹配处理。
在这里我使用过滤插件中的Grok插件，具体技术文档请点击以下链接：https://www.elastic.co/guide/en/logstash/current/plugins-filters-grok.html
在编写grok捕获规则时，可以使用以下网站进行辅助：https://grokdebug.herokuapp.com/
相关的语法可以参考以下GitHub页面：https://github.com/elastic/logstash/blob/v1.4.2/patterns/grok-patterns
Logstash Reference [7.12] » Filter pluginshttps://www.elastic.co/guide/en/logstash/current/filter-plugins.html
nginx日志分析1&#x27; ...</div></div></a></div><div><a href="/forward/131c756.html" title="ELK-Filebeat7.4.0单机多实例"><img class="cover" src="/images/img-156.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-06-12</div><div class="title">ELK-Filebeat7.4.0单机多实例</div><div class="info">1.起因业务需求，已经转成json格式的nginx日志直接通过filebeat传入了Elasticsearch中，而其他程序日志需要通过filebeat传入logstash进行二次过滤。就需要解决多output的问题。而根据官方文档:

You configure Filebeat to write to a specific output by setting options in the Outputs section of the filebeat.yml config file. Only a single output may be defined.

可知filebeat.yml中output有且只能有一个。当然你可以在filebeat.ymlinput模块中添加多个tags，并传递给logstash，并在logstash上通过不同的标签区分后传入不同的index中。
2.配置单机多实例2.1 filebeat介绍logstash 和filebeat都具有日志收集功能，因为filebeat由Golang编写相较于logstash更轻量，占用资源更少。所以决定在同一台机器上启 ...</div></div></a></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">饼铛</div><div class="author-info__description">寻找属于自己的彩虹海</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">93</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">72</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://t.me/joinchat/c_ParmoHMmU5MDM9" target="_blank" title="Telegram"><i class="fab fa-telegram-plane"></i></a><a class="social-icon" href="https://qm.qq.com/cgi-bin/qm/qr?k=Q1N9l3isk8O_i5awFwO-blAoPH7PUeb4&amp;noverify=0" target="_blank" title="QQ"><i class="fab fa-qq"></i></a><a class="social-icon" href="mailto:admin@cakepanit.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://music.163.com/#/user/home?id=313775282" target="_blank" title="Netease"><i class="fas fa-record-vinyl"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">1.</span> <span class="toc-text">启动过程</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%B0%83%E8%AF%95"><span class="toc-number">2.</span> <span class="toc-text">网络调试</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%B4%E6%97%B6%E5%85%B3%E5%90%AF%E7%BD%91%E5%8D%A1"><span class="toc-number">2.1.</span> <span class="toc-text">临时关启网卡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%A4%9A%E5%9D%97%E7%BD%91%E5%8D%A1"><span class="toc-number">2.2.</span> <span class="toc-text">添加多块网卡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E4%B8%B4%E6%97%B6IP"><span class="toc-number">2.3.</span> <span class="toc-text">配置临时IP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E7%AB%AF%E5%8F%A3%E7%9B%91%E5%90%AC%E7%8A%B6%E6%80%81"><span class="toc-number">2.4.</span> <span class="toc-text">查看端口监听状态</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DNS%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE"><span class="toc-number">2.5.</span> <span class="toc-text">DNS相关配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E8%B7%AF%E7%94%B1%E4%BF%A1%E6%81%AF"><span class="toc-number">2.6.</span> <span class="toc-text">系统路由信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ping%E5%91%BD%E4%BB%A4"><span class="toc-number">2.7.</span> <span class="toc-text">ping命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#watch%E5%91%BD%E4%BB%A4"><span class="toc-number">2.8.</span> <span class="toc-text">watch命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tcpdump%E6%8A%93%E5%8C%85"><span class="toc-number">2.9.</span> <span class="toc-text">tcpdump抓包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SYN%E6%B4%AA%E6%B0%B4%E6%94%BB%E5%87%BB"><span class="toc-number">2.10.</span> <span class="toc-text">SYN洪水攻击</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%9B%B8%E5%85%B3%E5%B1%9E%E6%80%A7"><span class="toc-number">3.</span> <span class="toc-text">文件相关属性</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E8%8A%82%E7%82%B9inode-amp-%E7%A3%81%E7%9B%98%E5%9D%97Block"><span class="toc-number">3.1.</span> <span class="toc-text">索引节点inode&amp;磁盘块Block</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#inode-amp-block%E7%AE%A1%E7%90%86%EF%BC%9A"><span class="toc-number">3.2.</span> <span class="toc-text">inode&amp;block管理：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#linux%E6%96%87%E4%BB%B6%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.3.</span> <span class="toc-text">linux文件类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90%E6%9C%BA%E5%88%B6"><span class="toc-number">3.4.</span> <span class="toc-text">文件权限机制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SELinux"><span class="toc-number">3.5.</span> <span class="toc-text">SELinux</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Linux%E8%BD%AF%E7%A1%AC%E9%93%BE%E6%8E%A5"><span class="toc-number">3.6.</span> <span class="toc-text">Linux软硬链接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%9A%84%E6%97%B6%E9%97%B4%E6%88%B3"><span class="toc-number">3.7.</span> <span class="toc-text">文件的时间戳</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6-amp-%E7%9B%AE%E5%BD%95%E6%9D%83%E9%99%90"><span class="toc-number">3.8.</span> <span class="toc-text">文件&amp;目录权限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E5%BA%94%E7%94%A8"><span class="toc-number">3.9.</span> <span class="toc-text">生产环境应用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E5%92%8C%E7%94%A8%E6%88%B7%E7%BB%84"><span class="toc-number">3.10.</span> <span class="toc-text">用户和用户组</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RPM-YUM%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E7%9B%B8%E5%85%B3"><span class="toc-number">4.</span> <span class="toc-text">RPM&#x2F;YUM软件安装相关</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6-SHELL%E7%9B%B8%E5%85%B3"><span class="toc-number">5.</span> <span class="toc-text">特殊字符&#x2F;SHELL相关</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6"><span class="toc-number">5.1.</span> <span class="toc-text">特殊字符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%A1%E9%81%93%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">5.2.</span> <span class="toc-text">管道重定向</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Linux%E6%AD%A3%E5%88%99"><span class="toc-number">5.3.</span> <span class="toc-text">Linux正则</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#BRE"><span class="toc-number">5.3.1.</span> <span class="toc-text">BRE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ERE"><span class="toc-number">5.3.2.</span> <span class="toc-text">ERE</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Linux%E5%9B%9B%E5%89%91%E5%AE%A2"><span class="toc-number">5.4.</span> <span class="toc-text">Linux四剑客</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#awk"><span class="toc-number">5.4.1.</span> <span class="toc-text">awk</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sed"><span class="toc-number">5.4.2.</span> <span class="toc-text">sed</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#grep"><span class="toc-number">5.4.3.</span> <span class="toc-text">grep</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#find"><span class="toc-number">5.4.4.</span> <span class="toc-text">find</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SHELL%E8%84%9A%E6%9C%AC"><span class="toc-number">5.5.</span> <span class="toc-text">SHELL脚本</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%98%E9%87%8F"><span class="toc-number">5.5.1.</span> <span class="toc-text">变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E5%8F%98%E9%87%8F"><span class="toc-number">5.5.2.</span> <span class="toc-text">特殊变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%98%E9%87%8F%E5%AD%90%E4%B8%B2"><span class="toc-number">5.5.3.</span> <span class="toc-text">变量子串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E6%89%A9%E5%B1%95%E5%8F%98%E9%87%8F"><span class="toc-number">5.5.4.</span> <span class="toc-text">特殊扩展变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">5.5.5.</span> <span class="toc-text">运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%84%9A%E6%9C%AC%E4%BC%A0%E5%8F%82"><span class="toc-number">5.5.6.</span> <span class="toc-text">脚本传参</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95"><span class="toc-number">5.5.7.</span> <span class="toc-text">条件测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%B5%8B%E8%AF%95%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">5.5.8.</span> <span class="toc-text">文件测试表达式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%B5%8B%E8%AF%95%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">5.5.9.</span> <span class="toc-text">字符串测试表达式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%A0%E5%8F%82%E5%92%8C%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95%E7%BB%83%E4%B9%A0"><span class="toc-number">5.5.10.</span> <span class="toc-text">传参和条件测试练习</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E5%85%83%E6%95%B4%E6%95%B0%E6%AF%94%E8%BE%83"><span class="toc-number">5.5.11.</span> <span class="toc-text">二元整数比较</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8F%9C%E5%8D%95%E7%BB%83%E4%B9%A0"><span class="toc-number">5.5.12.</span> <span class="toc-text">菜单练习</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#if%E5%88%A4%E6%96%AD"><span class="toc-number">5.5.13.</span> <span class="toc-text">if判断</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%9B%91%E6%8E%A7"><span class="toc-number">5.5.14.</span> <span class="toc-text">服务监控</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E4%BC%A0%E5%8F%82"><span class="toc-number">5.5.15.</span> <span class="toc-text">函数传参</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E8%87%AA%E5%B8%A6%E5%87%BD%E6%95%B0"><span class="toc-number">5.5.16.</span> <span class="toc-text">系统自带函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#case"><span class="toc-number">5.5.17.</span> <span class="toc-text">case</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC%E4%BC%A0%E9%80%92"><span class="toc-number">5.5.18.</span> <span class="toc-text">返回值传递</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#C6%E5%90%AF%E5%8A%A8%E8%84%9A%E6%9C%AC"><span class="toc-number">5.5.19.</span> <span class="toc-text">C6启动脚本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#C7%E5%90%AF%E5%8A%A8%E8%84%9A%E6%9C%AC"><span class="toc-number">5.5.20.</span> <span class="toc-text">C7启动脚本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PPTP%E5%AE%89%E8%A3%85%E8%84%9A%E6%9C%AC"><span class="toc-number">5.5.21.</span> <span class="toc-text">PPTP安装脚本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#while"><span class="toc-number">5.5.22.</span> <span class="toc-text">while</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E9%9A%8F%E6%9C%BA%E6%95%B0"><span class="toc-number">5.5.23.</span> <span class="toc-text">生成随机数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF%E7%8A%B6%E6%80%81%E6%8E%A7%E5%88%B6"><span class="toc-number">5.5.24.</span> <span class="toc-text">循环状态控制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E7%BB%84"><span class="toc-number">5.5.25.</span> <span class="toc-text">数组</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="toc-number">6.</span> <span class="toc-text">定时任务</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF"><span class="toc-number">6.1.</span> <span class="toc-text">常见错误</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E4%BE%8B%E5%AD%90"><span class="toc-number">6.2.</span> <span class="toc-text">编写例子</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%A3%81%E7%9B%98%E5%92%8C%E5%AD%98%E5%82%A8"><span class="toc-number">7.</span> <span class="toc-text">磁盘和存储</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E4%BB%8B%E7%BB%8D"><span class="toc-number">7.1.</span> <span class="toc-text">存储介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A3%81%E7%9B%98%E9%80%89%E5%9E%8B"><span class="toc-number">7.2.</span> <span class="toc-text">磁盘选型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RAID"><span class="toc-number">7.3.</span> <span class="toc-text">RAID</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#RAID0"><span class="toc-number">7.3.1.</span> <span class="toc-text">RAID0</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RAID1"><span class="toc-number">7.3.2.</span> <span class="toc-text">RAID1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RAID5"><span class="toc-number">7.3.3.</span> <span class="toc-text">RAID5</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RAID10"><span class="toc-number">7.3.4.</span> <span class="toc-text">RAID10</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RAID01"><span class="toc-number">7.3.5.</span> <span class="toc-text">RAID01</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E5%8C%BA"><span class="toc-number">7.4.</span> <span class="toc-text">分区</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#fdisk"><span class="toc-number">7.4.1.</span> <span class="toc-text">fdisk</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#parted"><span class="toc-number">7.4.2.</span> <span class="toc-text">parted</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">7.5.</span> <span class="toc-text">文件系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%88%9B%E5%BB%BA%E5%92%8C%E6%8C%82%E8%BD%BD"><span class="toc-number">7.5.1.</span> <span class="toc-text">文件系统创建和挂载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E4%BF%AE%E5%A4%8D"><span class="toc-number">7.5.2.</span> <span class="toc-text">文件系统修复</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%91%E6%8F%B4%E6%A8%A1%E5%BC%8F"><span class="toc-number">7.6.</span> <span class="toc-text">救援模式</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/forward/d4ac701.html" title="各公版系统修改锁定DNS"><img src="/images/pasted-288.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="各公版系统修改锁定DNS"/></a><div class="content"><a class="title" href="/forward/d4ac701.html" title="各公版系统修改锁定DNS">各公版系统修改锁定DNS</a><time datetime="2022-11-12T03:06:00.000Z" title="发表于 2022-11-12 11:06:00">2022-11-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/forward/1e56645c.html" title="Kong使用OAuth2.0 Plugin"><img src="/images/pasted-280.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Kong使用OAuth2.0 Plugin"/></a><div class="content"><a class="title" href="/forward/1e56645c.html" title="Kong使用OAuth2.0 Plugin">Kong使用OAuth2.0 Plugin</a><time datetime="2022-09-03T10:10:00.000Z" title="发表于 2022-09-03 18:10:00">2022-09-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/forward/3df8560c.html" title="Terraform-基础设施即代码"><img src="/images/pasted-185.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Terraform-基础设施即代码"/></a><div class="content"><a class="title" href="/forward/3df8560c.html" title="Terraform-基础设施即代码">Terraform-基础设施即代码</a><time datetime="2022-07-12T14:29:00.000Z" title="发表于 2022-07-12 22:29:00">2022-07-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/forward/91db5a91.html" title="Apollo In Kubernetes（多数据中心）"><img src="/images/pasted-173.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Apollo In Kubernetes（多数据中心）"/></a><div class="content"><a class="title" href="/forward/91db5a91.html" title="Apollo In Kubernetes（多数据中心）">Apollo In Kubernetes（多数据中心）</a><time datetime="2022-04-04T00:00:00.000Z" title="发表于 2022-04-04 08:00:00">2022-04-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/forward/48a90e5c.html" title="gRPC程序健康检查&amp;Kubernetes部署&amp;负载均衡"><img src="/images/pasted-167.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="gRPC程序健康检查&amp;Kubernetes部署&amp;负载均衡"/></a><div class="content"><a class="title" href="/forward/48a90e5c.html" title="gRPC程序健康检查&amp;Kubernetes部署&amp;负载均衡">gRPC程序健康检查&amp;Kubernetes部署&amp;负载均衡</a><time datetime="2022-01-11T05:59:00.000Z" title="发表于 2022-01-11 13:59:00">2022-01-11</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer-group-container"><div class="footer-group"><span class="footer-group-title">外链</span><a class="footer-group-item" target="_blank" rel="noopener" href="https://www.bilibili.com/">bilibili 弹幕网</a><a class="footer-group-item" target="_blank" rel="noopener" href="https://www.tiobe.com/tiobe-index/">编程语言排名</a><a class="footer-group-item" target="_blank" rel="noopener" href="https://www.submarinecablemap.com/">海底光缆分布</a><a class="footer-group-item" target="_blank" rel="noopener" href="https://cybermap.kaspersky.com/cn">网络威胁地图</a></div><div class="footer-group"><span class="footer-group-title">导航</span><a class="footer-group-item" href="/link/">友情链接</a><a class="footer-group-item" href="/tags/">全部标签</a><a class="footer-group-item" href="/charts/">文章统计</a><a class="footer-group-item" href="/bookshelf/">收藏书单</a></div><div class="footer-group"><span class="footer-group-title">分类</span><a class="footer-group-item" href="/categories/OPS/">运维教程</a><a class="footer-group-item" href="/categories/DBA/">DBA教程</a><a class="footer-group-item" href="/categories/Golang/">编码教程</a><a class="footer-group-item" href="/gallery/">收藏图库</a></div><div class="footer-group"><span class="footer-group-title">关于</span><a class="footer-group-item" href="/notice/">网站公告</a><a class="footer-group-item" href="/about/">关于本站</a><a class="footer-group-item" href="/status">站点监控</a><a class="footer-group-item" href="mailto:admin@cakepanit.com">联系博主</a></div><div class="footer-group" id="footer-group-flink"><span class="footer-group-title">友链<i class="fas fa-arrow-rotate-right" title="随机友链" onclick="eurkon.footerRandomFlink(flinks, 3);"></i></span><a class="footer-group-item" href="" target="_blank" rel="noopener external nofollow noreferrer">加载中...</a><a class="footer-group-item" href="" target="_blank" rel="noopener external nofollow noreferrer">加载中...</a><a class="footer-group-item" href="" target="_blank" rel="noopener external nofollow noreferrer">加载中...</a><a class="footer-group-item" href="/link/">更多友链</a></div><div class="footer-group"><span class="footer-group-title">协议</span><a class="footer-group-item" href="/protocol/comment/" title="用户发言前，请认真阅读本条例。一经发言，即视为同意接受本条例；如不同意，请勿发言。">评论协议</a><a class="footer-group-item" href="/protocol/copyright/" title="本站所有原创文章采用知识共享(Creative Commons)署名—非商业性使用—相同方式共享4.0国际公共许可协议">版权协议</a></div></div><div id="footer-banner"><div id="footer-banner-container"><div class="footer-banner"><div class="copyright">Copyright &copy; 2019 - 2023  Maxbit  All Rights Reserved.</div></div><div class="footer-banner"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn">皖ICP备2021005605号-1</a><a target="_blank" rel="noopener" href="https://www.upyun.com/">UPYUN</a></div></div></div></div></footer></div><div class="hidden" id="rightside-mask" onclick="eurkon.switchRightSide();"></div><div class="hidden" id="rightside"><div id="rightside-header"><div id="rightside-back"><i class="fas fa-chevron-left" onclick="eurkon.backRightSide();"></i></div><div id="rightside-title">设置</div><div id="rightside-close" onclick="eurkon.switchRightSide();"><i class="fas fa-xmark"></i></div></div><div id="rightside-content"><div id="card-post-content"><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分类</span>
            
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/DBA/"><span class="card-category-list-name">DBA</span><span class="card-category-list-count">34</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Golang/"><span class="card-category-list-name">Golang</span><span class="card-category-list-count">8</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/OPS/"><span class="card-category-list-name">OPS</span><span class="card-category-list-count">49</span></a></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a id="tags/Docker/" href="/tags/Docker/" style="font-size: 1.29em; color: rgb(19, 68, 123)">Docker<sup>6</sup></a><a id="tags/OPS/" href="/tags/OPS/" style="font-size: 1.45em; color: rgb(14, 24, 123)">🌍OPS<sup>49</sup></a><a id="tags/Git/" href="/tags/Git/" style="font-size: 1.23em; color: rgb(123, 79, 85)">Git<sup>4</sup></a><a id="tags/GitLab/" href="/tags/GitLab/" style="font-size: 1.23em; color: rgb(79, 136, 163)">GitLab<sup>4</sup></a><a id="tags/Skywalking/" href="/tags/Skywalking/" style="font-size: 1.15em; color: rgb(180, 77, 69)">Skywalking<sup>1</sup></a><a id="tags/链路追踪/" href="/tags/%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA/" style="font-size: 1.15em; color: rgb(15, 90, 189)">链路追踪<sup>1</sup></a><a id="tags/Download/" href="/tags/Download/" style="font-size: 1.15em; color: rgb(162, 182, 24)">⏬Download<sup>1</sup></a><a id="tags/ELK/" href="/tags/ELK/" style="font-size: 1.26em; color: rgb(115, 2, 193)">ELK<sup>5</sup></a><a id="tags/Logstash/" href="/tags/Logstash/" style="font-size: 1.18em; color: rgb(14, 176, 10)">Logstash<sup>2</sup></a><a id="tags/Nginx/" href="/tags/Nginx/" style="font-size: 1.18em; color: rgb(104, 96, 66)">Nginx<sup>2</sup></a><a id="tags/Golang/" href="/tags/Golang/" style="font-size: 1.34em; color: rgb(184, 188, 171)">📝Golang<sup>8</sup></a><a id="tags/JumpServer/" href="/tags/JumpServer/" style="font-size: 1.15em; color: rgb(114, 98, 41)">JumpServer<sup>1</sup></a><a id="tags/堡垒机/" href="/tags/%E5%A0%A1%E5%9E%92%E6%9C%BA/" style="font-size: 1.15em; color: rgb(133, 106, 197)">堡垒机<sup>1</sup></a><a id="tags/iptables/" href="/tags/iptables/" style="font-size: 1.15em; color: rgb(147, 57, 116)">iptables<sup>1</sup></a><a id="tags/Kong/" href="/tags/Kong/" style="font-size: 1.2em; color: rgb(139, 156, 80)">Kong<sup>3</sup></a><a id="tags/OAuth2-0/" href="/tags/OAuth2-0/" style="font-size: 1.15em; color: rgb(39, 99, 136)">OAuth2.0<sup>1</sup></a><a id="tags/MongoDB/" href="/tags/MongoDB/" style="font-size: 1.2em; color: rgb(172, 177, 65)">MongoDB<sup>3</sup></a><a id="tags/NoSQL/" href="/tags/NoSQL/" style="font-size: 1.31em; color: rgb(185, 89, 9)">NoSQL<sup>7</sup></a><a id="tags/MySQL/" href="/tags/MySQL/" style="font-size: 1.42em; color: rgb(114, 49, 49)">🌲MySQL<sup>26</sup></a><a id="tags/主从复制/" href="/tags/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/" style="font-size: 1.37em; color: rgb(99, 100, 186)">主从复制<sup>12</sup></a><a id="tags/读写分离/" href="/tags/%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB/" style="font-size: 1.23em; color: rgb(133, 142, 120)">读写分离<sup>4</sup></a><a id="tags/高可用/" href="/tags/%E9%AB%98%E5%8F%AF%E7%94%A8/" style="font-size: 1.34em; color: rgb(104, 116, 153)">高可用<sup>8</sup></a><a id="tags/分布式/" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 1.26em; color: rgb(155, 138, 62)">分布式<sup>5</sup></a><a id="tags/MyCAT/" href="/tags/MyCAT/" style="font-size: 1.2em; color: rgb(93, 4, 11)">MyCAT<sup>3</sup></a><a id="tags/垂直拆分/" href="/tags/%E5%9E%82%E7%9B%B4%E6%8B%86%E5%88%86/" style="font-size: 1.15em; color: rgb(77, 119, 65)">垂直拆分<sup>1</sup></a><a id="tags/MHA/" href="/tags/MHA/" style="font-size: 1.18em; color: rgb(161, 32, 17)">MHA<sup>2</sup></a><a id="tags/锁/" href="/tags/%E9%94%81/" style="font-size: 1.15em; color: rgb(165, 11, 162)">锁<sup>1</sup></a><a id="tags/日志管理/" href="/tags/%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86/" style="font-size: 1.23em; color: rgb(27, 36, 67)">日志管理<sup>4</sup></a><a id="tags/ACID/" href="/tags/ACID/" style="font-size: 1.15em; color: rgb(93, 65, 76)">ACID<sup>1</sup></a><a id="tags/事务/" href="/tags/%E4%BA%8B%E5%8A%A1/" style="font-size: 1.15em; color: rgb(15, 168, 98)">事务<sup>1</sup></a><a id="tags/SQL/" href="/tags/SQL/" style="font-size: 1.2em; color: rgb(154, 1, 109)">SQL<sup>3</sup></a><a id="tags/一致性hash算法/" href="/tags/%E4%B8%80%E8%87%B4%E6%80%A7hash%E7%AE%97%E6%B3%95/" style="font-size: 1.15em; color: rgb(192, 150, 81)">一致性hash算法<sup>1</sup></a><a id="tags/PAM/" href="/tags/PAM/" style="font-size: 1.15em; color: rgb(192, 126, 121)">PAM<sup>1</sup></a><a id="tags/Ansible/" href="/tags/Ansible/" style="font-size: 1.15em; color: rgb(137, 143, 140)">Ansible<sup>1</sup></a><a id="tags/Playbook/" href="/tags/Playbook/" style="font-size: 1.15em; color: rgb(129, 57, 132)">Playbook<sup>1</sup></a><a id="tags/Redis/" href="/tags/Redis/" style="font-size: 1.26em; color: rgb(43, 66, 3)">Redis<sup>5</sup></a><a id="tags/tools/" href="/tags/tools/" style="font-size: 1.15em; color: rgb(44, 50, 29)">tools<sup>1</sup></a><a id="tags/Zabbix/" href="/tags/Zabbix/" style="font-size: 1.23em; color: rgb(114, 44, 144)">Zabbix<sup>4</sup></a><a id="tags/Zookeeper/" href="/tags/Zookeeper/" style="font-size: 1.2em; color: rgb(118, 186, 137)">Zookeeper<sup>3</sup></a><a id="tags/SVN/" href="/tags/SVN/" style="font-size: 1.15em; color: rgb(32, 173, 81)">SVN<sup>1</sup></a><a id="tags/gRPC/" href="/tags/gRPC/" style="font-size: 1.15em; color: rgb(133, 168, 107)">gRPC<sup>1</sup></a><a id="tags/Kubernetes/" href="/tags/Kubernetes/" style="font-size: 1.4em; color: rgb(13, 73, 14)">⛵Kubernetes<sup>20</sup></a><a id="tags/place/" href="/tags/place/" style="font-size: 1.15em; color: rgb(170, 99, 31)">place<sup>1</sup></a><a id="tags/弹性伸缩/" href="/tags/%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9/" style="font-size: 1.15em; color: rgb(61, 37, 169)">弹性伸缩<sup>1</sup></a><a id="tags/mysql备份/" href="/tags/mysql%E5%A4%87%E4%BB%BD/" style="font-size: 1.15em; color: rgb(102, 200, 84)">mysql备份<sup>1</sup></a><a id="tags/数据备份/" href="/tags/%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD/" style="font-size: 1.18em; color: rgb(20, 35, 134)">数据备份<sup>2</sup></a><a id="tags/调度策略/" href="/tags/%E8%B0%83%E5%BA%A6%E7%AD%96%E7%95%A5/" style="font-size: 1.15em; color: rgb(108, 98, 183)">调度策略<sup>1</sup></a><a id="tags/树莓派/" href="/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/" style="font-size: 1.15em; color: rgb(102, 68, 62)">树莓派<sup>1</sup></a><a id="tags/Minecraft/" href="/tags/Minecraft/" style="font-size: 1.15em; color: rgb(87, 191, 69)">Minecraft<sup>1</sup></a><a id="tags/OPENVPN/" href="/tags/OPENVPN/" style="font-size: 1.15em; color: rgb(46, 56, 196)">OPENVPN<sup>1</sup></a><a id="tags/优化/" href="/tags/%E4%BC%98%E5%8C%96/" style="font-size: 1.15em; color: rgb(161, 159, 83)">优化<sup>1</sup></a><a id="tags/DNS/" href="/tags/DNS/" style="font-size: 1.15em; color: rgb(142, 87, 4)">DNS<sup>1</sup></a><a id="tags/多表联查/" href="/tags/%E5%A4%9A%E8%A1%A8%E8%81%94%E6%9F%A5/" style="font-size: 1.15em; color: rgb(51, 42, 123)">多表联查<sup>1</sup></a><a id="tags/Canal/" href="/tags/Canal/" style="font-size: 1.15em; color: rgb(110, 37, 66)">Canal<sup>1</sup></a><a id="tags/CI-CD/" href="/tags/CI-CD/" style="font-size: 1.18em; color: rgb(6, 23, 84)">CI/CD<sup>2</sup></a><a id="tags/水平拆分/" href="/tags/%E6%B0%B4%E5%B9%B3%E6%8B%86%E5%88%86/" style="font-size: 1.15em; color: rgb(200, 55, 74)">水平拆分<sup>1</sup></a><a id="tags/索引/" href="/tags/%E7%B4%A2%E5%BC%95/" style="font-size: 1.15em; color: rgb(177, 139, 28)">索引<sup>1</sup></a><a id="tags/Redis哨兵/" href="/tags/Redis%E5%93%A8%E5%85%B5/" style="font-size: 1.15em; color: rgb(134, 64, 142)">Redis哨兵<sup>1</sup></a><a id="tags/Terraform/" href="/tags/Terraform/" style="font-size: 1.15em; color: rgb(139, 76, 85)">Terraform<sup>1</sup></a><a id="tags/基础设施即代码/" href="/tags/%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E5%8D%B3%E4%BB%A3%E7%A0%81/" style="font-size: 1.15em; color: rgb(88, 77, 199)">基础设施即代码<sup>1</sup></a><a id="tags/公有云编排/" href="/tags/%E5%85%AC%E6%9C%89%E4%BA%91%E7%BC%96%E6%8E%92/" style="font-size: 1.15em; color: rgb(50, 71, 24)">公有云编排<sup>1</sup></a><a id="tags/数据持久化/" href="/tags/%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/" style="font-size: 1.15em; color: rgb(196, 73, 165)">数据持久化<sup>1</sup></a><a id="tags/Workload/" href="/tags/Workload/" style="font-size: 1.15em; color: rgb(95, 58, 59)">Workload<sup>1</sup></a><a id="tags/服务发现/" href="/tags/%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0/" style="font-size: 1.15em; color: rgb(16, 189, 92)">服务发现<sup>1</sup></a><a id="tags/数据库优化/" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BC%98%E5%8C%96/" style="font-size: 1.15em; color: rgb(104, 49, 183)">数据库优化<sup>1</sup></a><a id="tags/StatefuSet/" href="/tags/StatefuSet/" style="font-size: 1.15em; color: rgb(1, 23, 154)">StatefuSet<sup>1</sup></a><a id="tags/Helm-v3/" href="/tags/Helm-v3/" style="font-size: 1.15em; color: rgb(39, 46, 26)">Helm v3<sup>1</sup></a><a id="tags/容器编排/" href="/tags/%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92/" style="font-size: 1.15em; color: rgb(186, 191, 69)">容器编排<sup>1</sup></a><a id="tags/Prometheus/" href="/tags/Prometheus/" style="font-size: 1.15em; color: rgb(128, 200, 190)">Prometheus<sup>1</sup></a><a id="tags/Apollo/" href="/tags/Apollo/" style="font-size: 1.15em; color: rgb(6, 194, 70)">Apollo<sup>1</sup></a><a id="tags/SHELL/" href="/tags/SHELL/" style="font-size: 1.15em; color: rgb(20, 61, 190)">SHELL<sup>1</sup></a><a id="tags/RAID/" href="/tags/RAID/" style="font-size: 1.15em; color: rgb(20, 143, 2)">RAID<sup>1</sup></a></div></div></div></div><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-sun"></i><i class="fas fa-moon"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="rightmenu"><div class="rightmenu-group rightmenu-small"><div class="rightmenu-item" id="menu-backward" onclick="window.history.back()"><i class="fas fa-arrow-left"></i></div><div class="rightmenu-item" id="menu-forward" onclick="window.history.forward()"><i class="fas fa-arrow-right"></i></div><div class="rightmenu-item" id="menu-refresh" onclick="window.history.reload()"><i class="fas fa-arrow-rotate-right"></i></div><div class="rightmenu-item" id="menu-top" onclick="btf.scrollToDest(0, 500)"><i class="fas fa-arrow-up"></i></div></div><div class="rightmenu-group rightmenu-line" id="rightmenu-text"><div class="rightmenu-item" id="menu-copy"><i class="fas fa-copy"></i><span>复制内容</span></div><div class="rightmenu-item" id="menu-comment"><i class="fas fa-comment"></i><span>引用评论</span></div><div class="rightmenu-item" id="menu-paste"><i class="fas fa-paste"></i><span>粘贴文本</span></div><div class="rightmenu-item" id="menu-search"><i class="fas fa-search"></i><span>在本站搜索</span></div><div class="rightmenu-item" id="menu-baidu"><i class="fas fa-search-plus"></i><span>去百度搜索</span></div></div><div class="rightmenu-group rightmenu-line" id="rightmenu-href"><div class="rightmenu-item" id="menu-copy-image"><i class="fas fa-copy"></i><span>复制图片</span></div><div class="rightmenu-item" id="menu-download-image"><i class="fas fa-download"></i><span>下载图片</span></div><div class="rightmenu-item" id="menu-link"><i class="fas fa-link"></i><span>分享链接</span></div><div class="rightmenu-item" id="menu-window"><i class="fas fa-window-restore"></i><span>新窗口打开</span></div></div><div class="rightmenu-group rightmenu-line" id="rightmenu-post"><a class="rightmenu-item" id="menu-random" href="/random/"><i class="fas fa-random"></i><span>随机文章</span></a><a class="rightmenu-item" id="menu-categories" href="/categories/"><i class="fas fa-shapes"></i><span>全部分类</span></a><a class="rightmenu-item" id="menu-tags" href="/tags/"><i class="fas fa-tags"></i><span>所有标签</span></a><div class="rightmenu-item" id="menu-share"><i class="fas fa-share-square"></i><span>分享本页</span></div></div><div class="rightmenu-group rightmenu-line" id="rightmenu-site"><a class="rightmenu-item" id="menu-message" href="/message/"><i class="fas fa-envelope"></i><span>留言信箱</span></a><a class="rightmenu-item" id="menu-about" href="/about/"><i class="fas fa-address-card"></i><span>关于本站</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/eurkon/color-thief.min.js"></script><script defer src="/js/eurkon/eurkon.js"></script><script defer data-pjax src="/js/eurkon/refresh.js"></script><script src="/js/tw_cn.js"></script><script src="/css/fei/fancybox.umd.min.js"></script><div class="js-pjax"></div><script defer data-pjax async src="//at.alicdn.com/t/font_2358265_expoyqe85d4.js"></script><script src="/css/fei/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/haru01.model.json"},"bottom":-40,"display":{"position":"right","width":190,"height":380,"hOffset":5},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html><script>var posts=["forward/408a4bb8.html","forward/60c1bc2d.html","forward/882d9505.html","forward/d063782.html","forward/download.html","forward/47eea66c.html","forward/131c756.html","forward/17b35260.html","forward/eb065b59.html","forward/873540ab.html","forward/8f91bfec.html","forward/d5b63f7f.html","forward/d12df344.html","forward/f9d199b7.html","forward/420acb0d.html","forward/bac240f7.html","forward/d7240237.html","forward/1e56645c.html","forward/c4bb5371.html","forward/3053135c.html","forward/6c0d75ae.html","forward/74c8159a.html","forward/557ea64b.html","forward/bbb9c58b.html","forward/c919a25c.html","forward/49de8711.html","forward/f34e607d.html","forward/c3e1b71a.html","forward/93ea067.html","forward/bc8a646.html","forward/cb26d424.html","forward/62bf20bb.html","forward/ddc093b3.html","forward/3c4a0863.html","forward/a7fae6f0.html","forward/4f3d60c1.html","forward/ae362167.html","forward/36cbf320.html","forward/67af6371.html","forward/212d60e3.html","forward/fb94f251.html","forward/b571ca78.html","forward/f353577b.html","forward/ae26d423.html","forward/7be7c575.html","forward/fabc6ce1.html","forward/48a90e5c.html","forward/3837938a.html","forward/4a17b156.html","forward/2f09977b.html","forward/2aa52898.html","forward/55d102bd.html","forward/3ea5fff1.html","forward/5234d9e2.html","forward/ad8d3f77.html","forward/8cd3cd17.html","forward/8e9bbd7d.html","forward/6cfd7a23.html","forward/1758bdeb.html","forward/8bd2a16a.html","forward/2cfbf2d2.html","forward/d6f16b84.html","forward/d4ac701.html","forward/d36764c1.html","forward/29b0e6a9.html","forward/13c392b.html","forward/852a3e1.html","forward/40c70ce.html","forward/c3e55136.html","forward/69e1266e.html","forward/84c0fcc7.html","forward/663d93c2.html","forward/68023dec.html","forward/da64184b.html","forward/ae6c7518.html","forward/3df8560c.html","forward/1051b489.html","forward/b36ee5af.html","forward/dc57d8c4.html","forward/61316209.html","forward/503970b4.html","forward/b17eefd4.html","forward/ff7280bd.html","forward/5c41384a.html","forward/14a32ee2.html","forward/58eea07e.html","forward/7139bb18.html","forward/6b4e4d76.html","forward/dc57d8c5.html","forward/91db5a91.html","forward/649a95fd.html","forward/57e2aa11.html","forward/312ec9e0.html"];function toRandomPost(){ window.pjax ? pjax.loadUrl('/'+posts[Math.floor(Math.random()*posts.length)]) : window.open('/'+posts[Math.floor(Math.random()*posts.length)], "_self"); };</script><script>var flinks=[{"name":"Eurkon","link":"https://blog.eurkon.com","avatar":"https://blog.eurkon.com/images/user/avatar.jpg","descr":"不只是代码的搬运工"},{"name":"一朵大呲花","link":"https://www.iiemo.com/","avatar":"https://www.iiemo.com/logo.png","descr":"资深NB前端大佬"},{"name":"豌豆多多","link":"https://wandouduoduo.github.io/","avatar":"/img/link/index.png","descr":"资深沪漂运维工程师"},{"name":"周小雨","link":"https://zxyy.me/","avatar":"https://q2.qlogo.cn/headimg_dl?dst_uin=1016673080&spec=100","descr":"PHP程序猿"},{"name":"ACG食堂","link":"https://canteen.globalacca.top/","avatar":"https://q2.qlogo.cn/headimg_dl?dst_uin=1478030465&spec=100","descr":"汇集ACG、动漫和galgame为一体的综合小站"},{"name":"缺缺","link":"https://www.quewaner.com/","avatar":"https://q2.qlogo.cn/headimg_dl?dst_uin=3393597524&spec=100","descr":"资深前端工程师"},{"name":"yiyun","link":"https://moeci.com/","avatar":"https://q2.qlogo.cn/headimg_dl?dst_uin=2284407619&spec=100","descr":"全栈开发"},{"name":"二哈小窝","link":"https://www.moeeh.cn/","avatar":"https://www.moeeh.cn/eh/eh.png","descr":"苦酒折柳今相离 无风无月也无你"},{"name":"Akilarの糖果屋","link":"https://akilar.top/","avatar":"https://unpkg.zhimg.com/akilar-candyassets/image/siteicon/favicon.png","descr":"期待您的光临！"},{"name":"小高导航","link":"https://www.dhw22.com/","avatar":"https://www.dhw22.com/wp-content/uploads/2022/01/Favicon.png","descr":"资源类技术教程活动导航分类平台"},{"name":"华为开源镜像站","link":"https://mirrors.huaweicloud.com/","avatar":"/img/link/huawei.png","descr":"构建万物互联的智能世界"},{"name":"阿里开源镜像站","link":"https://mirrors.aliyun.com/","avatar":"/img/link/aliyun.png","descr":"为了无法计算的价值"},{"name":"网易开源镜像站","link":"https://mirrors.163.com/","avatar":"/img/link/netease.png","descr":"网聚人的力量"},{"name":"搜狐开源镜像站","link":"https://mirrors.sohu.com/","avatar":"/img/link/souhu.png","descr":"上搜狐 知天下"},{"name":"清华开源镜像站","link":"https://mirrors.tuna.tsinghua.edu.cn/","avatar":"/img/link/qh.png","descr":"自强不息,厚德载物"},{"name":"浙大开源镜像站","link":"https://mirrors.zju.edu.cn/","avatar":"/img/link/zd.png","descr":"兼总条贯,知至知终"},{"name":"中科大开源镜像站","link":"https://mirrors.ustc.edu.cn/","avatar":"/img/link/zkd.png","descr":"红专并进,理实交融"},{"name":"兰大开源镜像站","link":"https://mirror.lzu.edu.cn/","avatar":"/img/link/ld.png","descr":"独树一帜,自强不息"}];function toRandomFlink(){window.open(flinks[Math.floor(Math.random()*flinks.length)].link);};</script>