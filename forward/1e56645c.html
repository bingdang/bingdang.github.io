<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>Kong使用OAuth2.0 Plugin | Maxbit</title><meta name="author" content="饼铛"><meta name="copyright" content="饼铛"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="在之前的文章中已经介绍了Kong这个api网关的安装和基本打开方式。这篇文章介绍一下kong在某个Route或Service中使用OAuth2.0的认证插件进行OAuth2的认证。  环境准备创建Service创建一个Kong的Service Object指向上游的服务。我会使用httpbin作为上游服务作为演示。 REQUEST: 1234curl -X POST \  --url &amp;quot">
<meta property="og:type" content="article">
<meta property="og:title" content="Kong使用OAuth2.0 Plugin">
<meta property="og:url" content="https://cakepanit.com/forward/1e56645c.html">
<meta property="og:site_name" content="Maxbit">
<meta property="og:description" content="在之前的文章中已经介绍了Kong这个api网关的安装和基本打开方式。这篇文章介绍一下kong在某个Route或Service中使用OAuth2.0的认证插件进行OAuth2的认证。  环境准备创建Service创建一个Kong的Service Object指向上游的服务。我会使用httpbin作为上游服务作为演示。 REQUEST: 1234curl -X POST \  --url &amp;quot">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cakepanit.com/images/pasted-280.png">
<meta property="article:published_time" content="2022-09-03T10:10:00.000Z">
<meta property="article:modified_time" content="2022-09-03T12:11:39.203Z">
<meta property="article:author" content="饼铛">
<meta property="article:tag" content="OPS">
<meta property="article:tag" content="Kong">
<meta property="article:tag" content="OAuth2.0">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cakepanit.com/images/pasted-280.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://cakepanit.com/forward/1e56645c.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="/css/fei/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="/css/fei/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":100,"languages":{"author":"作者: 饼铛","link":"链接: ","source":"来源: Maxbit","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Kong使用OAuth2.0 Plugin',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-09-03 20:11:39'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = url => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      link.onload = () => resolve()
      link.onerror = () => reject()
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/fei/swiper-bundle.min.css"><script src="/css/fei/swiper-bundle.min.js"></script><script src="/css/fei/pace.min.js"></script><meta name="generator" content="Hexo 5.4.2"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">93</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">72</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa-fw fas fa-book-open"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fa-fw fas fa-archive"></i><span> 文章列表</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fa-fw fas fa-shapes"></i><span> 全部分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa-fw fas fa-tags"></i><span> 所有标签</span></a></li><li><a class="site-page child" href="/charts/"><i class="fa-fw fa-fw fas fa-chart-line"></i><span> 文章统计</span></a></li><li><a class="site-page child" href="javascript:toRandomPost();"><i class="fa-fw fa-fw fas fa-random"></i><span> 随便看看</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa-fw fas fa-link"></i><span> 导航</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fa-fw fas fa-child"></i><span> 友情链接</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fa-fw fas fa-address-card"></i><span> 关于本站</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 其他</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-file-image"></i><span> 收藏图库</span></a></li><li><a class="site-page child" href="/bookshelf/"><i class="fa-fw fas fa-bookmark"></i><span> 收藏书单</span></a></li><li><a class="site-page child" href="/status"><i class="fa-fw fab fa-accessible-icon"></i><span> 站点监控</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/images/pasted-280.png')"><nav id="nav"><div id="nav-group"><span id="blog-info"> <a class="site-page" href="/" title="Maxbit"><span class="site-name">Maxbit</span><i class="fas fa-home"></i></a></span><span id="page_name"><a class="site-page" id="page-title" title="回到顶部" onclick="btf.scrollToDest(0, 500)"><span>Maxbit</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa-fw fas fa-book-open"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fa-fw fas fa-archive"></i><span> 文章列表</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fa-fw fas fa-shapes"></i><span> 全部分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa-fw fas fa-tags"></i><span> 所有标签</span></a></li><li><a class="site-page child" href="/charts/"><i class="fa-fw fa-fw fas fa-chart-line"></i><span> 文章统计</span></a></li><li><a class="site-page child" href="javascript:toRandomPost();"><i class="fa-fw fa-fw fas fa-random"></i><span> 随便看看</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa-fw fas fa-link"></i><span> 导航</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fa-fw fas fa-child"></i><span> 友情链接</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fa-fw fas fa-address-card"></i><span> 关于本站</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 其他</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-file-image"></i><span> 收藏图库</span></a></li><li><a class="site-page child" href="/bookshelf/"><i class="fa-fw fas fa-bookmark"></i><span> 收藏书单</span></a></li><li><a class="site-page child" href="/status"><i class="fa-fw fab fa-accessible-icon"></i><span> 站点监控</span></a></li></ul></div></div></div><div id="hotkey"><div id="setting-button" onclick="eurkon.switchRightSide();"><a class="site-page" href="javascript:void(0);" title="设置"><i class="fas fa-screwdriver-wrench fa-fw"></i></a></div><div id="top-button"><a class="site-page" href="javascript:void(0);" title="回到顶部" onclick="btf.scrollToDest(0, 500)"><span class="scroll-percent"></span><i class="fas fa-arrow-up fa-fw"></i></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></div></nav><div id="post-cover"><img class="cover" id="post-cover-img" src="/images/pasted-280.png" alt="cover"></div><div id="post-info"><div id="post-meta"><div class="meta-firstline"><span class="post-meta-categories"><i class="fas fa-shapes fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/OPS/">OPS</a></span><span class="post-meta-tags"><span class="post-meta-separator">|</span><i class="fas fa-tags fa-fw post-meta-icon"></i><a class="post-meta-tags" href="/tags/OPS/">🌍OPS</a><span class="post-meta-separator">•</span><a class="post-meta-tags" href="/tags/Kong/">Kong</a><span class="post-meta-separator">•</span><a class="post-meta-tags" href="/tags/OAuth2-0/">OAuth2.0</a></span></div><h1 class="post-title">Kong使用OAuth2.0 Plugin</h1><div class="meta-secondline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-09-03T10:10:00.000Z" title="发表于 2022-09-03 18:10:00">2022-09-03</time></span><span class="post-meta-separator">|</span><span class="post-meta-date"><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-09-03T12:11:39.203Z" title="更新于 2022-09-03 20:11:39">2022-09-03</time></span><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">2.1k</span><span class="post-meta-separator">|</span></span><span class="post-meta-min2read"><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>10分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Kong使用OAuth2.0 Plugin"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div><div id="post"><article class="post-content" id="article-container"><blockquote>
<p>在之前的文章中已经介绍了Kong这个<a href="/forward/b36ee5af.html">api网关的安装</a>和<a href="/forward/55d102bd.html">基本打开方式</a>。这篇文章介绍一下kong在某个<code>Route</code>或<code>Service</code>中使用<code>OAuth2.0</code>的认证插件进行<code>OAuth2</code>的认证。</p>
</blockquote>
<h1 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h1><h2 id="创建Service"><a href="#创建Service" class="headerlink" title="创建Service"></a>创建Service</h2><p>创建一个Kong的Service Object指向上游的服务。我会使用httpbin作为上游服务作为演示。</p>
<p><strong>REQUEST:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST \</span><br><span class="line">  --url <span class="string">&quot;http://localhost:8001/services&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;name=oauth2-test&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;url=http://cakepanit.org/anything&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>预期RESPONSE:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;host&quot;</span>: <span class="string">&quot;httpbin.org&quot;</span>,</span><br><span class="line">  <span class="string">&quot;id&quot;</span>: <span class="string">&quot;33459a79-e284-4bb8-aa6f-65dafd456c6f&quot;</span>,</span><br><span class="line">  <span class="string">&quot;protocol&quot;</span>: <span class="string">&quot;http&quot;</span>,</span><br><span class="line">  <span class="string">&quot;read_timeout&quot;</span>: 60000,</span><br><span class="line">  <span class="string">&quot;tls_verify_depth&quot;</span>: null,</span><br><span class="line">  <span class="string">&quot;port&quot;</span>: 80,</span><br><span class="line">  <span class="string">&quot;updated_at&quot;</span>: 1615001132,</span><br><span class="line">  <span class="string">&quot;ca_certificates&quot;</span>: null,</span><br><span class="line">  <span class="string">&quot;created_at&quot;</span>: 1615001132,</span><br><span class="line">  <span class="string">&quot;connect_timeout&quot;</span>: 60000,</span><br><span class="line">  <span class="string">&quot;write_timeout&quot;</span>: 60000,</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;oauth2-test&quot;</span>,</span><br><span class="line">  <span class="string">&quot;retries&quot;</span>: 5,</span><br><span class="line">  <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/anything&quot;</span>,</span><br><span class="line">  <span class="string">&quot;tls_verify&quot;</span>: null,</span><br><span class="line">  <span class="string">&quot;tags&quot;</span>: null,</span><br><span class="line">  <span class="string">&quot;client_certificate&quot;</span>: null</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="创建Route"><a href="#创建Route" class="headerlink" title="创建Route"></a>创建Route</h2><p>接下来我会创建路径<code>/demo</code>来访问服务。<br><strong>REQUEST:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST \</span><br><span class="line">  --url <span class="string">&quot;http://localhost:8001/services/oauth2-test/routes&quot;</span> \</span><br><span class="line">  --data <span class="string">&#x27;paths[]=/demo&#x27;</span></span><br></pre></td></tr></table></figure>
<p><strong>预期RESPONSE:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;strip_path&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;tags&quot;</span>: null,</span><br><span class="line">  <span class="string">&quot;updated_at&quot;</span>: 1615004204,</span><br><span class="line">  <span class="string">&quot;destinations&quot;</span>: null,</span><br><span class="line">  <span class="string">&quot;headers&quot;</span>: null,</span><br><span class="line">  <span class="string">&quot;protocols&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;http&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;methods&quot;</span>: null,</span><br><span class="line">  <span class="string">&quot;service&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;id&quot;</span>: <span class="string">&quot;33459a79-e284-4bb8-aa6f-65dafd456c6f&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;snis&quot;</span>: null,</span><br><span class="line">  <span class="string">&quot;hosts&quot;</span>: null,</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: null,</span><br><span class="line">  <span class="string">&quot;path_handling&quot;</span>: <span class="string">&quot;v0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;paths&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;/demo&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;preserve_host&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;regex_priority&quot;</span>: 0,</span><br><span class="line">  <span class="string">&quot;response_buffering&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;sources&quot;</span>: null,</span><br><span class="line">  <span class="string">&quot;id&quot;</span>: <span class="string">&quot;e804fef4-fa42-4f7e-be0c-bbe9b9999027&quot;</span>,</span><br><span class="line">  <span class="string">&quot;https_redirect_status_code&quot;</span>: 426,</span><br><span class="line">  <span class="string">&quot;request_buffering&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;created_at&quot;</span>: 1615004204</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这之后我们可以通过 <code>curl localhost:8000/demo</code>来访问上游服务。</p>
<h2 id="启用OAuth2插件"><a href="#启用OAuth2插件" class="headerlink" title="启用OAuth2插件"></a>启用OAuth2插件</h2><p>我会在我们的service object上启用这个插件并且自定义 <code>provision_key</code> . 如果你不自定义这个变量的话，kong会自动生成一个。同时我这里启用了全部四种认证方式以做演示，在现实中你只需要启用你需要的grant。</p>
<p><strong>REQUEST:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST \</span><br><span class="line">  --url http://localhost:8001/services/oauth2-<span class="built_in">test</span>/plugins/ \</span><br><span class="line">  --data <span class="string">&quot;name=oauth2&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;config.scopes[]=email&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;config.scopes[]=phone&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;config.scopes[]=address&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;config.mandatory_scope=true&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;config.provision_key=oauth2-demo-provision-key&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;config.enable_authorization_code=true&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;config.enable_client_credentials=true&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;config.enable_implicit_grant=true&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;config.enable_password_grant=true&quot;</span></span><br></pre></td></tr></table></figure>
<p><strong>预期RESPONSE:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;created_at&quot;</span>: 1615003048,</span><br><span class="line">  <span class="string">&quot;id&quot;</span>: <span class="string">&quot;8bc8ed59-cdb4-4ac4-ab48-7719655cb9f3&quot;</span>,</span><br><span class="line">  <span class="string">&quot;tags&quot;</span>: null,</span><br><span class="line">  <span class="string">&quot;enabled&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;protocols&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;grpc&quot;</span>,</span><br><span class="line">    <span class="string">&quot;grpcs&quot;</span>,</span><br><span class="line">    <span class="string">&quot;http&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;oauth2&quot;</span>,</span><br><span class="line">  <span class="string">&quot;consumer&quot;</span>: null,</span><br><span class="line">  <span class="string">&quot;service&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;id&quot;</span>: <span class="string">&quot;33459a79-e284-4bb8-aa6f-65dafd456c6f&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;route&quot;</span>: null,</span><br><span class="line">  <span class="string">&quot;config&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;pkce&quot;</span>: <span class="string">&quot;lax&quot;</span>,</span><br><span class="line">    <span class="string">&quot;accept_http_if_already_terminated&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;reuse_refresh_token&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;token_expiration&quot;</span>: 7200,</span><br><span class="line">    <span class="string">&quot;mandatory_scope&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;enable_client_credentials&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;hide_credentials&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;enable_authorization_code&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;enable_implicit_grant&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;global_credentials&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;refresh_token_ttl&quot;</span>: 1209600,</span><br><span class="line">    <span class="string">&quot;enable_password_grant&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;scopes&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;email&quot;</span>,</span><br><span class="line">      <span class="string">&quot;phone&quot;</span>,</span><br><span class="line">      <span class="string">&quot;address&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;anonymous&quot;</span>: null,</span><br><span class="line">    <span class="string">&quot;provision_key&quot;</span>: <span class="string">&quot;oauth2-demo-provision-key&quot;</span>,</span><br><span class="line">    <span class="string">&quot;auth_header_name&quot;</span>: <span class="string">&quot;authorization&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时我们再次链接 <code>curl localhost:8000/demo</code> 的时候，我们会得到 <code>HTTP/1.1 401 Unauthorized</code>已经以下错误信息。这就说明Oauth2插件已经成功开启。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;error&quot;</span>: <span class="string">&quot;invalid_request&quot;</span>,</span><br><span class="line">    <span class="string">&quot;error_description&quot;</span>: <span class="string">&quot;The access token is missing&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="创建Consumer"><a href="#创建Consumer" class="headerlink" title="创建Consumer"></a>创建Consumer</h3><p>接下来我们需要创建consumer objectd<br><strong>REQUEST:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST \</span><br><span class="line">  --url <span class="string">&quot;http://localhost:8001/consumers/&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;username=oauth2-tester&quot;</span></span><br></pre></td></tr></table></figure>
<p><strong>RESPONSE:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;custom_id&quot;</span>: null,</span><br><span class="line">  <span class="string">&quot;created_at&quot;</span>: 1615003502,</span><br><span class="line">  <span class="string">&quot;id&quot;</span>: <span class="string">&quot;06d53376-8bfd-4bc7-aaaf-05c37316e7ef&quot;</span>,</span><br><span class="line">  <span class="string">&quot;tags&quot;</span>: null,</span><br><span class="line">  <span class="string">&quot;username&quot;</span>: <span class="string">&quot;oauth2-tester&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建OAuth2-Credential-App"><a href="#创建OAuth2-Credential-App" class="headerlink" title="创建OAuth2 Credential (App)"></a>创建OAuth2 Credential (App)</h3><p>然后我们会在这个consumer下创建Oauth2的身份凭证。在这里我也会使用自定义的<code>client_id</code>和<code>client_secret</code>。如果留空，Kong会自动生成这两个变量。</p>
<blockquote>
<p>如果使用Kong来生成身份凭证请切记不要添加 <code>hash_secret=true</code> 在您的curl命令里面。</p>
</blockquote>
<p><strong>REQUEST:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST \</span><br><span class="line">  --url <span class="string">&quot;http://localhost:8001/consumers/oauth2-tester/oauth2/&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;name=Oauth2 Demo App&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;client_id=oauth2-demo-client-id&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;client_secret=oauth2-demo-client-secret&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;redirect_uris[]=http://localhost:8000/demo&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;hash_secret=true&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>RESPONSE:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;created_at&quot;</span>: 1615004674,</span><br><span class="line">  <span class="string">&quot;id&quot;</span>: <span class="string">&quot;f602f09b-7b7e-4326-b236-2fa8d45badff&quot;</span>,</span><br><span class="line">  <span class="string">&quot;tags&quot;</span>: null,</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Oauth2 Demo App&quot;</span>,</span><br><span class="line">  <span class="string">&quot;client_secret&quot;</span>: <span class="string">&quot;<span class="variable">$pbkdf2</span>-sha512<span class="variable">$i</span>=10000,l=32$e3SNVIWRFt8PuBxjoL1ncQ$/hF26HS30QHopDLMzlZqC+zv0nt3m4YFokuW9eTma6Q&quot;</span>,</span><br><span class="line">  <span class="string">&quot;client_id&quot;</span>: <span class="string">&quot;oauth2-demo-client-id&quot;</span>,</span><br><span class="line">  <span class="string">&quot;redirect_uris&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;http://localhost:8000/demo&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;hash_secret&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;client_type&quot;</span>: <span class="string">&quot;confidential&quot;</span>,</span><br><span class="line">  <span class="string">&quot;consumer&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;id&quot;</span>: <span class="string">&quot;06d53376-8bfd-4bc7-aaaf-05c37316e7ef&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来我们就可以测试不同的grant了。</p>
<h1 id="OAuth的四种授权类型"><a href="#OAuth的四种授权类型" class="headerlink" title="OAuth的四种授权类型"></a>OAuth的四种授权类型</h1><blockquote>
<p>参见: <a target="_blank" rel="noopener" href="https://oauth.net/2/grant-types/">OAuth Grant Types</a>，根据业务场景选择一种合适的类型，这里不再赘述。</p>
</blockquote>
<h2 id="Authorization-Code"><a href="#Authorization-Code" class="headerlink" title="Authorization Code"></a>Authorization Code</h2><p>我们需要先发送认证的请求到<code>https://localhost:8443/demo/oauth2/authorize</code> 获取一个授权码。然后再使用授权码到<code>https://localhost:8443/demo/oauth2/token</code>请求一个访问令牌。</p>
<h3 id="Request-Authorized-Code"><a href="#Request-Authorized-Code" class="headerlink" title="Request Authorized Code"></a>Request Authorized Code</h3><p><strong>REQUEST:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST \</span><br><span class="line">  --url <span class="string">&quot;https://localhost:8443/demo/oauth2/authorize&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;response_type=code&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;scope=email address&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;client_id=oauth2-demo-client-id&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;provision_key=oauth2-demo-provision-key&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;authenticated_userid=authenticated_tester&quot;</span> \</span><br><span class="line">  --insecure</span><br></pre></td></tr></table></figure>

<p><strong>RESPONSE:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;redirect_uri&quot;</span>: <span class="string">&quot;http://localhost:8000/demo?code=jvnD1XBgFqZuqT2OlbcXpDiOlFkx75bU&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样我们就获取到我们的授权码 <code>jvnD1XBgFqZuqT2OlbcXpDiOlFkx75bU</code>，我们可以通过它来请求访问令牌。</p>
<h3 id="Request-Access-Token"><a href="#Request-Access-Token" class="headerlink" title="Request Access Token"></a>Request Access Token</h3><p><strong>REQUEST:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST \</span><br><span class="line">  --url <span class="string">&quot;https://localhost:8443/demo/oauth2/token&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;grant_type=authorization_code&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;client_id=oauth2-demo-client-id&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;client_secret=oauth2-demo-client-secret&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;code=oyPC89DOjHNNc7BBV9YWuUxJQDd5M1TU&quot;</span> \</span><br><span class="line">  --insecure</span><br></pre></td></tr></table></figure>
<p><strong>RESPONSE:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;refresh_token&quot;</span>: <span class="string">&quot;LqJW6mVH4XsNZnoQ5fYbjngBsbUJPVPh&quot;</span>,</span><br><span class="line">  <span class="string">&quot;token_type&quot;</span>: <span class="string">&quot;bearer&quot;</span>,</span><br><span class="line">  <span class="string">&quot;access_token&quot;</span>: <span class="string">&quot;BZiZzJVEuP2mgNvZZBr0mgbRtKsdqgZf&quot;</span>,</span><br><span class="line">  <span class="string">&quot;expires_in&quot;</span>: 7200</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Implicit"><a href="#Implicit" class="headerlink" title="Implicit"></a>Implicit</h2><p>因为安全性的问题，这个可能是你不应该使用的一个grant。更多的原因可以参考Okta的这篇<a target="_blank" rel="noopener" href="https://developer.okta.com/blog/2019/08/22/okta-authjs-pkce#why-you-should-never-use-the-implicit-flow-again">文章</a>。按照我的理解Implicit grant应该只用来做身份的认证而不应该返回通行码用来使用API。使用这个grant的话只需要发送<code>client_id</code>到认证服务器<code>https://localhost:8443/demo/oauth2/authorize</code>就能获取到通行码。</p>
<h3 id="Request-Access-Token-1"><a href="#Request-Access-Token-1" class="headerlink" title="Request Access Token"></a>Request Access Token</h3><p><strong>REQUEST:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST \</span><br><span class="line">  --url <span class="string">&quot;https://localhost:8443/demo/oauth2/authorize&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;response_type=token&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;scope=email address&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;client_id=oauth2-demo-client-id&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;provision_key=oauth2-demo-provision-key&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;authenticated_userid=authenticated_tester&quot;</span> \</span><br><span class="line">  --insecure</span><br></pre></td></tr></table></figure>
<p><strong>RESPONSE:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;redirect_uri&quot;</span>: <span class="string">&quot;http://localhost:8000/demo#access_token=Ubs61rbN0JSO6JMV9N7WC4ZvCWEpWp5z&amp;expires_in=7200&amp;token_type=bearer&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>你可以在返回的uri的fragment里面找到<code>access_token</code>。</p>
<h2 id="Client-Credentials"><a href="#Client-Credentials" class="headerlink" title="Client Credentials"></a>Client Credentials</h2><p>这个grant主要应用在机器对机器之间，因此认证服务器只会返回通行码而不会返回刷新码。每次通行码过期之后都需要重新请求新的。</p>
<h3 id="Request-Access-Code"><a href="#Request-Access-Code" class="headerlink" title="Request Access Code"></a>Request Access Code</h3><p><strong>REQUEST:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST \</span><br><span class="line">  --url <span class="string">&quot;https://localhost:8443/demo/oauth2/token&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;grant_type=client_credentials&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;scope=email address&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;client_id=oauth2-demo-client-id&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;client_secret=oauth2-demo-client-secret&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;provision_key=oauth2-demo-provision-key&quot;</span> \</span><br><span class="line">  --insecure</span><br></pre></td></tr></table></figure>
<p><strong>RESPONSE:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;token_type&quot;</span>: <span class="string">&quot;bearer&quot;</span>,</span><br><span class="line">  <span class="string">&quot;access_token&quot;</span>: <span class="string">&quot;7mKwrytPCZEgTjbr40rV5L0dk2Zykota&quot;</span>,</span><br><span class="line">  <span class="string">&quot;expires_in&quot;</span>: 7200</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Password"><a href="#Password" class="headerlink" title="Password"></a>Password</h2><p>该flow需要用户提供认证的用户名，因此用户需要在Kong的前面添加用户身份认证并且提供<code>authenticated_userid</code>给Kong来颁发通行码和刷新码给用户。</p>
<h3 id="Request-Access-Code-1"><a href="#Request-Access-Code-1" class="headerlink" title="Request Access Code"></a>Request Access Code</h3><p><strong>REQUEST:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST \</span><br><span class="line"> --url <span class="string">&quot;https://localhost:8443/demo/oauth2/token&quot;</span> \</span><br><span class="line"> --data <span class="string">&quot;grant_type=password&quot;</span> \</span><br><span class="line"> --data <span class="string">&quot;scope=email address&quot;</span> \</span><br><span class="line"> --data <span class="string">&quot;client_id=oauth2-demo-client-id&quot;</span> \</span><br><span class="line"> --data <span class="string">&quot;client_secret=oauth2-demo-client-secret&quot;</span> \</span><br><span class="line"> --data <span class="string">&quot;provision_key=oauth2-demo-provision-key&quot;</span> \</span><br><span class="line"> --data <span class="string">&quot;authenticated_userid=authenticated_tester&quot;</span> \</span><br><span class="line"> --insecure</span><br></pre></td></tr></table></figure>
<p><strong>RESPONSE:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;refresh_token&quot;</span>: <span class="string">&quot;rYokjg6H8Vi23xcdLKJhGBbt4OkbNTpy&quot;</span>,</span><br><span class="line">  <span class="string">&quot;token_type&quot;</span>: <span class="string">&quot;bearer&quot;</span>,</span><br><span class="line">  <span class="string">&quot;access_token&quot;</span>: <span class="string">&quot;2TVKDlWyoFODlNuIvQaLdCFU7Ids8Gyk&quot;</span>,</span><br><span class="line">  <span class="string">&quot;expires_in&quot;</span>: 7200</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="使用-access-token"><a href="#使用-access-token" class="headerlink" title="使用 access_token"></a>使用 <code>access_token</code></h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET \</span><br><span class="line">  --url <span class="string">&quot;http://localhost:8000/demo&quot;</span> \</span><br><span class="line">  --header <span class="string">&quot;Authorization: Bearer &lt;ACCESS_TOKEN&gt;&quot;</span></span><br></pre></td></tr></table></figure>

<h1 id="使用PKCE"><a href="#使用PKCE" class="headerlink" title="使用PKCE"></a>使用PKCE</h1><p>在使用<code>authorization code grant</code>的时候，用户可以使用<a target="_blank" rel="noopener" href="https://oauth.net/2/pkce/">PKCE</a>加强安全性。</p>
<h2 id="生成Verifier-and-Challenge"><a href="#生成Verifier-and-Challenge" class="headerlink" title="生成Verifier and Challenge"></a>生成Verifier and Challenge</h2><p>现实中用户需要自己想办法在自己的程序中按需自动生成这两个变量。在我们的演示中，我会使用<a target="_blank" rel="noopener" href="https://tonyxu-io.github.io/pkce-generator/">https://tonyxu-io.github.io/pkce-generator/</a>来生成。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Code Verifier:</span><br><span class="line">8FK~B.3ERQPsn4xoSo.7pkmxc6wEiFabpqooHnFJKyyT3ZI41jh9DML0TA7UTVTYrxhUtsNfcOp9RcVhyKR~2GdWCFlv00WKFJ1ha_acuzeuyFYDI1.j4nJ3epQUmc0w</span><br><span class="line"></span><br><span class="line">Code Challenge:</span><br><span class="line">nVFqpBvGXtATi0hhNnNuWE5PZNRQTNGR95DJZNcXEaU</span><br></pre></td></tr></table></figure>
<h2 id="Request-Authorized-Code-1"><a href="#Request-Authorized-Code-1" class="headerlink" title="Request Authorized Code"></a>Request Authorized Code</h2><p><strong>REQUEST:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST \</span><br><span class="line">  --url <span class="string">&quot;https://localhost:8443/demo/oauth2/authorize&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;response_type=code&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;scope=email address&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;client_id=oauth2-demo-client-id&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;provision_key=oauth2-demo-provision-key&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;authenticated_userid=authenticated_tester&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;code_challenge=nVFqpBvGXtATi0hhNnNuWE5PZNRQTNGR95DJZNcXEaU&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;code_challenge_method=S256&quot;</span> \</span><br><span class="line">  --insecure</span><br></pre></td></tr></table></figure>
<p><strong>RESPONSE:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;redirect_uri&quot;</span>: <span class="string">&quot;http://localhost:8000/demo?code=5CzRTGquWIq7ePVjuX0Yyx5XZsCZUlML&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Request-Access-Token-2"><a href="#Request-Access-Token-2" class="headerlink" title="Request Access Token"></a>Request Access Token</h2><p><strong>REQUEST:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST \</span><br><span class="line">  --url <span class="string">&quot;https://localhost:8443/demo/oauth2/token&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;grant_type=authorization_code&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;client_id=oauth2-demo-client-id&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;client_secret=oauth2-demo-client-secret&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;code_verifier=8FK~B.3ERQPsn4xoSo.7pkmxc6wEiFabpqooHnFJKyyT3ZI41jh9DML0TA7UTVTYrxhUtsNfcOp9RcVhyKR~2GdWCFlv00WKFJ1ha_acuzeuyFYDI1.j4nJ3epQUmc0w&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;code=51yMXT93QTQUn0zqbvBsUsWNNRRT3sce&quot;</span> \</span><br><span class="line">  --insecure</span><br></pre></td></tr></table></figure>
<p><strong>RESPONSE:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;refresh_token&quot;</span>: <span class="string">&quot;c3blcIo9QwexfYAGne98u91vKBd3W9pW&quot;</span>,</span><br><span class="line">  <span class="string">&quot;token_type&quot;</span>: <span class="string">&quot;bearer&quot;</span>,</span><br><span class="line">  <span class="string">&quot;access_token&quot;</span>: <span class="string">&quot;pCMgPx97ApLJFM9zIv6TmdXEWmH5xlLq&quot;</span>,</span><br><span class="line">  <span class="string">&quot;expires_in&quot;</span>: 7200</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Refresh-Token"><a href="#Refresh-Token" class="headerlink" title="Refresh Token"></a>Refresh Token</h1><p>在上述的例子中，各位可以看到<code>authorization_code</code>和<code>password</code>grant会返回一个<code>refresh_token</code>给用户。用户可以使用这个刷新码来请求信的通行码。Kong默认每个刷新码只能使用一次。<br><strong>REQUEST:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST \</span><br><span class="line">  --url <span class="string">&quot;https://localhost:8443/demo/oauth2/token&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;grant_type=refresh_token&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;client_id=oauth2-demo-client-id&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;client_secret=oauth2-demo-client-secret&quot;</span> \</span><br><span class="line">  --data <span class="string">&quot;refresh_token=&lt;REFRESH_TOKEN&gt;&quot;</span> \</span><br><span class="line">  --insecure</span><br></pre></td></tr></table></figure>

<p><strong>RESPONSE:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;refresh_token&quot;</span>: <span class="string">&quot;AbvtChlNibVCyQxmf0Ue0lQ9fzXLCNQv&quot;</span>,</span><br><span class="line">  <span class="string">&quot;token_type&quot;</span>: <span class="string">&quot;bearer&quot;</span>,</span><br><span class="line">  <span class="string">&quot;access_token&quot;</span>: <span class="string">&quot;d3n0lHkrvYi6CDolsDWdMs0lZ8PblFyQ&quot;</span>,</span><br><span class="line">  <span class="string">&quot;expires_in&quot;</span>: 7200</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info">Kong使用OAuth2.0 Plugin</span></div><div class="post-copyright__url"><span class="post-copyright-info"><a id="post-url" href="https://cakepanit.com/forward/1e56645c.html">https://cakepanit.com/forward/1e56645c.html</a><a id="post-url-copy" title="复制文章链接" onclick="btf.copyFn(&quot;https://cakepanit.com/forward/1e56645c.html&quot;)"><i class="fas fa-paste copy-button"></i></a></span></div><div class="post-copyright__cc"><span class="post-copyright-info">转载前请阅读本站 <a href="/protocol/copyright/" title="本站所有原创文章采用知识共享(Creative Commons)署名—非商业性使用—相同方式共享4.0国际公共许可协议">版权协议</a>，文章著作权归 <a href="https://cakepanit.com">饼铛</a> 所有，转载请注明出处。</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/OPS/">🌍OPS</a><a class="post-meta__tags" href="/tags/Kong/">Kong</a><a class="post-meta__tags" href="/tags/OAuth2-0/">OAuth2.0</a></div><div class="post_share"><div class="social-share" data-image="/images/pasted-280.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/DC9cYFtFic5G6JZgktjajza5fVfRJLaXLS.png" target="_blank"><img class="post-qr-code-img" src="/img/DC9cYFtFic5G6JZgktjajza5fVfRJLaXLS.png" alt="狗狗币(DogeCoin)"/></a><div class="post-qr-code-desc">狗狗币(DogeCoin)</div></li><li class="reward-item"><a href="/img/bc1q63xj5a3xgfulv8guate5qxmh6qh8ws7c3casqm.png" target="_blank"><img class="post-qr-code-img" src="/img/bc1q63xj5a3xgfulv8guate5qxmh6qh8ws7c3casqm.png" alt="比特币(BitCoin)"/></a><div class="post-qr-code-desc">比特币(BitCoin)</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/forward/d4ac701.html" title="各公版系统修改锁定DNS"><img class="cover" src="/images/pasted-288.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">各公版系统修改锁定DNS</div><div class="content">Ubuntu系列Ubuntu 16.x1）编辑或创建 /etc/dhcp/dhclient.conf文件。
注意：您必须拥有根用户权限才能编辑此文件。您可以使用sudo -i成为根用户，或者使用 sudo 执行所有命令。
2）将 supersede 命令添加到文件以覆盖 domain-name-servers。:
1234# /etc/dhcp/dhclient.conf 文件尾部追加supersede domain-name-servers 172.22.xxx.xxx,10.xx.xx.202,10.xx.xx.244;supersede domain-name &quot;xxx.bilibili.xxx&quot;;
在此修改之后，resolv.conf 文件将在实例重启时或重启网络时更新，以仅包含您在 dhclient 文件中指定的 DNS 服务器。有关 supersede 命令的更多信息，请参阅 Linux 手册页上的 dhclient.conf(5)。
3）重启实例或网络。
1systemctl restart networking
Ubuntu 18.x ~ 22默认情 ...</div></div></a></div><div class="next-post pull-right"><a href="/forward/3df8560c.html" title="Terraform-基础设施即代码"><img class="cover" src="/images/pasted-185.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Terraform-基础设施即代码</div><div class="content">Terraform介绍Terraform是HashiCorp公司旗下的Provision Infrastructure产品, 是AWS APN Technology Partner与AWS DevOps Competency Partner。Terraform是一个IT基础架构自动化编排工具，它的口号是“Write, Plan, and Create Infrastructure as Code”, 是一个“基础设施即代码”工具，类似于AWS CloudFormation，允许您创建、更新和版本控制的AWS基础设施。
Terraform基于AWS Go SDK进行构建，采用HashiCorp配置语言（HCL）对资源进行编排，具体的说就是可以用代码来管理维护IT资源，比如针对AWS，我们可以用它创建、修改或删除 S3 Bucket、Lambda,、EC2、Kinesis、VPC等各种资源。并且在真正运行之前可以看到执行计划(即干运行-dryrun)。由于状态保存到文件中，因此能够离线方式查看资源情况（前提是不要在 Terraform 之外对资源进行修改）。Terraform 配置的状态除 ...</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/forward/55d102bd.html" title="k8s企业级DevOps实践-Kong的两种打开方式"><img class="cover" src="/images/pasted-84.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-16</div><div class="title">k8s企业级DevOps实践-Kong的两种打开方式</div><div class="info">概述KONG的核心对象为:upstream、target、service、route

upstream: 是对上游服务器的抽象；
target: 代表了一个物理服务，是 ip + port 的抽象；
service: 是抽象层面的服务，他可以直接映射到一个物理服务(host 指向 ip + port)，也可以指向一个upstream 来做到负载均衡；
route: 是路由的抽象，他负责将实际的 request 映射到 service。

KONG监听的端口为：8000、8001、8443、8444、8100

8444: 带ssl的管理端口
8000/8443: 分别是用来监听来自客户端的Http 和 Https请求，等价于 Nginx 默认的 80 端口
8001: 端口便是默认的管理端口，可以通过 HTTP Restful API 来动态管理 Kong 的配置
8100: 为prometheus获取metrics指标端口

案例Nginx Conf01:
12345678910upstream helloUpstream &#123;    server localhost:30 ...</div></div></a></div><div><a href="/forward/b36ee5af.html" title="k8s企业级DevOps实践-Kong in Kubernetes"><img class="cover" src="/images/pasted-84.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-11</div><div class="title">k8s企业级DevOps实践-Kong in Kubernetes</div><div class="info">Kong介绍本文介绍将 Kong 微服务网关作为 Kubernetes 集群内部业务项目之间通讯的最佳实践，之前写过一篇文章使用 Nginx Ingress Controller 作为集群统一的流量入口：使用 Kubernetes Ingress 对外暴露服务，但是相比于 Kong Ingress Controller来说，Kong 支持的功能更加强大，更适合微服务架构：

拥有庞大的插件生态，能轻易扩展 Kong 支持的功能，比如 API 认证，流控，访问限制等；
Kong 服务本身和 Admin 管理 API 都集成在一个进程，通过端口区分两者，简化了部署的复杂度；
Kong 节点的配置统一持久化到数据库，所有节点通过数据库共享数据，在 Ingress 更新后能实时同步到各个节点，而 Nginx Ingress Controller 是通过重新加载机制响应 Ingress 更新，这种方式代价比较大，可能会导致服务的短暂中断；
Kong 有成熟的第三方管理 UI 和 Admin 管理 API 对接，从而能可视化管理 Kong 配置。

kong是一个云原生的、高性能的、可扩展的API ...</div></div></a></div><div><a href="/forward/60c1bc2d.html" title="Git-C7下Gitlab-12.3.5安装"><img class="cover" src="/images/img-160.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-06-22</div><div class="title">Git-C7下Gitlab-12.3.5安装</div><div class="info">1.GitLab 概述：　　是一个利用 Ruby on Rails 开发的开源应用程序，实现一个自托管的 Git 项目仓库，可通过 Web界面进行访问公开的或者私人项目。Ruby on Rails 是一个可以使你开发、部署、维护 web 应用程序变得简单的框架。
   GitLab 拥有不 Github 类似的功能，能够浏览源代码，管理缺陷和注释。可以管理团队对仓库的访问，它非常易于浏览提交过的版本并提供一个文件历史库。它还提供一个代码片段收集功能可以轻松实现代码复用，便于日后有需要的时候进行查找。GitLab 中文网：https://www.gitlab.cc/installation/#centos-7
2.GitHub 和 GitLab 的区别:2.1相同点:
二者都是基于 web 的 Git 仓库，在很大程度上 GitLab 是仿照 GitHub 来做的，它们都提供了分享开源项目的平台，为开发团队提供了存储、分享、发布和合作开发项目的中心化云存储的场所。

2.2不同点：
GitHub 如果要使用私有仓库，超过 3 个人就收费。GitLab 可以在上面创建私人的克费仓库。
Gi ...</div></div></a></div><div><a href="/forward/408a4bb8.html" title="Docker-安装&amp;基础管理"><img class="cover" src="/images/img-163.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-16</div><div class="title">Docker-安装&amp;基础管理</div><div class="info">1.Docker介绍1.1什么是容器？容器就是在隔离的环境运行的一个进程，如果进程停止，容器就会销毁。隔离的环境拥有自己的系统文件，ip地址， 主机名等。
1.2docker的主要组成部分docker是传统的CS架构分为docker client和docker server,向mysql一样docker主要组件有：镜像、容器、仓库、网络、存储 
2.Docker安装12[root@wikifx2 ~]# uname -r3.10.0-1127.13.1.el7.x86_64

2.1配置网卡转发,看值是否为112$ sysctl -a |grep -w net.ipv4.ip_forwardnet.ipv4.ip_forward = 1

若未配置，需要执行如下123456$ cat &lt;&lt;EOF &gt;  /etc/sysctl.d/docker.confnet.bridge.bridge-nf-call-ip6tables = 1net.bridge.bridge-nf-call-iptables = 1net.ipv4.ip_forward=1EOF$ sysctl  ...</div></div></a></div><div><a href="/forward/882d9505.html" title="Docker-手动构建dotnet镜像"><img class="cover" src="/images/img-163.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-21</div><div class="title">Docker-手动构建dotnet镜像</div><div class="info">1.docker环境12345678910111213[root@wikifx2 ~]# docker image lsREPOSITORY          TAG                 IMAGE ID            CREATED             SIZEnginx               latest              0901fa9da894        10 days ago         132MBnginx               latest              0901fa9da894        10 days ago         132MBalpine              latest              a24bb4013296        7 weeks ago         5.57MBcentos              7                   b5b4d78bc90c        2 months ago        203MB[root@wikifx2 ~ ...</div></div></a></div><div><a href="/forward/d063782.html" title="Docker安装Skywalking"><img class="cover" src="/images/pasted-25.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-22</div><div class="title">Docker安装Skywalking</div><div class="info">采用H2部署oapskywalking默认的数据存储方式即是内存数据库H2。该方式用于方便体验skywalking，但不推荐使用在生产环境。
运行容器命令：
1234567docker run --name oap-h2 --restart always -d \--restart=always \-e TZ=Asia/Shanghai \-p 12800:12800 \-p 11800:11800 \-e SW_STORAGE=h2 \apache/skywalking-oap-server:8.3.0-es7
采用MySQL部署oap需要注意原生的docker镜像中没有mysql驱动，所以需要手动上传mysql的驱动到/skywalking/oap-libs/下，命令如下：
1docker cp mysql-connector-java-8.0.19.jar e2ea45eb7118124cf1d89bdf4eac1e798f857d1a2b6d7b43416bf30a57d2af6b:/skywalking/oap-libs/mysql-connector-java-8.0.19 ...</div></div></a></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">饼铛</div><div class="author-info__description">寻找属于自己的彩虹海</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">93</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">72</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://t.me/joinchat/c_ParmoHMmU5MDM9" target="_blank" title="Telegram"><i class="fab fa-telegram-plane"></i></a><a class="social-icon" href="https://qm.qq.com/cgi-bin/qm/qr?k=Q1N9l3isk8O_i5awFwO-blAoPH7PUeb4&amp;noverify=0" target="_blank" title="QQ"><i class="fab fa-qq"></i></a><a class="social-icon" href="mailto:admin@cakepanit.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://music.163.com/#/user/home?id=313775282" target="_blank" title="Netease"><i class="fas fa-record-vinyl"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">1.</span> <span class="toc-text">环境准备</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAService"><span class="toc-number">1.1.</span> <span class="toc-text">创建Service</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BARoute"><span class="toc-number">1.2.</span> <span class="toc-text">创建Route</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%AF%E7%94%A8OAuth2%E6%8F%92%E4%BB%B6"><span class="toc-number">1.3.</span> <span class="toc-text">启用OAuth2插件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAConsumer"><span class="toc-number">1.3.1.</span> <span class="toc-text">创建Consumer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAOAuth2-Credential-App"><span class="toc-number">1.3.2.</span> <span class="toc-text">创建OAuth2 Credential (App)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#OAuth%E7%9A%84%E5%9B%9B%E7%A7%8D%E6%8E%88%E6%9D%83%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.</span> <span class="toc-text">OAuth的四种授权类型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Authorization-Code"><span class="toc-number">2.1.</span> <span class="toc-text">Authorization Code</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Request-Authorized-Code"><span class="toc-number">2.1.1.</span> <span class="toc-text">Request Authorized Code</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Request-Access-Token"><span class="toc-number">2.1.2.</span> <span class="toc-text">Request Access Token</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Implicit"><span class="toc-number">2.2.</span> <span class="toc-text">Implicit</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Request-Access-Token-1"><span class="toc-number">2.2.1.</span> <span class="toc-text">Request Access Token</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Client-Credentials"><span class="toc-number">2.3.</span> <span class="toc-text">Client Credentials</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Request-Access-Code"><span class="toc-number">2.3.1.</span> <span class="toc-text">Request Access Code</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Password"><span class="toc-number">2.4.</span> <span class="toc-text">Password</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Request-Access-Code-1"><span class="toc-number">2.4.1.</span> <span class="toc-text">Request Access Code</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-access-token"><span class="toc-number">3.</span> <span class="toc-text">使用 access_token</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8PKCE"><span class="toc-number">4.</span> <span class="toc-text">使用PKCE</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E6%88%90Verifier-and-Challenge"><span class="toc-number">4.1.</span> <span class="toc-text">生成Verifier and Challenge</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Request-Authorized-Code-1"><span class="toc-number">4.2.</span> <span class="toc-text">Request Authorized Code</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Request-Access-Token-2"><span class="toc-number">4.3.</span> <span class="toc-text">Request Access Token</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Refresh-Token"><span class="toc-number">5.</span> <span class="toc-text">Refresh Token</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/forward/d4ac701.html" title="各公版系统修改锁定DNS"><img src="/images/pasted-288.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="各公版系统修改锁定DNS"/></a><div class="content"><a class="title" href="/forward/d4ac701.html" title="各公版系统修改锁定DNS">各公版系统修改锁定DNS</a><time datetime="2022-11-12T03:06:00.000Z" title="发表于 2022-11-12 11:06:00">2022-11-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/forward/1e56645c.html" title="Kong使用OAuth2.0 Plugin"><img src="/images/pasted-280.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Kong使用OAuth2.0 Plugin"/></a><div class="content"><a class="title" href="/forward/1e56645c.html" title="Kong使用OAuth2.0 Plugin">Kong使用OAuth2.0 Plugin</a><time datetime="2022-09-03T10:10:00.000Z" title="发表于 2022-09-03 18:10:00">2022-09-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/forward/3df8560c.html" title="Terraform-基础设施即代码"><img src="/images/pasted-185.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Terraform-基础设施即代码"/></a><div class="content"><a class="title" href="/forward/3df8560c.html" title="Terraform-基础设施即代码">Terraform-基础设施即代码</a><time datetime="2022-07-12T14:29:00.000Z" title="发表于 2022-07-12 22:29:00">2022-07-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/forward/91db5a91.html" title="Apollo In Kubernetes（多数据中心）"><img src="/images/pasted-173.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Apollo In Kubernetes（多数据中心）"/></a><div class="content"><a class="title" href="/forward/91db5a91.html" title="Apollo In Kubernetes（多数据中心）">Apollo In Kubernetes（多数据中心）</a><time datetime="2022-04-04T00:00:00.000Z" title="发表于 2022-04-04 08:00:00">2022-04-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/forward/48a90e5c.html" title="gRPC程序健康检查&amp;Kubernetes部署&amp;负载均衡"><img src="/images/pasted-167.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="gRPC程序健康检查&amp;Kubernetes部署&amp;负载均衡"/></a><div class="content"><a class="title" href="/forward/48a90e5c.html" title="gRPC程序健康检查&amp;Kubernetes部署&amp;负载均衡">gRPC程序健康检查&amp;Kubernetes部署&amp;负载均衡</a><time datetime="2022-01-11T05:59:00.000Z" title="发表于 2022-01-11 13:59:00">2022-01-11</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer-group-container"><div class="footer-group"><span class="footer-group-title">外链</span><a class="footer-group-item" target="_blank" rel="noopener" href="https://www.bilibili.com/">bilibili 弹幕网</a><a class="footer-group-item" target="_blank" rel="noopener" href="https://www.tiobe.com/tiobe-index/">编程语言排名</a><a class="footer-group-item" target="_blank" rel="noopener" href="https://www.infrapedia.com/">海底光缆分布</a><a class="footer-group-item" target="_blank" rel="noopener" href="https://cybermap.kaspersky.com/cn">网络威胁地图</a></div><div class="footer-group"><span class="footer-group-title">导航</span><a class="footer-group-item" href="/link/">友情链接</a><a class="footer-group-item" href="/tags/">全部标签</a><a class="footer-group-item" href="/charts/">文章统计</a><a class="footer-group-item" href="/bookshelf/">收藏书单</a></div><div class="footer-group"><span class="footer-group-title">分类</span><a class="footer-group-item" href="/categories/OPS/">运维教程</a><a class="footer-group-item" href="/categories/DBA/">DBA教程</a><a class="footer-group-item" href="/categories/Golang/">编码教程</a><a class="footer-group-item" href="/gallery/">收藏图库</a></div><div class="footer-group"><span class="footer-group-title">关于</span><a class="footer-group-item" href="/notice/">网站公告</a><a class="footer-group-item" href="/about/">关于本站</a><a class="footer-group-item" href="/status">站点监控</a><a class="footer-group-item" href="mailto:admin@cakepanit.com">联系博主</a></div><div class="footer-group" id="footer-group-flink"><span class="footer-group-title">友链<i class="fas fa-arrow-rotate-right" title="随机友链" onclick="eurkon.footerRandomFlink(flinks, 3);"></i></span><a class="footer-group-item" href="" target="_blank" rel="noopener external nofollow noreferrer">加载中...</a><a class="footer-group-item" href="" target="_blank" rel="noopener external nofollow noreferrer">加载中...</a><a class="footer-group-item" href="" target="_blank" rel="noopener external nofollow noreferrer">加载中...</a><a class="footer-group-item" href="/link/">更多友链</a></div><div class="footer-group"><span class="footer-group-title">协议</span><a class="footer-group-item" href="/protocol/comment/" title="用户发言前，请认真阅读本条例。一经发言，即视为同意接受本条例；如不同意，请勿发言。">评论协议</a><a class="footer-group-item" href="/protocol/copyright/" title="本站所有原创文章采用知识共享(Creative Commons)署名—非商业性使用—相同方式共享4.0国际公共许可协议">版权协议</a></div></div><div id="footer-banner"><div id="footer-banner-container"><div class="footer-banner"><div class="copyright">Copyright &copy; 2020 - 2023  饼铛.com  All Rights Reserved.</div></div><div class="footer-banner"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn">皖ICP备2021005605号-1</a><a target="_blank" rel="noopener" href="https://www.upyun.com/">UPYUN</a></div></div></div></div></footer></div><div class="hidden" id="rightside-mask" onclick="eurkon.switchRightSide();"></div><div class="hidden" id="rightside"><div id="rightside-header"><div id="rightside-back"><i class="fas fa-chevron-left" onclick="eurkon.backRightSide();"></i></div><div id="rightside-title">设置</div><div id="rightside-close" onclick="eurkon.switchRightSide();"><i class="fas fa-xmark"></i></div></div><div id="rightside-content"><div id="card-post-content"><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分类</span>
            
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/DBA/"><span class="card-category-list-name">DBA</span><span class="card-category-list-count">34</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Golang/"><span class="card-category-list-name">Golang</span><span class="card-category-list-count">8</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/OPS/"><span class="card-category-list-name">OPS</span><span class="card-category-list-count">49</span></a></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a id="tags/Git/" href="/tags/Git/" style="font-size: 1.23em; color: rgb(113, 176, 5)">Git<sup>4</sup></a><a id="tags/GitLab/" href="/tags/GitLab/" style="font-size: 1.23em; color: rgb(154, 146, 117)">GitLab<sup>4</sup></a><a id="tags/OPS/" href="/tags/OPS/" style="font-size: 1.45em; color: rgb(21, 115, 115)">🌍OPS<sup>49</sup></a><a id="tags/Docker/" href="/tags/Docker/" style="font-size: 1.29em; color: rgb(51, 148, 32)">Docker<sup>6</sup></a><a id="tags/Skywalking/" href="/tags/Skywalking/" style="font-size: 1.15em; color: rgb(149, 40, 7)">Skywalking<sup>1</sup></a><a id="tags/链路追踪/" href="/tags/%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA/" style="font-size: 1.15em; color: rgb(110, 73, 165)">链路追踪<sup>1</sup></a><a id="tags/Download/" href="/tags/Download/" style="font-size: 1.15em; color: rgb(177, 14, 152)">⏬Download<sup>1</sup></a><a id="tags/ELK/" href="/tags/ELK/" style="font-size: 1.26em; color: rgb(51, 72, 67)">ELK<sup>5</sup></a><a id="tags/Logstash/" href="/tags/Logstash/" style="font-size: 1.18em; color: rgb(129, 50, 17)">Logstash<sup>2</sup></a><a id="tags/Nginx/" href="/tags/Nginx/" style="font-size: 1.18em; color: rgb(46, 71, 4)">Nginx<sup>2</sup></a><a id="tags/Golang/" href="/tags/Golang/" style="font-size: 1.34em; color: rgb(3, 71, 42)">📝Golang<sup>8</sup></a><a id="tags/JumpServer/" href="/tags/JumpServer/" style="font-size: 1.15em; color: rgb(130, 37, 181)">JumpServer<sup>1</sup></a><a id="tags/堡垒机/" href="/tags/%E5%A0%A1%E5%9E%92%E6%9C%BA/" style="font-size: 1.15em; color: rgb(67, 9, 56)">堡垒机<sup>1</sup></a><a id="tags/Kong/" href="/tags/Kong/" style="font-size: 1.2em; color: rgb(121, 142, 54)">Kong<sup>3</sup></a><a id="tags/OAuth2-0/" href="/tags/OAuth2-0/" style="font-size: 1.15em; color: rgb(39, 100, 129)">OAuth2.0<sup>1</sup></a><a id="tags/iptables/" href="/tags/iptables/" style="font-size: 1.15em; color: rgb(102, 108, 53)">iptables<sup>1</sup></a><a id="tags/MongoDB/" href="/tags/MongoDB/" style="font-size: 1.2em; color: rgb(12, 107, 132)">MongoDB<sup>3</sup></a><a id="tags/NoSQL/" href="/tags/NoSQL/" style="font-size: 1.31em; color: rgb(182, 199, 130)">NoSQL<sup>7</sup></a><a id="tags/主从复制/" href="/tags/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/" style="font-size: 1.37em; color: rgb(26, 46, 103)">主从复制<sup>12</sup></a><a id="tags/MySQL/" href="/tags/MySQL/" style="font-size: 1.42em; color: rgb(164, 113, 41)">🌲MySQL<sup>26</sup></a><a id="tags/读写分离/" href="/tags/%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB/" style="font-size: 1.23em; color: rgb(181, 25, 37)">读写分离<sup>4</sup></a><a id="tags/高可用/" href="/tags/%E9%AB%98%E5%8F%AF%E7%94%A8/" style="font-size: 1.34em; color: rgb(67, 48, 173)">高可用<sup>8</sup></a><a id="tags/MHA/" href="/tags/MHA/" style="font-size: 1.18em; color: rgb(4, 56, 129)">MHA<sup>2</sup></a><a id="tags/分布式/" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 1.26em; color: rgb(85, 174, 155)">分布式<sup>5</sup></a><a id="tags/MyCAT/" href="/tags/MyCAT/" style="font-size: 1.2em; color: rgb(9, 199, 182)">MyCAT<sup>3</sup></a><a id="tags/垂直拆分/" href="/tags/%E5%9E%82%E7%9B%B4%E6%8B%86%E5%88%86/" style="font-size: 1.15em; color: rgb(185, 168, 9)">垂直拆分<sup>1</sup></a><a id="tags/锁/" href="/tags/%E9%94%81/" style="font-size: 1.15em; color: rgb(146, 23, 42)">锁<sup>1</sup></a><a id="tags/ACID/" href="/tags/ACID/" style="font-size: 1.15em; color: rgb(1, 158, 173)">ACID<sup>1</sup></a><a id="tags/事务/" href="/tags/%E4%BA%8B%E5%8A%A1/" style="font-size: 1.15em; color: rgb(6, 183, 56)">事务<sup>1</sup></a><a id="tags/日志管理/" href="/tags/%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86/" style="font-size: 1.23em; color: rgb(171, 101, 104)">日志管理<sup>4</sup></a><a id="tags/SQL/" href="/tags/SQL/" style="font-size: 1.2em; color: rgb(81, 55, 67)">SQL<sup>3</sup></a><a id="tags/一致性hash算法/" href="/tags/%E4%B8%80%E8%87%B4%E6%80%A7hash%E7%AE%97%E6%B3%95/" style="font-size: 1.15em; color: rgb(3, 127, 152)">一致性hash算法<sup>1</sup></a><a id="tags/PAM/" href="/tags/PAM/" style="font-size: 1.15em; color: rgb(187, 178, 23)">PAM<sup>1</sup></a><a id="tags/Ansible/" href="/tags/Ansible/" style="font-size: 1.15em; color: rgb(89, 56, 82)">Ansible<sup>1</sup></a><a id="tags/Playbook/" href="/tags/Playbook/" style="font-size: 1.15em; color: rgb(20, 24, 8)">Playbook<sup>1</sup></a><a id="tags/Redis/" href="/tags/Redis/" style="font-size: 1.26em; color: rgb(162, 31, 106)">Redis<sup>5</sup></a><a id="tags/tools/" href="/tags/tools/" style="font-size: 1.15em; color: rgb(121, 25, 57)">tools<sup>1</sup></a><a id="tags/SVN/" href="/tags/SVN/" style="font-size: 1.15em; color: rgb(111, 161, 30)">SVN<sup>1</sup></a><a id="tags/Zabbix/" href="/tags/Zabbix/" style="font-size: 1.23em; color: rgb(163, 55, 76)">Zabbix<sup>4</sup></a><a id="tags/Zookeeper/" href="/tags/Zookeeper/" style="font-size: 1.2em; color: rgb(48, 152, 41)">Zookeeper<sup>3</sup></a><a id="tags/gRPC/" href="/tags/gRPC/" style="font-size: 1.15em; color: rgb(23, 18, 150)">gRPC<sup>1</sup></a><a id="tags/Kubernetes/" href="/tags/Kubernetes/" style="font-size: 1.4em; color: rgb(47, 74, 108)">⛵Kubernetes<sup>20</sup></a><a id="tags/place/" href="/tags/place/" style="font-size: 1.15em; color: rgb(64, 130, 163)">place<sup>1</sup></a><a id="tags/mysql备份/" href="/tags/mysql%E5%A4%87%E4%BB%BD/" style="font-size: 1.15em; color: rgb(148, 25, 47)">mysql备份<sup>1</sup></a><a id="tags/弹性伸缩/" href="/tags/%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9/" style="font-size: 1.15em; color: rgb(0, 163, 58)">弹性伸缩<sup>1</sup></a><a id="tags/调度策略/" href="/tags/%E8%B0%83%E5%BA%A6%E7%AD%96%E7%95%A5/" style="font-size: 1.15em; color: rgb(192, 176, 98)">调度策略<sup>1</sup></a><a id="tags/数据备份/" href="/tags/%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD/" style="font-size: 1.18em; color: rgb(171, 58, 166)">数据备份<sup>2</sup></a><a id="tags/OPENVPN/" href="/tags/OPENVPN/" style="font-size: 1.15em; color: rgb(35, 83, 190)">OPENVPN<sup>1</sup></a><a id="tags/DNS/" href="/tags/DNS/" style="font-size: 1.15em; color: rgb(10, 129, 43)">DNS<sup>1</sup></a><a id="tags/树莓派/" href="/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/" style="font-size: 1.15em; color: rgb(140, 198, 196)">树莓派<sup>1</sup></a><a id="tags/Minecraft/" href="/tags/Minecraft/" style="font-size: 1.15em; color: rgb(77, 187, 33)">Minecraft<sup>1</sup></a><a id="tags/优化/" href="/tags/%E4%BC%98%E5%8C%96/" style="font-size: 1.15em; color: rgb(20, 166, 46)">优化<sup>1</sup></a><a id="tags/Apollo/" href="/tags/Apollo/" style="font-size: 1.15em; color: rgb(20, 93, 162)">Apollo<sup>1</sup></a><a id="tags/Canal/" href="/tags/Canal/" style="font-size: 1.15em; color: rgb(159, 113, 53)">Canal<sup>1</sup></a><a id="tags/多表联查/" href="/tags/%E5%A4%9A%E8%A1%A8%E8%81%94%E6%9F%A5/" style="font-size: 1.15em; color: rgb(144, 177, 113)">多表联查<sup>1</sup></a><a id="tags/CI-CD/" href="/tags/CI-CD/" style="font-size: 1.18em; color: rgb(189, 49, 181)">CI/CD<sup>2</sup></a><a id="tags/水平拆分/" href="/tags/%E6%B0%B4%E5%B9%B3%E6%8B%86%E5%88%86/" style="font-size: 1.15em; color: rgb(132, 139, 151)">水平拆分<sup>1</sup></a><a id="tags/索引/" href="/tags/%E7%B4%A2%E5%BC%95/" style="font-size: 1.15em; color: rgb(60, 183, 88)">索引<sup>1</sup></a><a id="tags/Redis哨兵/" href="/tags/Redis%E5%93%A8%E5%85%B5/" style="font-size: 1.15em; color: rgb(25, 133, 151)">Redis哨兵<sup>1</sup></a><a id="tags/Terraform/" href="/tags/Terraform/" style="font-size: 1.15em; color: rgb(39, 149, 46)">Terraform<sup>1</sup></a><a id="tags/基础设施即代码/" href="/tags/%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E5%8D%B3%E4%BB%A3%E7%A0%81/" style="font-size: 1.15em; color: rgb(134, 150, 185)">基础设施即代码<sup>1</sup></a><a id="tags/公有云编排/" href="/tags/%E5%85%AC%E6%9C%89%E4%BA%91%E7%BC%96%E6%8E%92/" style="font-size: 1.15em; color: rgb(3, 132, 126)">公有云编排<sup>1</sup></a><a id="tags/数据持久化/" href="/tags/%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/" style="font-size: 1.15em; color: rgb(183, 197, 190)">数据持久化<sup>1</sup></a><a id="tags/Workload/" href="/tags/Workload/" style="font-size: 1.15em; color: rgb(185, 80, 68)">Workload<sup>1</sup></a><a id="tags/服务发现/" href="/tags/%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0/" style="font-size: 1.15em; color: rgb(107, 115, 47)">服务发现<sup>1</sup></a><a id="tags/数据库优化/" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BC%98%E5%8C%96/" style="font-size: 1.15em; color: rgb(119, 45, 71)">数据库优化<sup>1</sup></a><a id="tags/容器编排/" href="/tags/%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92/" style="font-size: 1.15em; color: rgb(142, 8, 64)">容器编排<sup>1</sup></a><a id="tags/Prometheus/" href="/tags/Prometheus/" style="font-size: 1.15em; color: rgb(37, 1, 26)">Prometheus<sup>1</sup></a><a id="tags/StatefuSet/" href="/tags/StatefuSet/" style="font-size: 1.15em; color: rgb(44, 40, 103)">StatefuSet<sup>1</sup></a><a id="tags/Helm-v3/" href="/tags/Helm-v3/" style="font-size: 1.15em; color: rgb(182, 58, 185)">Helm v3<sup>1</sup></a><a id="tags/SHELL/" href="/tags/SHELL/" style="font-size: 1.15em; color: rgb(69, 163, 77)">SHELL<sup>1</sup></a><a id="tags/RAID/" href="/tags/RAID/" style="font-size: 1.15em; color: rgb(48, 194, 132)">RAID<sup>1</sup></a></div></div></div></div><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-sun"></i><i class="fas fa-moon"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="rightmenu"><div class="rightmenu-group rightmenu-small"><div class="rightmenu-item" id="menu-backward" onclick="window.history.back()"><i class="fas fa-arrow-left"></i></div><div class="rightmenu-item" id="menu-forward" onclick="window.history.forward()"><i class="fas fa-arrow-right"></i></div><div class="rightmenu-item" id="menu-refresh" onclick="window.history.reload()"><i class="fas fa-arrow-rotate-right"></i></div><div class="rightmenu-item" id="menu-top" onclick="btf.scrollToDest(0, 500)"><i class="fas fa-arrow-up"></i></div></div><div class="rightmenu-group rightmenu-line" id="rightmenu-text"><div class="rightmenu-item" id="menu-copy"><i class="fas fa-copy"></i><span>复制内容</span></div><div class="rightmenu-item" id="menu-comment"><i class="fas fa-comment"></i><span>引用评论</span></div><div class="rightmenu-item" id="menu-paste"><i class="fas fa-paste"></i><span>粘贴文本</span></div><div class="rightmenu-item" id="menu-search"><i class="fas fa-search"></i><span>在本站搜索</span></div><div class="rightmenu-item" id="menu-baidu"><i class="fas fa-search-plus"></i><span>去百度搜索</span></div></div><div class="rightmenu-group rightmenu-line" id="rightmenu-href"><div class="rightmenu-item" id="menu-copy-image"><i class="fas fa-copy"></i><span>复制图片</span></div><div class="rightmenu-item" id="menu-download-image"><i class="fas fa-download"></i><span>下载图片</span></div><div class="rightmenu-item" id="menu-link"><i class="fas fa-link"></i><span>分享链接</span></div><div class="rightmenu-item" id="menu-window"><i class="fas fa-window-restore"></i><span>新窗口打开</span></div></div><div class="rightmenu-group rightmenu-line" id="rightmenu-post"><a class="rightmenu-item" id="menu-random" href="/random/"><i class="fas fa-random"></i><span>随机文章</span></a><a class="rightmenu-item" id="menu-categories" href="/categories/"><i class="fas fa-shapes"></i><span>全部分类</span></a><a class="rightmenu-item" id="menu-tags" href="/tags/"><i class="fas fa-tags"></i><span>所有标签</span></a><div class="rightmenu-item" id="menu-share"><i class="fas fa-share-square"></i><span>分享本页</span></div></div><div class="rightmenu-group rightmenu-line" id="rightmenu-site"><a class="rightmenu-item" id="menu-message" href="/message/"><i class="fas fa-envelope"></i><span>留言信箱</span></a><a class="rightmenu-item" id="menu-about" href="/about/"><i class="fas fa-address-card"></i><span>关于本站</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/eurkon/color-thief.min.js"></script><script defer src="/js/eurkon/eurkon.js"></script><script defer data-pjax src="/js/eurkon/refresh.js"></script><script src="/js/tw_cn.js"></script><script src="/css/fei/fancybox.umd.min.js"></script><div class="js-pjax"></div><script defer data-pjax async src="//at.alicdn.com/t/font_2358265_expoyqe85d4.js"></script><script src="/css/fei/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/haru01.model.json"},"bottom":-40,"display":{"position":"right","width":190,"height":380,"hOffset":5},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html><script>var posts=["forward/60c1bc2d.html","forward/408a4bb8.html","forward/882d9505.html","forward/d063782.html","forward/download.html","forward/17b35260.html","forward/131c756.html","forward/47eea66c.html","forward/eb065b59.html","forward/873540ab.html","forward/d12df344.html","forward/8f91bfec.html","forward/d5b63f7f.html","forward/f9d199b7.html","forward/420acb0d.html","forward/bac240f7.html","forward/1e56645c.html","forward/d7240237.html","forward/c4bb5371.html","forward/6c0d75ae.html","forward/3053135c.html","forward/74c8159a.html","forward/bbb9c58b.html","forward/c919a25c.html","forward/557ea64b.html","forward/49de8711.html","forward/f34e607d.html","forward/c3e1b71a.html","forward/bc8a646.html","forward/93ea067.html","forward/62bf20bb.html","forward/cb26d424.html","forward/3c4a0863.html","forward/ddc093b3.html","forward/4f3d60c1.html","forward/a7fae6f0.html","forward/ae362167.html","forward/36cbf320.html","forward/67af6371.html","forward/fb94f251.html","forward/212d60e3.html","forward/b571ca78.html","forward/fabc6ce1.html","forward/ae26d423.html","forward/f353577b.html","forward/2f09977b.html","forward/3837938a.html","forward/7be7c575.html","forward/48a90e5c.html","forward/4a17b156.html","forward/5234d9e2.html","forward/3ea5fff1.html","forward/2aa52898.html","forward/55d102bd.html","forward/ad8d3f77.html","forward/1758bdeb.html","forward/6cfd7a23.html","forward/8cd3cd17.html","forward/8e9bbd7d.html","forward/2cfbf2d2.html","forward/d4ac701.html","forward/8bd2a16a.html","forward/d6f16b84.html","forward/91db5a91.html","forward/29b0e6a9.html","forward/d36764c1.html","forward/852a3e1.html","forward/13c392b.html","forward/40c70ce.html","forward/c3e55136.html","forward/84c0fcc7.html","forward/69e1266e.html","forward/663d93c2.html","forward/68023dec.html","forward/da64184b.html","forward/ae6c7518.html","forward/3df8560c.html","forward/b36ee5af.html","forward/1051b489.html","forward/dc57d8c4.html","forward/61316209.html","forward/503970b4.html","forward/ff7280bd.html","forward/b17eefd4.html","forward/5c41384a.html","forward/14a32ee2.html","forward/58eea07e.html","forward/6b4e4d76.html","forward/dc57d8c5.html","forward/7139bb18.html","forward/649a95fd.html","forward/57e2aa11.html","forward/312ec9e0.html"];function toRandomPost(){ window.pjax ? pjax.loadUrl('/'+posts[Math.floor(Math.random()*posts.length)]) : window.open('/'+posts[Math.floor(Math.random()*posts.length)], "_self"); };</script><script>var flinks=[{"name":"Eurkon","link":"https://blog.eurkon.com","avatar":"https://blog.eurkon.com/images/user/avatar.jpg","descr":"不只是代码的搬运工"},{"name":"一朵大呲花","link":"https://www.iiemo.com/","avatar":"https://www.iiemo.com/logo.png","descr":"资深NB前端大佬"},{"name":"豌豆多多","link":"https://wandouduoduo.github.io/","avatar":"/img/link/index.png","descr":"资深沪漂运维工程师"},{"name":"周小雨","link":"https://zxyy.me/","avatar":"https://q2.qlogo.cn/headimg_dl?dst_uin=1016673080&spec=100","descr":"PHP程序猿"},{"name":"ACG食堂","link":"https://canteen.globalacca.top/","avatar":"https://q2.qlogo.cn/headimg_dl?dst_uin=1478030465&spec=100","descr":"汇集ACG、动漫和galgame为一体的综合小站"},{"name":"缺缺","link":"https://www.quewaner.com/","avatar":"https://q2.qlogo.cn/headimg_dl?dst_uin=3393597524&spec=100","descr":"资深前端工程师"},{"name":"yiyun","link":"https://moeci.com/","avatar":"https://q2.qlogo.cn/headimg_dl?dst_uin=2284407619&spec=100","descr":"全栈开发"},{"name":"二哈小窝","link":"https://www.moeeh.cn/","avatar":"https://www.moeeh.cn/eh/eh.png","descr":"苦酒折柳今相离 无风无月也无你"},{"name":"Akilarの糖果屋","link":"https://akilar.top/","avatar":"https://unpkg.zhimg.com/akilar-candyassets/image/siteicon/favicon.png","descr":"期待您的光临！"},{"name":"小高导航","link":"https://www.dhw22.com/","avatar":"https://www.dhw22.com/wp-content/uploads/2022/01/Favicon.png","descr":"资源类技术教程活动导航分类平台"},{"name":"华为开源镜像站","link":"https://mirrors.huaweicloud.com/","avatar":"/img/link/huawei.png","descr":"构建万物互联的智能世界"},{"name":"阿里开源镜像站","link":"https://mirrors.aliyun.com/","avatar":"/img/link/aliyun.png","descr":"为了无法计算的价值"},{"name":"网易开源镜像站","link":"https://mirrors.163.com/","avatar":"/img/link/netease.png","descr":"网聚人的力量"},{"name":"搜狐开源镜像站","link":"https://mirrors.sohu.com/","avatar":"/img/link/souhu.png","descr":"上搜狐 知天下"},{"name":"清华开源镜像站","link":"https://mirrors.tuna.tsinghua.edu.cn/","avatar":"/img/link/qh.png","descr":"自强不息,厚德载物"},{"name":"浙大开源镜像站","link":"https://mirrors.zju.edu.cn/","avatar":"/img/link/zd.png","descr":"兼总条贯,知至知终"},{"name":"中科大开源镜像站","link":"https://mirrors.ustc.edu.cn/","avatar":"/img/link/zkd.png","descr":"红专并进,理实交融"},{"name":"兰大开源镜像站","link":"https://mirror.lzu.edu.cn/","avatar":"/img/link/ld.png","descr":"独树一帜,自强不息"}];function toRandomFlink(){window.open(flinks[Math.floor(Math.random()*flinks.length)].link);};</script>